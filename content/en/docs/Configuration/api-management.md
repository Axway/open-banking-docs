---
title: "API Management Configuration"
linkTitle: "API Management"
weight: 1
date: 2021-09-02
---

## API Gateway

Amplify Open Banking API Gateway is based on the Axway API Gateway product.

Most features are documented in the [Axway API Gateway documentation](https://docs.axway.com/bundle/axway-open-docs/page/docs/apim_administration/apigtw_admin/index.html).

### Key Properties Store (KPS) configuration

The Key Properties Store of API Gateway is used to store the solution configuration variables.
This configuration can be read at the beginning of any policy using a common policy "Read Configuration."

| Column Name | Type | Purpose |
| --- | --- | --- |
| a_id | java.lang.String | Autogenerated Id. |
| b_tenantId | java.lang.String | Bank Identifier (helpful in multi tenant setup). |
| c_name | java.lang.String | API Name. |
| d_version | java.lang.String | API Version. |
| e_method | java.lang.String | API Method. |
| f_extension_1 | java.lang.String | For future use |
| g_extension_2 | java.lang.String | For future use. |
| k_values | java.util.Map`<java.lang.String,java.lang.String>` | Key Value Pairs help in extending configuration whenever we want without deployment. New key value pairs can be added easily.|

In FDX deployment, by default, there is at least one row for each API and a row with generic information which is applicable to all APIs.

In Open Finance Brazil deployment, by default, only one line exists with no criteria (columns b to e) and values (column k) corresponding to solution deployment parameters.

Refer to [Solution Deployment](/docs/deployment/installation) to see how to change these values during deployment.

Additionally, you can check and update your current configuration from API Gateway Manager - Settings - Key Property Stores.

![kps-configuration](/Images/api-gateway-manager-kps-configuration.png)

Click on configuration and the line to be checked or updated.

![kps-values](/Images/api-gateway-manager-kps-values.png)

Several values should correspond to the settings of Cloudentity or its consent module. See the below mapping table to check that the KPS values are correct.

#### Mapping table for FDX

| KPS Values | How to retrieve or check this values in Cloudentity UI |
| --- | --- |
| oauth_ce_host | hostname of Cloudentity server |
| oauth_ce_port | port of Cloudentity server |
| oauth_ce_tenantid | tenant id in Cloudentity server |
| oauth_ce_id | workspace id in Cloudentity where client applications are created and consents are stored |
| oauth_introspect_client_id | client id of app named "bank" in FDX workspace |
| oauth_ce_idp_clientId | client id of the custom IdP configured in FDX workspace |
| oauth_ce_idp_clientSecret | client secret of the custom IdP configured in FDX workspace |
| oauth_consent_user_clientSecret | client secret of the custom IdP configured in bank-customers workspace |

#### Mapping table for Open Finance Brazil

| KPS Values | How to retrieve or check this values in Cloudentity UI |
| --- | --- |
| oauth_consent_clientId | Custom IDP Demo bank login ID: bank customer. |
| oauth_consent_clientSecret | Custom IDP Demo bank login secret: bank customer. |
| oauth_consent_confirmation_clientid | Settings: consent screen client id. |
| oauth_consent_confirmation_clientSecret | Settings: consent screen client secret. |
| oauth_consent_user_clientSecret | Custom IDP Demo bank login secret: open banking workspace. |
| oauth_host | Host of Cloudentity server. |
| oauth_id | Openbanking workspace id in Cloudentity server. |
| oauth_introspect_clientid | App is bank in openbanking workspace. |
| oauth_tenantid | Tenant id in Cloudentity server. |

### API policies

API Gateway is configured with several API policies that are used with Open Banking flows.
You may want to customize some of these policies.

You can check the following policy definitions by opening Policy Studio and navigating to Policies.

For FDX deployment policy container name is - #AMPLIFY-OB-FDX.

For Open Finance Brazil deployment policy container name is - #AMPLIFY-OB.

![apim-policy-studio-apis](/Images/apim-policy-studio-api-containers.png)

If you decide to change one of them, you can use Policy Studio directly for the development environment only.
<!-- For other environments, you export the Policy Studio projects and build new APIM Docker images to use instead of the standard ones. -->
For other environments, you must update the FDX-YAML policy project, which is part of apigateway-config-fdx-7.7.0.20xxxxxx-BNxx.tar.gz, and deploy the configuration as detailed in [Mount the FDX Configuration](/docs/deployment/installation/api-management/fdx-apim/#mount-the-fdx-configuration).

{{% alert title="Note" color="primary" %}} If you make changes to any of the policies in this container then those changes will be overridden by future upgrades. {{% /alert %}}

### Certificates

API Gateway is configured with several certificates that are used during the runtime:

* Server certificate
* Client certificate authority
* Jwt certificate
* Keys

You can check which ones are in use by opening Policy Studio and navigating to Environment Configuration - Certificate and Keys - Certificates.
Right-click a certificate to see if there are any references to it, meaning that they are currently in use.

![apim-policy-studio-certificates](/Images/apim-policy-studio-certificates.png)

If you identify the need to change one of them, refer to the API Gateway instructions that you can find under each section of [Certificate Management](/docs/configuration/certificate-management).

## API Manager

Configure the Open Banking API Manager settings, APIs and organizations and applications.

Amplify Open Banking API Manager is based on the Axway API Manager product. Most features are documented in the [Axway API Manager documentation](https://docs.axway.com/bundle/axway-open-docs/page/docs/apim_administration/apimgr_admin/index.html).

<!-- ## Settings

{{% alert title="Note" color="primary" %}}
This page is under development
{{% /alert %}} -->

### API Management

Upon solution deployment, several Open Banking APIs are deployed and published in the catalog.
You can use the admin interface to update the APIs.

![open banking apis](/Images/api-manager-apis.png)

Refer to the details in the [Axway API Manager documentation](https://docs.axway.com/bundle/axway-open-docs/page/docs/apim_administration/apimgr_admin/api_mgmt_virtualize_web/index.html) to manage API details.
