<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="7071px" preserveAspectRatio="none" style="width:2206px;height:7071px;background:#FFFFFF;" version="1.1" viewBox="0 0 2206 7071" width="2206px" zoomAndPan="magnify"><defs><filter height="300%" id="f1fpw6yyoa51cs" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1101.75" y="28.6992"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1101.75" y="49.793"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1101.75" y="70.8867"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1101.75" y="91.9805"/><rect fill="#E06666" height="6953.7578" style="stroke:#A80036;stroke-width:1.0;" width="606" x="294.5" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="541" y="116.4355">Open Banking APIs</text><rect fill="#94C47D" height="6953.7578" style="stroke:#A80036;stroke-width:1.0;" width="318" x="922.5" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="1000.5" y="116.4355">Identity and Access Control</text><rect fill="#D5A6BD" height="6953.7578" style="stroke:#A80036;stroke-width:1.0;" width="312.5" x="1362" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="1441.25" y="116.4355">Core Banking Applications</text><rect fill="#FFFFFF" filter="url(#f1fpw6yyoa51cs)" height="217.7656" style="stroke:#000000;stroke-width:2.0;" width="243" x="1946.5" y="3865.7109"/><rect fill="#FFFFFF" height="161.2969" style="stroke:none;stroke-width:1.0;" width="243" x="1946.5" y="3922.1797"/><rect fill="#FFFFFF" filter="url(#f1fpw6yyoa51cs)" height="1587.6797" style="stroke:#000000;stroke-width:2.0;" width="1956.5" x="10" y="4696.5703"/><rect fill="#FFFFFF" filter="url(#f1fpw6yyoa51cs)" height="335.1719" style="stroke:#000000;stroke-width:2.0;" width="1936.5" x="20" y="4805.7422"/><rect fill="#FFFFFF" height="476.1328" style="stroke:none;stroke-width:1.0;" width="1956.5" x="10" y="5508.0859"/><rect fill="#FFFFFF" height="300.0313" style="stroke:none;stroke-width:1.0;" width="1956.5" x="10" y="5984.2188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="74" x2="74" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="337.5" x2="337.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="602" x2="602" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="865.5" x2="865.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="976.5" x2="976.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1185.5" x2="1185.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1401" x2="1401" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1634.5" x2="1634.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1756.5" x2="1756.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1889.5" x2="1889.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1990.5" x2="1990.5" y1="191.8281" y2="7064.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2145.5" x2="2145.5" y1="191.8281" y2="7064.1328"/><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="84" x="30" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="37" y="160.0039">Third-Party</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="59.5" y="176.4102">App</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="75" x="298.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="46" x="313" y="160.0039">Ingress</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="61" x="305.5" y="176.4102">Controller</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="70" x="565" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="589" y="160.0039">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="572" y="176.4102">Gateway</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="57" x="835.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="853" y="160.0039">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="43" x="842.5" y="176.4102">Builder</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="926.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="951.5" y="160.0039">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="933.5" y="176.4102">Management</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="1135.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="1158" y="160.0039">Consent</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="1142.5" y="176.4102">Management</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="66" x="1366" y="123.6094"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1373.5" y="143.5977">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="1375.5" y="160.0039">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="1373" y="176.4102">Provider</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1599.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1607.5" y="160.0039">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="53" x="1606.5" y="176.4102">Systems</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="79.625" style="stroke:#A80036;stroke-width:1.5;" width="129" x="1690.5" y="107.2031"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="87" x="1711.5" y="127.1914">Open Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="1727" y="143.5977">Directory</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="1749" y="160.0039">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="115" x="1697.5" y="176.4102">JSON Web Key Set</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="79.625" style="stroke:#A80036;stroke-width:1.5;" width="109" x="1833.5" y="107.2031"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="64" x="1856" y="127.1914">Certificate</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="58" x="1859" y="143.5977">Authority</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="1882" y="160.0039">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="95" x="1840.5" y="176.4102">OCSP Endpoint</text><rect fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="65" x="1956.5" y="123.6094"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="41" x="1968.5" y="143.5977">Mobile</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1963.5" y="160.0039">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="1976.5" y="176.4102">App</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="61" x="2112.5" y="188.4102">Customer</text><ellipse cx="2146" cy="118.4219" fill="#FEFECE" filter="url(#f1fpw6yyoa51cs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M2146,126.4219 L2146,153.4219 M2133,134.4219 L2159,134.4219 M2146,153.4219 L2133,168.4219 M2146,153.4219 L2159,168.4219 " fill="none" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2199.5" x="0" y="222.4453"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="222.4453" y2="222.4453"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="225.4453" y2="225.4453"/><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="306" x="946.75" y="211.8281"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="289" x="952.75" y="227.8887">Part 0: Registration of Token Delivery Preferences</text><path d="M79,250.0625 L79,504.0625 L497,504.0625 L497,260.0625 L487,250.0625 L79,250.0625 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M487,250.0625 L487,260.0625 L497,260.0625 L487,250.0625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="344" x="85" y="267.123">CIBA requires that Clients register a delivery mode prior to the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="257" x="85" y="282.3574">transmission of any Authentication Requests:</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="287.5313" y2="287.5313"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="287.5313" y2="287.5313"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="287.5313" y2="287.5313"/><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="383" x="85" y="301.5918">Clients registering to use CIBA MUST indicate a token delivery mode</text></a><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="306.7656" y2="306.7656"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="306.7656" y2="306.7656"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="306.7656" y2="306.7656"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="358" x="85" y="320.8262">The Authorization Server (AS) therefore must host a registration</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="343" x="85" y="336.0605">endpoint - defined in the discoverable OpenID Configuration -</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="85" y="351.2949">that allows the Client to do so. The parameters for this call</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="339" x="85" y="366.5293">are described in the CIBA specification and differ depending</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="240" x="85" y="381.7637">on the method in question. The modes are:</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="386.9375" y2="386.9375"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="386.9375" y2="386.9375"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="386.9375" y2="386.9375"/><ellipse cx="90.5" cy="396.6719" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="97" y="400.998">Poll</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="183" x="118" y="400.998">: Client polls the Token endpoint.</text><ellipse cx="90.5" cy="411.9063" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="97" y="416.2324">Ping</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="282" x="122" y="416.2324">: AS notifies, Client retrieves from Token endpoint.</text><ellipse cx="90.5" cy="427.1406" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="97" y="431.4668">Push</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="154" x="126" y="431.4668">: AS sends tokens to Client.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="436.6406" y2="436.6406"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="436.6406" y2="436.6406"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="436.6406" y2="436.6406"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="392" x="85" y="450.7012">The supported modes vary by AS as they are implementor specific i.e.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="393" x="85" y="465.9355">implementors of the AS can choose to only support one-or-more given</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="397" x="85" y="481.1699">modes. The supported modes must be made pushed in the AS OpenID</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="85" y="496.4043">Configuration.</text><polygon fill="#A80036" points="326,530.7109,336,534.7109,326,538.7109,330,534.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="534.7109" y2="534.7109"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="81" y="529.645">POST /connect/register</text><path d="M343,547.7109 L343,648.7109 L686,648.7109 L686,557.7109 L676,547.7109 L343,547.7109 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M676,547.7109 L676,557.7109 L686,557.7109 L676,547.7109 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="320" x="349" y="564.7715">The Kubernetes Ingress Controller is responsible for TLS</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="349" y="580.0059">termination and perfoming an OCSP call to the Certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="295" x="349" y="595.2402">Authority to ensure the client certificate presented is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="312" x="349" y="610.4746">valid. The fingerprint of the certificate will be forwarded</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="319" x="349" y="625.709">to Identity Management to verify the validity of the OAuth</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="243" x="349" y="640.9434">Client as this cannot be asserted via OCSP.</text><polygon fill="#A80036" points="1878,675.3516,1888,679.3516,1878,683.3516,1882,679.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="679.3516" y2="679.3516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="674.1777">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,704.5859,339,708.5859,349,712.5859,345,708.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="708.5859" y2="708.5859"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="703.4121">Response</text><polygon fill="#A80036" points="590,733.8203,600,737.8203,590,741.8203,594,737.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="737.8203" y2="737.8203"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="345" y="732.6465">Registration Request</text><path d="M607,750.8203 L607,805.8203 L1031,805.8203 L1031,760.8203 L1021,750.8203 L607,750.8203 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1021,750.8203 L1021,760.8203 L1031,760.8203 L1021,750.8203 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="352" x="613" y="767.8809">The API Gateway acts as a proxy for both Identity and Consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="346" x="613" y="783.1152">Management. This approach is designed to ensure all identity</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="403" x="613" y="798.3496">and access control can be monitored and logged for analytics purposes</text><polygon fill="#A80036" points="965,832.7578,975,836.7578,965,840.7578,969,836.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="836.7578" y2="836.7578"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="609" y="831.584">Registration Request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="865.9922" y2="865.9922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="865.9922" y2="878.9922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="878.9922" y2="878.9922"/><polygon fill="#A80036" points="988,874.9922,978,878.9922,988,882.9922,984,878.9922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="68" x="984" y="860.8184">Verify Client</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="908.2266" y2="908.2266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="908.2266" y2="921.2266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="921.2266" y2="921.2266"/><polygon fill="#A80036" points="988,917.2266,978,921.2266,988,925.2266,984,921.2266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="984" y="903.0527">Store Client Parameters</text><polygon fill="#A80036" points="613,946.4609,603,950.4609,613,954.4609,609,950.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="976" y1="950.4609" y2="950.4609"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="945.2871">Response</text><polygon fill="#A80036" points="349,975.6953,339,979.6953,349,983.6953,345,979.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="979.6953" y2="979.6953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="974.5215">Response</text><polygon fill="#A80036" points="85,1004.9297,75,1008.9297,85,1012.9297,81,1008.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1008.9297" y2="1008.9297"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="91" y="1003.7559">Response</text><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2199.5" x="0" y="1037.5469"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="1037.5469" y2="1037.5469"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="1040.5469" y2="1040.5469"/><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="340" x="929.75" y="1026.9297"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="323" x="935.75" y="1042.9902">Part 1: Create Consent and Send Authentication Request</text><path d="M79,1065.1641 L79,1135.1641 L425,1135.1641 L425,1075.1641 L415,1065.1641 L79,1065.1641 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M415,1065.1641 L415,1075.1641 L425,1075.1641 L415,1065.1641 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="85" y="1082.2246">The Third-Party App requests an Access Token using</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="325" x="85" y="1097.459">the Client Credentials grant type. Nominally authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="85" y="1112.6934">is through Mutual Authentication over TLS but it could</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="91" x="85" y="1127.9277">equally be using</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="179" y="1128.0356">private_key_jwt</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="299" y="1127.9277">.</text><polygon fill="#A80036" points="326,1162.2344,336,1166.2344,326,1170.2344,330,1166.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="1166.2344" y2="1166.2344"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="81" y="1161.1685">POST /token</text><polygon fill="#A80036" points="1878,1191.4688,1888,1195.4688,1878,1199.4688,1882,1195.4688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="1195.4688" y2="1195.4688"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="1190.2949">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,1220.7031,339,1224.7031,349,1228.7031,345,1224.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="1224.7031" y2="1224.7031"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1219.5293">Response</text><polygon fill="#A80036" points="590,1249.9375,600,1253.9375,590,1257.9375,594,1253.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="1253.9375" y2="1253.9375"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="128" x="345" y="1248.7637">Access Token request</text><polygon fill="#A80036" points="965,1279.1719,975,1283.1719,965,1287.1719,969,1283.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="1283.1719" y2="1283.1719"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="128" x="609" y="1277.998">Access Token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="1312.4063" y2="1312.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="1312.4063" y2="1325.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="1325.4063" y2="1325.4063"/><polygon fill="#A80036" points="988,1321.4063,978,1325.4063,988,1329.4063,984,1325.4063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="68" x="984" y="1307.2324">Verify Client</text><polygon fill="#A80036" points="613,1350.6406,603,1354.6406,613,1358.6406,609,1354.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="607" x2="976" y1="1354.6406" y2="1354.6406"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="117" x="619" y="1349.4668">Issue Access Token</text><polygon fill="#A80036" points="349,1394.9063,339,1398.9063,349,1402.9063,345,1398.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="1398.9063" y2="1398.9063"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="355" y="1378.7075">200 OK</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="355" y="1393.8403">{"access_token": "..."}</text><polygon fill="#A80036" points="85,1439.1719,75,1443.1719,85,1447.1719,81,1443.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1443.1719" y2="1443.1719"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="91" y="1422.9731">200 OK</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="91" y="1438.106">{"access_token": "..."}</text><path d="M79,1456.1719 L79,1526.1719 L422,1526.1719 L422,1466.1719 L412,1456.1719 L79,1456.1719 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M412,1456.1719 L412,1466.1719 L422,1466.1719 L412,1456.1719 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="314" x="85" y="1473.2324">With the Access Token in hand the Third-Party can then</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="1488.4668">create the consent resource. This needs to be completed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="300" x="85" y="1503.7012">before the Authentication Request as the value of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="85" y="1519.0435">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="225" x="160" y="1518.9355">is required to set the value of the scope.</text><polygon fill="#A80036" points="326,1553.2422,336,1557.2422,326,1561.2422,330,1557.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="1557.2422" y2="1557.2422"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="81" y="1552.1763">POST /payments/v1/consents</text><polygon fill="#A80036" points="1878,1582.4766,1888,1586.4766,1878,1590.4766,1882,1586.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="1586.4766" y2="1586.4766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="1581.3027">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,1611.7109,339,1615.7109,349,1619.7109,345,1615.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="1615.7109" y2="1615.7109"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1610.5371">Response</text><polygon fill="#A80036" points="590,1640.8438,600,1644.8438,590,1648.8438,594,1644.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="1644.8438" y2="1644.8438"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="345" y="1639.7778">POST /payments/v1/consents</text><polygon fill="#A80036" points="1174,1669.9766,1184,1673.9766,1174,1677.9766,1178,1673.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1180" y1="1673.9766" y2="1673.9766"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="609" y="1668.9106">POST /payments/v1/consents</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1186" x2="1228" y1="1703.2109" y2="1703.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1228" x2="1228" y1="1703.2109" y2="1716.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1187" x2="1228" y1="1716.2109" y2="1716.2109"/><polygon fill="#A80036" points="1197,1712.2109,1187,1716.2109,1197,1720.2109,1193,1716.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="201" x="1193" y="1698.0371">Validate consent request properties</text><polygon fill="#A80036" points="613,1756.4766,603,1760.4766,613,1764.4766,609,1760.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1185" y1="1760.4766" y2="1760.4766"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="619" y="1740.2778">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="619" y="1755.4106">{consentId: "..."}</text><polygon fill="#A80036" points="349,1800.7422,339,1804.7422,349,1808.7422,345,1804.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="1804.7422" y2="1804.7422"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="1784.5435">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="355" y="1799.6763">{consentId: "..."}</text><polygon fill="#A80036" points="85,1845.0078,75,1849.0078,85,1853.0078,81,1849.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1849.0078" y2="1849.0078"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="1828.8091">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="91" y="1843.9419">{consentId: "..."}</text><path d="M79,1862.0078 L79,1917.0078 L463,1917.0078 L463,1872.0078 L453,1862.0078 L79,1862.0078 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,1862.0078 L453,1872.0078 L463,1872.0078 L453,1862.0078 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="1879.0684">The Third-Party App can now create and send the Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="352" x="85" y="1894.3027">Request. This includes the dynamic scope that holds the value</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="33" x="85" y="1909.5371">of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="121" y="1909.645">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="189" x="196" y="1909.5371">returned by Identity Management.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="116" y1="1947.9453" y2="1947.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="116" x2="116" y1="1947.9453" y2="1960.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="75" x2="116" y1="1960.9453" y2="1960.9453"/><polygon fill="#A80036" points="85,1956.9453,75,1960.9453,85,1964.9453,81,1960.9453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="172" x="81" y="1942.7715">Create Authentication Request</text><polygon fill="#A80036" points="326,1986.0781,336,1990.0781,326,1994.0781,330,1990.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="1990.0781" y2="1990.0781"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="81" y="1985.0122">POST /bc-authorize</text><polygon fill="#A80036" points="1878,2015.3125,1888,2019.3125,1878,2023.3125,1882,2019.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="2019.3125" y2="2019.3125"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="2014.1387">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,2044.5469,339,2048.5469,349,2052.5469,345,2048.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="2048.5469" y2="2048.5469"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="2043.373">Response</text><polygon fill="#A80036" points="590,2073.6797,600,2077.6797,590,2081.6797,594,2077.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="2077.6797" y2="2077.6797"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="345" y="2072.6138">POST /bc-authorize</text><path d="M607,2090.6797 L607,2176.6797 L1040,2176.6797 L1040,2100.6797 L1030,2090.6797 L607,2090.6797 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1030,2090.6797 L1030,2100.6797 L1040,2100.6797 L1030,2090.6797 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="347" x="613" y="2107.7402">As with the redirection-based FAPI profiles the Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="330" x="613" y="2122.9746">Request is a JSON Web Signature. It therefore needs to be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="339" x="613" y="2138.209">checked for validity. Note that in the context of CIBA Pushed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="380" x="613" y="2153.4434">Authorization Request is not required as the Authentication Request</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="412" x="613" y="2168.6777">is always sent via a secured backchannel and never through the browser.</text><polygon fill="#A80036" points="1745,2203.0859,1755,2207.0859,1745,2211.0859,1749,2207.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1751" y1="2207.0859" y2="2207.0859"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="609" y="2201.9121">Get JSON Web Key Set</text><polygon fill="#A80036" points="613,2232.3203,603,2236.3203,613,2240.3203,609,2236.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1756" y1="2236.3203" y2="2236.3203"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="2231.1465">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="644" y1="2280.7891" y2="2280.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644" x2="644" y1="2280.7891" y2="2293.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="603" x2="644" y1="2293.7891" y2="2293.7891"/><polygon fill="#A80036" points="613,2289.7891,603,2293.7891,613,2297.7891,609,2293.7891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="121" x="609" y="2260.3809">Match Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="108" x="609" y="2275.6152">Request parameter</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="720" y="2275.7231">kid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="644" y1="2338.2578" y2="2338.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644" x2="644" y1="2338.2578" y2="2351.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="603" x2="644" y1="2351.2578" y2="2351.2578"/><polygon fill="#A80036" points="613,2347.2578,603,2351.2578,613,2355.2578,609,2351.2578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="609" y="2317.8496">Verify Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="164" x="609" y="2333.084">Request parameter signature</text><polygon fill="#A80036" points="965,2376.4922,975,2380.4922,965,2384.4922,969,2380.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="2380.4922" y2="2380.4922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="181" x="609" y="2375.3184">Forward Authentication Request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="2409.7266" y2="2409.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="2409.7266" y2="2422.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="2422.7266" y2="2422.7266"/><polygon fill="#A80036" points="988,2418.7266,978,2422.7266,988,2426.7266,984,2422.7266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="181" x="984" y="2404.5527">Validate Authentication Request</text><path d="M982,2435.7266 L982,2490.7266 L1291,2490.7266 L1291,2445.7266 L1281,2435.7266 L982,2435.7266 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1281,2435.7266 L1281,2445.7266 L1291,2445.7266 L1281,2435.7266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="287" x="988" y="2452.7871">Note this approach is non-normative and the actual</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="288" x="988" y="2468.0215">implementation required should be considered on a</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="988" y="2483.2559">case-by-case basis.</text><polygon fill="#A80036" points="1389,2517.6641,1399,2521.6641,1389,2525.6641,1393,2521.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1395" y1="2521.6641" y2="2521.6641"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="231" x="984" y="2516.4902">Send Authentication Request notification</text><polygon fill="#A80036" points="613,2561.9297,603,2565.9297,613,2569.9297,609,2565.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="976" y1="2565.9297" y2="2565.9297"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="619" y="2545.731">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="619" y="2560.8638">{auth_req_id: "..."}</text><polygon fill="#A80036" points="349,2606.1953,339,2610.1953,349,2614.1953,345,2610.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="2610.1953" y2="2610.1953"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="2589.9966">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="355" y="2605.1294">{auth_req_id: "..."}</text><polygon fill="#A80036" points="85,2650.4609,75,2654.4609,85,2658.4609,81,2654.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="2654.4609" y2="2654.4609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="2634.2622">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="91" y="2649.395">{auth_req_id: "..."}</text><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2199.5" x="0" y="2683.0781"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="2683.0781" y2="2683.0781"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="2686.0781" y2="2686.0781"/><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="328" x="935.75" y="2672.4609"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="311" x="941.75" y="2688.5215">Part 2: Customer Authenticates at Mobile Banking App</text><path d="M1406,2710.6953 L1406,2796.6953 L1747,2796.6953 L1747,2720.6953 L1737,2710.6953 L1406,2710.6953 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1737,2710.6953 L1737,2720.6953 L1747,2720.6953 L1737,2710.6953 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="306" x="1412" y="2727.7559">The flow shown is a hypothetical approach to allowing</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="320" x="1412" y="2742.9902">the End User to authenticate and confirm consent. In this</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="1412" y="2758.2246">scenario has installed their mobile banking app and can</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="319" x="1412" y="2773.459">receive and act-on a request to authenticate and confirm</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="49" x="1412" y="2788.6934">consent.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1401" x2="1443" y1="2842.3359" y2="2842.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1443" x2="1443" y1="2842.3359" y2="2855.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1402" x2="1443" y1="2855.3359" y2="2855.3359"/><polygon fill="#A80036" points="1412,2851.3359,1402,2855.3359,1412,2859.3359,1408,2855.3359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="136" x="1408" y="2821.9277">Correlate Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="132" x="1408" y="2837.1621">Request with Customer</text><polygon fill="#A80036" points="1623,2880.5703,1633,2884.5703,1623,2888.5703,1627,2884.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1401" x2="1629" y1="2884.5703" y2="2884.5703"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="210" x="1408" y="2879.3965">Trigger push notification to Customer</text><path d="M1640,2897.5703 L1640,2952.5703 L1947,2952.5703 L1947,2907.5703 L1937,2897.5703 L1640,2897.5703 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1937,2897.5703 L1937,2907.5703 L1947,2907.5703 L1937,2897.5703 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="1646" y="2914.6309">The push notification needs to carry some context.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="93" x="1646" y="2929.8652">For example, the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="1742" y="2929.9731">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="81" x="1817" y="2929.8652">- to require the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="192" x="1646" y="2945.0996">consent to be correlated correctly.</text><polygon fill="#A80036" points="1979,2979.5078,1989,2983.5078,1979,2987.5078,1983,2983.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1635" x2="1985" y1="2983.5078" y2="2983.5078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="254" x="1642" y="2978.334">Send push notification to mobile banking app</text><polygon fill="#A80036" points="2134,3008.7422,2144,3012.7422,2134,3016.7422,2138,3012.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1991" x2="2140" y1="3012.7422" y2="3012.7422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="92" x="1998" y="3007.5684">Notify Customer</text><polygon fill="#A80036" points="2002,3037.9766,1992,3041.9766,2002,3045.9766,1998,3041.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1996" x2="2145" y1="3041.9766" y2="3041.9766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="2008" y="3036.8027">Tap notification</text><polygon fill="#A80036" points="2134,3082.4453,2144,3086.4453,2134,3090.4453,2138,3086.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1991" x2="2140" y1="3086.4453" y2="3086.4453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="103" x="1998" y="3066.0371">Request biometric</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="1998" y="3081.2715">gesture to authenticate</text><polygon fill="#A80036" points="2002,3126.9141,1992,3130.9141,2002,3134.9141,1998,3130.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1996" x2="2145" y1="3130.9141" y2="3130.9141"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="100" x="2008" y="3110.5059">Present biometric</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="43" x="2008" y="3125.7402">gesture</text><path d="M1406,3143.9141 L1406,3263.9141 L1774,3263.9141 L1774,3153.9141 L1764,3143.9141 L1406,3143.9141 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1764,3143.9141 L1764,3153.9141 L1774,3153.9141 L1764,3143.9141 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="330" x="1412" y="3160.9746">As with the majority of mobile banking apps authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="345" x="1412" y="3176.209">in this example is outsourced to the mobile operating system.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="347" x="1412" y="3191.4434">Once the customer has authenticated the mobile banking app</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="331" x="1412" y="3206.6777">simply sends a "user authenticated" notification to the IDP.</text><line style="stroke:#000000;stroke-width:1.0;" x1="1412" x2="1412" y1="3211.8516" y2="3211.8516"/><line style="stroke:#000000;stroke-width:1.0;" x1="1412" x2="1412" y1="3211.8516" y2="3211.8516"/><line style="stroke:#000000;stroke-width:1.0;" x1="1412" x2="1412" y1="3211.8516" y2="3211.8516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="318" x="1412" y="3225.9121">This flow is non-normative, implementation-specific and</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="325" x="1412" y="3241.1465">would be created based on the implementors architecture</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1412" y="3256.3809">and technology.</text><polygon fill="#A80036" points="1412,3290.7891,1402,3294.7891,1412,3298.7891,1408,3294.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1406" x2="1990" y1="3294.7891" y2="3294.7891"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="174" x="1418" y="3289.6152">User authenticated notification</text><polygon fill="#A80036" points="1979,3320.0234,1989,3324.0234,1979,3328.0234,1983,3324.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1401" x2="1985" y1="3324.0234" y2="3324.0234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="1408" y="3318.8496">Acknowledgement</text><polygon fill="#A80036" points="1646,3349.2578,1636,3353.2578,1646,3357.2578,1642,3353.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1640" x2="1990" y1="3353.2578" y2="3353.2578"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="161" x="1652" y="3348.084">Request Customer accounts</text><polygon fill="#A80036" points="1979,3378.4922,1989,3382.4922,1979,3386.4922,1983,3382.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1635" x2="1985" y1="3382.4922" y2="3382.4922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1642" y="3377.3184">Response</text><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2199.5" x="0" y="3411.1094"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="3411.1094" y2="3411.1094"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="3414.1094" y2="3414.1094"/><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="344" x="927.75" y="3400.4922"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="327" x="933.75" y="3416.5527">Part 3: Customer Confirms Consent and Selects Account</text><path d="M1616,3438.7266 L1616,3558.7266 L1982,3558.7266 L1982,3448.7266 L1972,3438.7266 L1616,3438.7266 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1972,3438.7266 L1972,3448.7266 L1982,3448.7266 L1972,3438.7266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="345" x="1622" y="3455.7871">As Consent needs to be retrieved from a hostile security zone</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="335" x="1622" y="3471.0215">i.e. from a Customer's mobile device the request to Consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="319" x="1622" y="3486.2559">Management should be routed via the API Gateway. This</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="1622" y="3501.4902">flow is implementation-specific and would be created</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="317" x="1622" y="3516.7246">based on the implementors architecture and technology.</text><line style="stroke:#000000;stroke-width:1.0;" x1="1622" x2="1622" y1="3521.8984" y2="3521.8984"/><line style="stroke:#000000;stroke-width:1.0;" x1="1622" x2="1622" y1="3521.8984" y2="3521.8984"/><line style="stroke:#000000;stroke-width:1.0;" x1="1622" x2="1622" y1="3521.8984" y2="3521.8984"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="275" x="1622" y="3535.959">In this example the Customer is the sole account</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="1622" y="3551.1934">holder and therefore no further authorizations are required.</text><polygon fill="#A80036" points="613,3585.6016,603,3589.6016,613,3593.6016,609,3589.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="607" x2="1990" y1="3589.6016" y2="3589.6016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="95" x="619" y="3584.4277">Retrieve consent</text><polygon fill="#A80036" points="1174,3614.8359,1184,3618.8359,1174,3622.8359,1178,3618.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1180" y1="3618.8359" y2="3618.8359"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="95" x="609" y="3613.6621">Retrieve consent</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1186" x2="1228" y1="3648.0703" y2="3648.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1228" x2="1228" y1="3648.0703" y2="3661.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1187" x2="1228" y1="3661.0703" y2="3661.0703"/><polygon fill="#A80036" points="1197,3657.0703,1187,3661.0703,1197,3665.0703,1193,3661.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="1193" y="3642.8965">Retrieve Consent</text><polygon fill="#A80036" points="613,3686.3047,603,3690.3047,613,3694.3047,609,3690.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1185" y1="3690.3047" y2="3690.3047"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="3685.1309">Response</text><polygon fill="#A80036" points="1979,3715.5391,1989,3719.5391,1979,3723.5391,1983,3719.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="602" x2="1985" y1="3719.5391" y2="3719.5391"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="609" y="3714.3652">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1991" x2="2033" y1="3764.0078" y2="3764.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2033" x2="2033" y1="3764.0078" y2="3777.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1992" x2="2033" y1="3777.0078" y2="3777.0078"/><polygon fill="#A80036" points="2002,3773.0078,1992,3777.0078,2002,3781.0078,1998,3777.0078" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1998" y="3743.5996">Render consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="1998" y="3758.834">confirmation screen</text><polygon fill="#A80036" points="2134,3817.4766,2144,3821.4766,2134,3825.4766,2138,3821.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1991" x2="2140" y1="3821.4766" y2="3821.4766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="1998" y="3801.0684">Request consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="72" x="1998" y="3816.3027">confirmation</text><polygon fill="#A80036" points="2002,3846.7109,1992,3850.7109,2002,3854.7109,1998,3850.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1996" x2="2145" y1="3850.7109" y2="3850.7109"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="94" x="2008" y="3845.5371">Confirm consent</text><path d="M1946.5,3865.7109 L2005.5,3865.7109 L2005.5,3872.7109 L1995.5,3882.7109 L1946.5,3882.7109 L1946.5,3865.7109 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="217.7656" style="stroke:#000000;stroke-width:2.0;" width="243" x="1946.5" y="3865.7109"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1961.5" y="3878.7715">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="2020.5" y="3877.916">[Account included in consent]</text><path d="M1996,3887.9453 L1996,3912.9453 L2078,3912.9453 L2078,3897.9453 L2068,3887.9453 L1996,3887.9453 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2068,3887.9453 L2068,3897.9453 L2078,3897.9453 L2068,3887.9453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="61" x="2002" y="3905.0059">Do nothing</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1946.5" x2="2189.5" y1="3923.1797" y2="3923.1797"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="140" x="1951.5" y="3933.3848">[Account selection required]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1991" x2="2033" y1="3973.5391" y2="3973.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2033" x2="2033" y1="3973.5391" y2="3986.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1992" x2="2033" y1="3986.5391" y2="3986.5391"/><polygon fill="#A80036" points="2002,3982.5391,1992,3986.5391,2002,3990.5391,1998,3986.5391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1998" y="3953.1309">Render account</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="94" x="1998" y="3968.3652">selection screen</text><polygon fill="#A80036" points="2134,4027.0078,2144,4031.0078,2134,4035.0078,2138,4031.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1991" x2="2140" y1="4031.0078" y2="4031.0078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="1998" y="4010.5996">Request account</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="52" x="1998" y="4025.834">selection</text><polygon fill="#A80036" points="2002,4071.4766,1992,4075.4766,2002,4079.4766,1998,4075.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1996" x2="2145" y1="4075.4766" y2="4075.4766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="88" x="2008" y="4055.0684">Select payment</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="46" x="2008" y="4070.3027">account</text><polygon fill="#A80036" points="613,4107.7109,603,4111.7109,613,4115.7109,609,4111.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="607" x2="1990" y1="4111.7109" y2="4111.7109"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="168" x="619" y="4106.5371">Update consent as authorized</text><polygon fill="#A80036" points="1174,4136.9453,1184,4140.9453,1174,4144.9453,1178,4140.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1180" y1="4140.9453" y2="4140.9453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="609" y="4135.7715">Update consent</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1186" x2="1228" y1="4170.1797" y2="4170.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1228" x2="1228" y1="4170.1797" y2="4183.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1187" x2="1228" y1="4183.1797" y2="4183.1797"/><polygon fill="#A80036" points="1197,4179.1797,1187,4183.1797,1197,4187.1797,1193,4183.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="90" x="1193" y="4165.0059">Update Consent</text><polygon fill="#A80036" points="613,4208.4141,603,4212.4141,613,4216.4141,609,4212.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1185" y1="4212.4141" y2="4212.4141"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="4207.2402">Response</text><polygon fill="#A80036" points="1979,4237.6484,1989,4241.6484,1979,4245.6484,1983,4241.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="602" x2="1985" y1="4241.6484" y2="4241.6484"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="609" y="4236.4746">Response</text><path d="M1661,4254.6484 L1661,4370.6484 L1982,4370.6484 L1982,4264.6484 L1972,4254.6484 L1661,4254.6484 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1972,4254.6484 L1972,4264.6484 L1982,4264.6484 L1972,4254.6484 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="272" x="1667" y="4271.709">The final step is to call the Identity Management</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="285" x="1667" y="4286.9434">component to indicate that the Customer has been</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="291" x="1667" y="4302.1777">authenticated. Identity Management will then signal</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="282" x="1667" y="4317.4121">to the Third-Party App using the chosen mode that</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="253" x="1667" y="4332.6465">authentication is complete. Again this flow is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="300" x="1667" y="4347.8809">implementation-specific and would be created based</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="279" x="1667" y="4363.1152">on the implementors architecture and technology.</text><polygon fill="#A80036" points="613,4397.5234,603,4401.5234,613,4405.5234,609,4401.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="607" x2="1990" y1="4401.5234" y2="4401.5234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="205" x="619" y="4396.3496">Authentication complete notification</text><polygon fill="#A80036" points="965,4426.7578,975,4430.7578,965,4434.7578,969,4430.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="4430.7578" y2="4430.7578"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="253" x="609" y="4425.584">Forward authentication complete notification</text><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2199.5" x="0" y="4459.375"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="4459.375" y2="4459.375"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="4462.375" y2="4462.375"/><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="226" x="986.75" y="4448.7578"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="209" x="992.75" y="4464.8184">Part 4: Client Granted Access Token</text><path d="M79,4486.9922 L79,4679.9922 L485,4679.9922 L485,4496.9922 L475,4486.9922 L79,4486.9922 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M475,4486.9922 L475,4496.9922 L485,4496.9922 L475,4486.9922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="148" x="85" y="4504.0527">Notes on Token behaviors</text><line style="stroke:#A80036;stroke-width:1.0;" x1="80" x2="484" y1="4507.2266" y2="4507.2266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="80" x2="484" y1="4509.2266" y2="4509.2266"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="4523.2871">The Third-Party App is made aware of the success of the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="318" x="85" y="4538.5215">based on their registered delivery mode. Each of these is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="78" x="85" y="4553.7559">shown below.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4558.9297" y2="4558.9297"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4558.9297" y2="4558.9297"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4558.9297" y2="4558.9297"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="85" y="4572.9902">Note that the Poll looping example is purely illustrative</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="85" y="4588.2246">as the Third-Party App would poll as soon as they received</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="18" x="85" y="4603.459">the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="106" y="4603.5669">auth_req_id</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="197" x="197" y="4603.459">from the AS. Writing the diagram to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="385" x="85" y="4618.6934">incorporate this sequentially would, however be extremely confusing</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="196" x="85" y="4633.9277">hence the sequence shown below.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4639.1016" y2="4639.1016"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4639.1016" y2="4639.1016"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4639.1016" y2="4639.1016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="317" x="85" y="4653.1621">For Poll and Ping mode the Third-Party App must use the</text><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="87" x="85" y="4668.3965">CIBA grant type</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="229" x="175" y="4668.3965">as described in the source specification.</text><path d="M10,4696.5703 L69,4696.5703 L69,4703.5703 L59,4713.5703 L10,4713.5703 L10,4696.5703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1587.6797" style="stroke:#000000;stroke-width:2.0;" width="1956.5" x="10" y="4696.5703"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="25" y="4709.6309">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="145" x="84" y="4708.7754">[Client Registered Poll Mode]</text><path d="M79,4718.8047 L79,4788.8047 L474,4788.8047 L474,4728.8047 L464,4718.8047 L79,4718.8047 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M464,4718.8047 L464,4728.8047 L474,4728.8047 L464,4718.8047 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="342" x="85" y="4735.8652">In Poll mode the TPP will periodically call the Token endpoint</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="85" y="4751.0996">until they get a positive response i.e. they do not receive</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="374" x="85" y="4766.334">the 400 HTTP response code but instead are returned one-or-more</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="309" x="85" y="4781.5684">tokens (Access, Refresh, ID) from the Token endpoint.</text><path d="M20,4805.7422 L89,4805.7422 L89,4812.7422 L79,4822.7422 L20,4822.7422 L20,4805.7422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="335.1719" style="stroke:#000000;stroke-width:2.0;" width="1936.5" x="20" y="4805.7422"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="35" y="4818.8027">loop</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="232" x="104" y="4817.9473">[Exit when Authentication Request successful]</text><polygon fill="#A80036" points="326,4840.1094,336,4844.1094,326,4848.1094,330,4844.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="4844.1094" y2="4844.1094"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="4839.0435">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1878,4869.3438,1888,4873.3438,1878,4877.3438,1882,4873.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="4873.3438" y2="4873.3438"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="4868.1699">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,4898.5781,339,4902.5781,349,4906.5781,345,4902.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="4902.5781" y2="4902.5781"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="4897.4043">Response</text><polygon fill="#A80036" points="590,4927.8125,600,4931.8125,590,4935.8125,594,4931.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="4931.8125" y2="4931.8125"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="4926.6387">Forward token request</text><polygon fill="#A80036" points="965,4957.0469,975,4961.0469,965,4965.0469,969,4961.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="4961.0469" y2="4961.0469"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="609" y="4955.873">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="4990.2813" y2="4990.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="4990.2813" y2="5003.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="5003.2813" y2="5003.2813"/><polygon fill="#A80036" points="988,4999.2813,978,5003.2813,988,5007.2813,984,5003.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="984" y="4985.1074">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="5032.5156" y2="5032.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="5032.5156" y2="5045.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="5045.5156" y2="5045.5156"/><polygon fill="#A80036" points="988,5041.5156,978,5045.5156,988,5049.5156,984,5045.5156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="75" x="984" y="5027.3418">Check status</text><polygon fill="#A80036" points="613,5070.6484,603,5074.6484,613,5078.6484,609,5074.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="976" y1="5074.6484" y2="5074.6484"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="619" y="5069.5825">400 Bad Request {...}</text><polygon fill="#A80036" points="349,5099.7813,339,5103.7813,349,5107.7813,345,5103.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="5103.7813" y2="5103.7813"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="355" y="5098.7153">400 Bad Request {...}</text><polygon fill="#A80036" points="85,5128.9141,75,5132.9141,85,5136.9141,81,5132.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="5132.9141" y2="5132.9141"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="91" y="5127.8481">400 Bad Request {...}</text><polygon fill="#A80036" points="326,5165.0469,336,5169.0469,326,5173.0469,330,5169.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="5169.0469" y2="5169.0469"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="5163.981">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1878,5194.2813,1888,5198.2813,1878,5202.2813,1882,5198.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="5198.2813" y2="5198.2813"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="5193.1074">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,5223.5156,339,5227.5156,349,5231.5156,345,5227.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="5227.5156" y2="5227.5156"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="5222.3418">Response</text><polygon fill="#A80036" points="590,5252.75,600,5256.75,590,5260.75,594,5256.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="5256.75" y2="5256.75"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="5251.5762">Forward token request</text><polygon fill="#A80036" points="965,5281.9844,975,5285.9844,965,5289.9844,969,5285.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="5285.9844" y2="5285.9844"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="609" y="5280.8105">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="5315.2188" y2="5315.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="5315.2188" y2="5328.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="5328.2188" y2="5328.2188"/><polygon fill="#A80036" points="988,5324.2188,978,5328.2188,988,5332.2188,984,5328.2188" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="984" y="5310.0449">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="5357.4531" y2="5357.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="5357.4531" y2="5370.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="5370.4531" y2="5370.4531"/><polygon fill="#A80036" points="988,5366.4531,978,5370.4531,988,5374.4531,984,5370.4531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="75" x="984" y="5352.2793">Check status</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="5399.6875" y2="5399.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="5399.6875" y2="5412.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="5412.6875" y2="5412.6875"/><polygon fill="#A80036" points="988,5408.6875,978,5412.6875,988,5416.6875,984,5412.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="984" y="5394.5137">Create tokens</text><polygon fill="#A80036" points="613,5437.8203,603,5441.8203,613,5445.8203,609,5441.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="976" y1="5441.8203" y2="5441.8203"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="619" y="5436.7544">200 OK {...}</text><polygon fill="#A80036" points="349,5466.9531,339,5470.9531,349,5474.9531,345,5470.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="5470.9531" y2="5470.9531"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="355" y="5465.8872">200 OK {...}</text><polygon fill="#A80036" points="85,5496.0859,75,5500.0859,85,5504.0859,81,5500.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="5500.0859" y2="5500.0859"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="91" y="5495.02">200 OK {...}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1966.5" y1="5509.0859" y2="5509.0859"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="148" x="15" y="5519.291">[Client Registered Ping Mode]</text><path d="M79,5527.9766 L79,5597.9766 L463,5597.9766 L463,5537.9766 L453,5527.9766 L79,5527.9766 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,5527.9766 L453,5537.9766 L463,5537.9766 L453,5527.9766 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="5545.0371">Ping mode is a simple notification by the AS to a callback</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="85" y="5560.2715">URL pre-registered by the Third-Party App in Part 0. On</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="337" x="85" y="5575.5059">receipt the Third-Party App can then call the Token endpoint</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="5590.7402">in the same way as in Poll mode and collect one-or-more tokens.</text><polygon fill="#A80036" points="85,5625.1484,75,5629.1484,85,5633.1484,81,5629.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79" x2="976" y1="5629.1484" y2="5629.1484"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="255" x="91" y="5623.9746">Authentication Request complete notification</text><polygon fill="#A80036" points="965,5654.2813,975,5658.2813,965,5662.2813,969,5658.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="74" x2="971" y1="5658.2813" y2="5658.2813"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="81" y="5653.2153">204 No Content</text><polygon fill="#A80036" points="326,5683.4141,336,5687.4141,326,5691.4141,330,5687.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="5687.4141" y2="5687.4141"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="5682.3481">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1878,5712.6484,1888,5716.6484,1878,5720.6484,1882,5716.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="5716.6484" y2="5716.6484"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="5711.4746">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,5741.8828,339,5745.8828,349,5749.8828,345,5745.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="5745.8828" y2="5745.8828"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="5740.709">Response</text><polygon fill="#A80036" points="590,5771.1172,600,5775.1172,590,5779.1172,594,5775.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="5775.1172" y2="5775.1172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="5769.9434">Forward token request</text><polygon fill="#A80036" points="965,5800.3516,975,5804.3516,965,5808.3516,969,5804.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="5804.3516" y2="5804.3516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="609" y="5799.1777">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="5833.5859" y2="5833.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="5833.5859" y2="5846.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="5846.5859" y2="5846.5859"/><polygon fill="#A80036" points="988,5842.5859,978,5846.5859,988,5850.5859,984,5846.5859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="984" y="5828.4121">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="5875.8203" y2="5875.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="5875.8203" y2="5888.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="5888.8203" y2="5888.8203"/><polygon fill="#A80036" points="988,5884.8203,978,5888.8203,988,5892.8203,984,5888.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="984" y="5870.6465">Create tokens</text><polygon fill="#A80036" points="613,5913.9531,603,5917.9531,613,5921.9531,609,5917.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="976" y1="5917.9531" y2="5917.9531"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="619" y="5912.8872">200 OK {...}</text><polygon fill="#A80036" points="349,5943.0859,339,5947.0859,349,5951.0859,345,5947.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="5947.0859" y2="5947.0859"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="355" y="5942.02">200 OK {...}</text><polygon fill="#A80036" points="85,5972.2188,75,5976.2188,85,5980.2188,81,5976.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="5976.2188" y2="5976.2188"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="91" y="5971.1528">200 OK {...}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1966.5" y1="5985.2188" y2="5985.2188"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151" x="15" y="5995.4238">[Client Registered Push Mode]</text><path d="M79,6004.1094 L79,6074.1094 L463,6074.1094 L463,6014.1094 L453,6004.1094 L79,6004.1094 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,6004.1094 L453,6014.1094 L463,6014.1094 L453,6004.1094 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="6021.1699">In Push mode tokens are created by the AS and then transmitted</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="349" x="85" y="6036.4043">to the Third-Party App, therefore negating the need for them to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="356" x="85" y="6051.6387">visit the Token endpoint. Their are various implications of using</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="221" x="85" y="6066.873">this method which are discussed in the</text><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="74" x="309" y="6066.873">specification</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="383" y="6066.873">.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="6105.2813" y2="6105.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="6105.2813" y2="6118.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="6118.2813" y2="6118.2813"/><polygon fill="#A80036" points="988,6114.2813,978,6118.2813,988,6122.2813,984,6118.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="984" y="6100.1074">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="6147.5156" y2="6147.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="6147.5156" y2="6160.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="6160.5156" y2="6160.5156"/><polygon fill="#A80036" points="988,6156.5156,978,6160.5156,988,6164.5156,984,6160.5156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="984" y="6142.3418">Create tokens</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="6204.9844" y2="6204.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="6204.9844" y2="6217.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="6217.9844" y2="6217.9844"/><polygon fill="#A80036" points="988,6213.9844,978,6217.9844,988,6221.9844,984,6217.9844" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="195" x="984" y="6184.5762">Retrieve callback URL and security</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="141" x="984" y="6199.8105">token for Third-Party App</text><polygon fill="#A80036" points="85,6243.1172,75,6247.1172,85,6251.1172,81,6247.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79" x2="976" y1="6247.1172" y2="6247.1172"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="91" y="6242.0513">POST /cb {...}</text><polygon fill="#A80036" points="965,6272.25,975,6276.25,965,6280.25,969,6276.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="74" x2="971" y1="6276.25" y2="6276.25"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="81" y="6271.1841">204 No Content</text><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2199.5" x="0" y="6311.8672"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="6311.8672" y2="6311.8672"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2199.5" y1="6314.8672" y2="6314.8672"/><rect fill="#EEEEEE" filter="url(#f1fpw6yyoa51cs)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="293" x="953.25" y="6301.25"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="276" x="959.25" y="6317.3105">Part 5: TPP Makes Payment Instruction Request</text><path d="M79,6339.4844 L79,6409.4844 L438,6409.4844 L438,6349.4844 L428,6339.4844 L79,6339.4844 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M428,6339.4844 L428,6349.4844 L438,6349.4844 L428,6339.4844 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="338" x="85" y="6356.5449">With the Access Token in hand the Third-Party App can now</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="327" x="85" y="6371.7793">make the payment instruction request. The Access Token</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="321" x="85" y="6387.0137">is bound to this single operation and will be revoked once</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="293" x="85" y="6402.248">the payment instruction is successfully transmitted.</text><polygon fill="#A80036" points="326,6436.5547,336,6440.5547,326,6444.5547,330,6440.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="6440.5547" y2="6440.5547"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="81" y="6435.4888">POST /payments/v1/pix/payments</text><polygon fill="#A80036" points="1878,6465.7891,1888,6469.7891,1878,6473.7891,1882,6469.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1884" y1="6469.7891" y2="6469.7891"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="6464.6152">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,6495.0234,339,6499.0234,349,6503.0234,345,6499.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1889" y1="6499.0234" y2="6499.0234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="6493.8496">Response</text><polygon fill="#A80036" points="590,6524.1563,600,6528.1563,590,6532.1563,594,6528.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="6528.1563" y2="6528.1563"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="345" y="6523.0903">POST /payments/v1/pix/payments</text><path d="M607,6541.1563 L607,6611.1563 L952,6611.1563 L952,6551.1563 L942,6541.1563 L607,6541.1563 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M942,6541.1563 L942,6551.1563 L952,6551.1563 L942,6541.1563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="324" x="613" y="6558.2168">The approach to Access Token introspection remains the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="613" y="6573.4512">same under Payments i.e. the API Gateway will need an</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="613" y="6588.6855">assertion that indicates the consent granted by the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="278" x="613" y="6603.9199">Customer matches the payment being instructed.</text><polygon fill="#A80036" points="965,6638.3281,975,6642.3281,965,6646.3281,969,6642.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="971" y1="6642.3281" y2="6642.3281"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="143" x="609" y="6637.1543">Introspect Access Token</text><line style="stroke:#A80036;stroke-width:1.0;" x1="977" x2="1019" y1="6671.5625" y2="6671.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1019" x2="1019" y1="6671.5625" y2="6684.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="978" x2="1019" y1="6684.5625" y2="6684.5625"/><polygon fill="#A80036" points="988,6680.5625,978,6684.5625,988,6688.5625,984,6684.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="191" x="984" y="6666.3887">Retrieve Access Token properties</text><polygon fill="#A80036" points="613,6709.7969,603,6713.7969,613,6717.7969,609,6713.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="976" y1="6713.7969" y2="6713.7969"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="6708.623">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="644" y1="6743.0313" y2="6743.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644" x2="644" y1="6743.0313" y2="6756.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="603" x2="644" y1="6756.0313" y2="6756.0313"/><polygon fill="#A80036" points="613,6752.0313,603,6756.0313,613,6760.0313,609,6756.0313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="125" x="609" y="6737.8574">Apply access controls</text><polygon fill="#A80036" points="854,6781.1641,864,6785.1641,854,6789.1641,858,6785.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="860" y1="6785.1641" y2="6785.1641"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="609" y="6780.0981">POST /payments/v1/pix/payments</text><path d="M871,6798.1641 L871,6853.1641 L1273,6853.1641 L1273,6808.1641 L1263,6798.1641 L871,6798.1641 " fill="#FBFB77" filter="url(#f1fpw6yyoa51cs)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1263,6798.1641 L1263,6808.1641 L1273,6808.1641 L1263,6798.1641 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="377" x="877" y="6815.2246">This flow is non-normative and will vary on customer requirements.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="8" x="877" y="6830.459">It</text><text fill="#000000" font-family="Roboto" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="31" x="888" y="6830.459">could</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="336" x="922" y="6830.459">be to a PIX-compliant API or any other available mechanism</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="877" y="6845.6934">to make a PIX payment.</text><polygon fill="#A80036" points="1623,6880.1016,1633,6884.1016,1623,6888.1016,1627,6884.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="866" x2="1629" y1="6884.1016" y2="6884.1016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="873" y="6878.9277">Deliver payment instruction to Banking System API</text><polygon fill="#A80036" points="877,6909.3359,867,6913.3359,877,6917.3359,873,6913.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="871" x2="1634" y1="6913.3359" y2="6913.3359"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="883" y="6908.1621">Response</text><polygon fill="#A80036" points="613,6953.6016,603,6957.6016,613,6961.6016,609,6957.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="865" y1="6957.6016" y2="6957.6016"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="619" y="6937.4028">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="619" y="6952.5356">{paymentId: "..."}</text><polygon fill="#A80036" points="349,6997.8672,339,7001.8672,349,7005.8672,345,7001.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="7001.8672" y2="7001.8672"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="6981.6685">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="355" y="6996.8013">{paymentId: "..."}</text><polygon fill="#A80036" points="85,7042.1328,75,7046.1328,85,7050.1328,81,7046.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="7046.1328" y2="7046.1328"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="7025.9341">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="91" y="7041.0669">{paymentId: "..."}</text><!--MD5=[96a477d2640443d45e35c8d27a262890]
@startuml CIBA_Example_Sequence

title \n\n\n
hide footbox

participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666
participant "Ingress\nController" as INGRESS
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
participant "Consent\nManagement" as CONSENT
end box

box Core Banking Applications #d5a6bd
participant "Banking\nIdentity\nProvider" as ASPSP_IDP
participant "Banking\nSystems" as ASPSP_API
end box

participant "Open Banking\nDirectory\n- - -\nJSON Web Key Set" as OBD_JWKS
participant "Certificate\nAuthority\n- - -\nOCSP Endpoint" as OCSP
participant "Mobile\nBanking\nApp" as MOBILE
actor "Customer" as PSU

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

== Part 0: Registration of Token Delivery Preferences ==

note right of TPP
CIBA requires that Clients register a delivery mode prior to the
transmission of any Authentication Requests:
|||
[[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4 Clients registering to use CIBA MUST indicate a token delivery mode]]
|||
The Authorization Server (AS) therefore must host a registration
endpoint - defined in the discoverable OpenID Configuration -
that allows the Client to do so. The parameters for this call
are described in the CIBA specification and differ depending
on the method in question. The modes are:
|||
* **Poll**: Client polls the Token endpoint.
* **Ping**: AS notifies, Client retrieves from Token endpoint.
* **Push**: AS sends tokens to Client.
|||
The supported modes vary by AS as they are implementor specific i.e.
implementors of the AS can choose to only support one-or-more given
modes. The supported modes must be made pushed in the AS OpenID
Configuration.
end note

TPP -> INGRESS: ""POST /connect/register""

note right of INGRESS
The Kubernetes Ingress Controller is responsible for TLS
termination and perfoming an OCSP call to the Certificate
Authority to ensure the client certificate presented is
valid. The fingerprint of the certificate will be forwarded
to Identity Management to verify the validity of the OAuth
Client as this cannot be asserted via OCSP.
end note

INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Registration Request

note right of API_GATEWAY
The API Gateway acts as a proxy for both Identity and Consent
Management. This approach is designed to ensure all identity
and access control can be monitored and logged for analytics purposes
end note

API_GATEWAY -> IAM: Registration Request
IAM -> IAM: Verify Client
IAM -> IAM: Store Client Parameters
API_GATEWAY <- - IAM: Response
INGRESS <- - API_GATEWAY: Response
TPP <- - INGRESS: Response

== Part 1: Create Consent and Send Authentication Request ==

note right of TPP
The Third-Party App requests an Access Token using
the Client Credentials grant type. Nominally authentication
is through Mutual Authentication over TLS but it could
equally be using ""private_key_jwt"".
end note

TPP -> INGRESS: ""POST /token""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Access Token request
API_GATEWAY -> IAM: Access Token request
IAM -> IAM: Verify Client
API_GATEWAY <- IAM: Issue Access Token
INGRESS <- - API_GATEWAY: ""200 OK""\n""{"access_token": "..."}""
TPP <- - INGRESS: ""200 OK""\n""{"access_token": "..."}""

note right of TPP
With the Access Token in hand the Third-Party can then
create the consent resource. This needs to be completed
before the Authentication Request as the value of the
""consentId"" is required to set the value of the scope.
end note

TPP -> INGRESS: ""POST /payments/v1/consents""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: ""POST /payments/v1/consents""
API_GATEWAY -> CONSENT: ""POST /payments/v1/consents""
CONSENT -> CONSENT: Validate consent request properties
API_GATEWAY <- - CONSENT: ""201 Created""\n""{consentId: "..."}""
INGRESS <- - API_GATEWAY: ""201 Created""\n""{consentId: "..."}""
TPP <- - INGRESS: ""201 Created""\n""{consentId: "..."}""

note right of TPP
The Third-Party App can now create and send the Authentication
Request. This includes the dynamic scope that holds the value 
of the ""consentId"" returned by Identity Management.
end note

TPP -> TPP: Create Authentication Request
TPP -> INGRESS: ""POST /bc-authorize""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: ""POST /bc-authorize""

note right of API_GATEWAY
As with the redirection-based FAPI profiles the Authentication
Request is a JSON Web Signature. It therefore needs to be
checked for validity. Note that in the context of CIBA Pushed
Authorization Request is not required as the Authentication Request
is always sent via a secured backchannel and never through the browser.
end note

API_GATEWAY -> OBD_JWKS: Get JSON Web Key Set
API_GATEWAY <- - OBD_JWKS: Response
API_GATEWAY -> API_GATEWAY: Match Authentication\nRequest parameter ""kid""
API_GATEWAY -> API_GATEWAY: Verify Authentication\nRequest parameter signature
API_GATEWAY -> IAM: Forward Authentication Request
IAM -> IAM: Validate Authentication Request

note right of IAM
Note this approach is non-normative and the actual
implementation required should be considered on a
case-by-case basis.
end note

IAM -> ASPSP_IDP: Send Authentication Request notification
API_GATEWAY <- - IAM: ""201 Created""\n""{auth_req_id: "..."}""
INGRESS <- - API_GATEWAY: ""201 Created""\n""{auth_req_id: "..."}""
TPP <- - INGRESS: ""201 Created""\n""{auth_req_id: "..."}""

== Part 2: Customer Authenticates at Mobile Banking App ==

note right of ASPSP_IDP
The flow shown is a hypothetical approach to allowing
the End User to authenticate and confirm consent. In this
scenario has installed their mobile banking app and can
receive and act-on a request to authenticate and confirm
consent.
end note

ASPSP_IDP -> ASPSP_IDP: Correlate Authentication\nRequest with Customer
ASPSP_IDP -> ASPSP_API: Trigger push notification to Customer

note right of ASPSP_API
The push notification needs to carry some context.
For example, the ""consentId"" - to require the
consent to be correlated correctly.
end note

MOBILE <- ASPSP_API: Send push notification to mobile banking app
MOBILE -> PSU: Notify Customer

MOBILE <- - PSU: Tap notification
MOBILE -> PSU: Request biometric\ngesture to authenticate
MOBILE <- - PSU: Present biometric\ngesture

note right of ASPSP_IDP
As with the majority of mobile banking apps authentication
in this example is outsourced to the mobile operating system.
Once the customer has authenticated the mobile banking app
simply sends a "user authenticated" notification to the IDP.
|||
This flow is non-normative, implementation-specific and 
would be created based on the implementors architecture
and technology. 
end note

MOBILE -> ASPSP_IDP: User authenticated notification
MOBILE <- - ASPSP_IDP: Acknowledgement
MOBILE -> ASPSP_API: Request Customer accounts
MOBILE <- - ASPSP_API: Response

== Part 3: Customer Confirms Consent and Selects Account ==

note left of MOBILE
As Consent needs to be retrieved from a hostile security zone
i.e. from a Customer's mobile device the request to Consent
Management should be routed via the API Gateway. This
flow is implementation-specific and would be created
based on the implementors architecture and technology.
|||
In this example the Customer is the sole account
holder and therefore no further authorizations are required.
end note

MOBILE -> API_GATEWAY: Retrieve consent
API_GATEWAY -> CONSENT: Retrieve consent
CONSENT -> CONSENT: Retrieve Consent
API_GATEWAY <- - CONSENT: Response
MOBILE <- - API_GATEWAY: Response
MOBILE -> MOBILE: Render consent\nconfirmation screen
MOBILE -> PSU: Request consent\nconfirmation
MOBILE <- - PSU: Confirm consent

alt Account included in consent

note right of MOBILE
Do nothing
end note

else Account selection required
MOBILE -> MOBILE: Render account\nselection screen
MOBILE -> PSU: Request account\nselection
MOBILE <- - PSU: Select payment\naccount
end alt

MOBILE -> API_GATEWAY: Update consent as authorized
API_GATEWAY -> CONSENT: Update consent
CONSENT -> CONSENT: Update Consent
API_GATEWAY <- - CONSENT: Response
MOBILE <- - API_GATEWAY: Response

note left of MOBILE
The final step is to call the Identity Management
component to indicate that the Customer has been
authenticated. Identity Management will then signal
to the Third-Party App using the chosen mode that
authentication is complete. Again this flow is
implementation-specific and would be created based
on the implementors architecture and technology.
end note

MOBILE -> API_GATEWAY: Authentication complete notification
API_GATEWAY -> IAM: Forward authentication complete notification

== Part 4: Client Granted Access Token ==

note right of TPP
Notes on Token behaviors
===
The Third-Party App is made aware of the success of the
based on their registered delivery mode. Each of these is
shown below.
|||
Note that the Poll looping example is purely illustrative
as the Third-Party App would poll as soon as they received
the ""auth_req_id"" from the AS. Writing the diagram to
incorporate this sequentially would, however be extremely confusing
hence the sequence shown below.
|||
For Poll and Ping mode the Third-Party App must use the
[[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1 CIBA grant type]] as described in the source specification.
end note

alt Client Registered Poll Mode

note right of TPP
In Poll mode the TPP will periodically call the Token endpoint
until they get a positive response i.e. they do not receive
the 400 HTTP response code but instead are returned one-or-more
tokens (Access, Refresh, ID) from the Token endpoint.
end note

loop Exit when Authentication Request successful
TPP -> INGRESS: ""POST /token auth_req_id=...""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Forward token request
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Check status
API_GATEWAY <- - IAM: ""400 Bad Request {...}""
INGRESS <- - API_GATEWAY: ""400 Bad Request {...}""
TPP <- - INGRESS: ""400 Bad Request {...}""
end loop

TPP -> INGRESS: ""POST /token auth_req_id=...""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Forward token request
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Check status
IAM -> IAM: Create tokens
API_GATEWAY <- - IAM: ""200 OK {...}""
INGRESS <- - API_GATEWAY: ""200 OK {...}""
TPP <- - INGRESS: ""200 OK {...}""

else Client Registered Ping Mode

note right of TPP
Ping mode is a simple notification by the AS to a callback
URL pre-registered by the Third-Party App in Part 0. On
receipt the Third-Party App can then call the Token endpoint
in the same way as in Poll mode and collect one-or-more tokens.
end note

TPP <- IAM: Authentication Request complete notification
TPP - -> IAM: ""204 No Content""

TPP -> INGRESS: ""POST /token auth_req_id=...""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Forward token request
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Create tokens
API_GATEWAY <- - IAM: ""200 OK {...}""
INGRESS <- - API_GATEWAY: ""200 OK {...}""
TPP <- - INGRESS: ""200 OK {...}""

else Client Registered Push Mode

note right of TPP
In Push mode tokens are created by the AS and then transmitted
to the Third-Party App, therefore negating the need for them to
visit the Token endpoint. Their are various implications of using
this method which are discussed in the [[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3 specification]].
end note

IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Create tokens
IAM -> IAM: Retrieve callback URL and security\ntoken for Third-Party App

TPP <- IAM: ""POST /cb {...}""
TPP - -> IAM: ""204 No Content""

end alt

== Part 5: TPP Makes Payment Instruction Request ==

note right of TPP
With the Access Token in hand the Third-Party App can now
make the payment instruction request. The Access Token
is bound to this single operation and will be revoked once
the payment instruction is successfully transmitted.
end note

TPP -> INGRESS: ""POST /payments/v1/pix/payments""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: ""POST /payments/v1/pix/payments""

note right of API_GATEWAY
The approach to Access Token introspection remains the
same under Payments i.e. the API Gateway will need an
assertion that indicates the consent granted by the
Customer matches the payment being instructed.
end note

API_GATEWAY -> IAM: Introspect Access Token
IAM -> IAM: Retrieve Access Token properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Apply access controls
API_GATEWAY -> API_BUILDER: ""POST /payments/v1/pix/payments""

note right of API_BUILDER
This flow is non-normative and will vary on customer requirements.
It //could// be to a PIX-compliant API or any other available mechanism
to make a PIX payment.
end note

API_BUILDER -> ASPSP_API: Deliver payment instruction to Banking System API
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: ""201 Created""\n""{paymentId: "..."}""
INGRESS <- - API_GATEWAY: ""201 Created""\n""{paymentId: "..."}""
TPP <- - INGRESS: ""201 Created""\n""{paymentId: "..."}""


@enduml

PlantUML version 1.2021.7(Sun May 23 13:40:07 BST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>