<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="7761px" preserveAspectRatio="none" style="width:2394px;height:7761px;background:#FFFFFF;" version="1.1" viewBox="0 0 2394 7761" width="2394px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vhmagji47d6w" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1195.75" y="28.6992"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1195.75" y="49.793"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1195.75" y="70.8867"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="1195.75" y="91.9805"/><rect fill="#6FA8DC" height="7644.2578" style="stroke:#A80036;stroke-width:1.0;" width="348.5" x="294.5" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81" x="426.75" y="116.4355">Infrastructure</text><rect fill="#94C47D" height="7644.2578" style="stroke:#A80036;stroke-width:1.0;" width="343" x="799.5" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="890" y="116.4355">Identity and Access Control</text><rect fill="#E06666" height="7644.2578" style="stroke:#A80036;stroke-width:1.0;" width="119" x="1268.5" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="1271.5" y="116.4355">Open Banking APIs</text><rect fill="#D5A6BD" height="7644.2578" style="stroke:#A80036;stroke-width:1.0;" width="312.5" x="1477" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="1556.25" y="116.4355">Core Banking Applications</text><rect fill="#FFFFFF" filter="url(#f1vhmagji47d6w)" height="463.1094" style="stroke:#000000;stroke-width:2.0;" width="659.5" x="1704.5" y="3924.8203"/><rect fill="#FFFFFF" height="348.1719" style="stroke:none;stroke-width:1.0;" width="659.5" x="1704.5" y="4039.7578"/><rect fill="#FFFFFF" filter="url(#f1vhmagji47d6w)" height="332.1719" style="stroke:#000000;stroke-width:2.0;" width="609" x="1745" y="4048.7578"/><rect fill="#FFFFFF" height="142.0625" style="stroke:none;stroke-width:1.0;" width="609" x="1745" y="4238.8672"/><rect fill="#FFFFFF" filter="url(#f1vhmagji47d6w)" height="1587.6797" style="stroke:#000000;stroke-width:2.0;" width="2071.5" x="10" y="5190.6641"/><rect fill="#FFFFFF" filter="url(#f1vhmagji47d6w)" height="335.1719" style="stroke:#000000;stroke-width:2.0;" width="2051.5" x="20" y="5299.8359"/><rect fill="#FFFFFF" height="476.1328" style="stroke:none;stroke-width:1.0;" width="2071.5" x="10" y="6002.1797"/><rect fill="#FFFFFF" height="300.0313" style="stroke:none;stroke-width:1.0;" width="2071.5" x="10" y="6478.3125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="74" x2="74" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="337.5" x2="337.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="602" x2="602" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="878.5" x2="878.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1087.5" x2="1087.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1327.5" x2="1327.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1516" x2="1516" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1749.5" x2="1749.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1871.5" x2="1871.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2004.5" x2="2004.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2105.5" x2="2105.5" y1="208.2344" y2="7754.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2348.5" x2="2348.5" y1="208.2344" y2="7754.6328"/><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="84" x="30" y="156.4219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="37" y="176.4102">Third-Party</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="59.5" y="192.8164">App</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="75" x="298.5" y="156.4219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="46" x="313" y="176.4102">Ingress</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="61" x="305.5" y="192.8164">Controller</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="70" x="565" y="156.4219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="589" y="176.4102">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="572" y="192.8164">Gateway</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="147" x="803.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="133" x="810.5" y="160.0039">Identity Management</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="871" y="176.4102">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="127" x="813.5" y="192.8164">Authorisation Server</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="79.625" style="stroke:#A80036;stroke-width:1.5;" width="97" x="1037.5" y="123.6094"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="1060" y="143.5977">Consent</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="1044.5" y="160.0039">Management</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="1080" y="176.4102">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="1075" y="192.8164">API</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="57" x="1297.5" y="156.4219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="1315" y="176.4102">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="43" x="1304.5" y="192.8164">Builder</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="66" x="1481" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1488.5" y="160.0039">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="1490.5" y="176.4102">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="1488" y="192.8164">Provider</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1714.5" y="156.4219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1722.5" y="176.4102">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="53" x="1721.5" y="192.8164">Systems</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="79.625" style="stroke:#A80036;stroke-width:1.5;" width="129" x="1805.5" y="123.6094"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="87" x="1826.5" y="143.5977">Open Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="1842" y="160.0039">Directory</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="1864" y="176.4102">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="115" x="1812.5" y="192.8164">JSON Web Key Set</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="79.625" style="stroke:#A80036;stroke-width:1.5;" width="109" x="1948.5" y="123.6094"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="64" x="1971" y="143.5977">Certificate</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="58" x="1974" y="160.0039">Authority</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="1997" y="176.4102">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="95" x="1955.5" y="192.8164">OCSP Endpoint</text><rect fill="#FEFECE" filter="url(#f1vhmagji47d6w)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="65" x="2071.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="41" x="2083.5" y="160.0039">Mobile</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="2078.5" y="176.4102">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="2091.5" y="192.8164">App</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="61" x="2315.5" y="204.8164">Customer</text><ellipse cx="2349" cy="134.8281" fill="#FEFECE" filter="url(#f1vhmagji47d6w)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M2349,142.8281 L2349,169.8281 M2336,150.8281 L2362,150.8281 M2349,169.8281 L2336,184.8281 M2349,169.8281 L2362,184.8281 " fill="none" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2387.5" x="0" y="238.8516"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="238.8516" y2="238.8516"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="241.8516" y2="241.8516"/><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="306" x="1040.75" y="228.2344"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="289" x="1046.75" y="244.2949">Part 0: Registration of Token Delivery Preferences</text><path d="M79,266.4688 L79,520.4688 L497,520.4688 L497,276.4688 L487,266.4688 L79,266.4688 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M487,266.4688 L487,276.4688 L497,276.4688 L487,266.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="344" x="85" y="283.5293">CIBA requires that Clients register a delivery mode prior to the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="257" x="85" y="298.7637">transmission of any Authentication Requests:</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="303.9375" y2="303.9375"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="303.9375" y2="303.9375"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="303.9375" y2="303.9375"/><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="383" x="85" y="317.998">Clients registering to use CIBA MUST indicate a token delivery mode</text></a><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="323.1719" y2="323.1719"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="323.1719" y2="323.1719"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="323.1719" y2="323.1719"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="358" x="85" y="337.2324">The Authorization Server (AS) therefore must host a registration</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="343" x="85" y="352.4668">endpoint - defined in the discoverable OpenID Configuration -</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="85" y="367.7012">that allows the Client to do so. The parameters for this call</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="339" x="85" y="382.9355">are described in the CIBA specification and differ depending</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="240" x="85" y="398.1699">on the method in question. The modes are:</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="403.3438" y2="403.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="403.3438" y2="403.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="403.3438" y2="403.3438"/><ellipse cx="90.5" cy="413.0781" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="97" y="417.4043">Poll</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="183" x="118" y="417.4043">: Client polls the Token endpoint.</text><ellipse cx="90.5" cy="428.3125" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="97" y="432.6387">Ping</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="282" x="122" y="432.6387">: AS notifies, Client retrieves from Token endpoint.</text><ellipse cx="90.5" cy="443.5469" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="97" y="447.873">Push</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="154" x="126" y="447.873">: AS sends tokens to Client.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="453.0469" y2="453.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="453.0469" y2="453.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="453.0469" y2="453.0469"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="392" x="85" y="467.1074">The supported modes vary by AS as they are implementor specific i.e.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="393" x="85" y="482.3418">implementors of the AS can choose to only support one-or-more given</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="397" x="85" y="497.5762">modes. The supported modes must be made pushed in the AS OpenID</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="85" y="512.8105">Configuration.</text><polygon fill="#A80036" points="326,547.1172,336,551.1172,326,555.1172,330,551.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="551.1172" y2="551.1172"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="81" y="546.0513">POST /connect/register</text><path d="M343,564.1172 L343,665.1172 L686,665.1172 L686,574.1172 L676,564.1172 L343,564.1172 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M676,564.1172 L676,574.1172 L686,574.1172 L676,564.1172 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="320" x="349" y="581.1777">The Kubernetes Ingress Controller is responsible for TLS</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="349" y="596.4121">termination and perfoming an OCSP call to the Certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="295" x="349" y="611.6465">Authority to ensure the client certificate presented is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="312" x="349" y="626.8809">valid. The fingerprint of the certificate will be forwarded</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="319" x="349" y="642.1152">to Identity Management to verify the validity of the OAuth</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="243" x="349" y="657.3496">Client as this cannot be asserted via OCSP.</text><polygon fill="#A80036" points="1993,691.7578,2003,695.7578,1993,699.7578,1997,695.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="695.7578" y2="695.7578"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="690.584">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,720.9922,339,724.9922,349,728.9922,345,724.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="724.9922" y2="724.9922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="719.8184">Response</text><polygon fill="#A80036" points="590,750.2266,600,754.2266,590,758.2266,594,754.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="754.2266" y2="754.2266"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="345" y="749.0527">Registration Request</text><path d="M607,767.2266 L607,822.2266 L1031,822.2266 L1031,777.2266 L1021,767.2266 L607,767.2266 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1021,767.2266 L1021,777.2266 L1031,777.2266 L1021,767.2266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="352" x="613" y="784.2871">The API Gateway acts as a proxy for both Identity and Consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="346" x="613" y="799.5215">Management. This approach is designed to ensure all identity</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="403" x="613" y="814.7559">and access control can be monitored and logged for analytics purposes</text><polygon fill="#A80036" points="867,849.1641,877,853.1641,867,857.1641,871,853.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="873" y1="853.1641" y2="853.1641"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="609" y="847.9902">Registration Request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="882.3984" y2="882.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="882.3984" y2="895.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="895.3984" y2="895.3984"/><polygon fill="#A80036" points="890,891.3984,880,895.3984,890,899.3984,886,895.3984" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="68" x="886" y="877.2246">Verify Client</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="924.6328" y2="924.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="924.6328" y2="937.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="937.6328" y2="937.6328"/><polygon fill="#A80036" points="890,933.6328,880,937.6328,890,941.6328,886,937.6328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="886" y="919.459">Store Client Parameters</text><polygon fill="#A80036" points="613,962.8672,603,966.8672,613,970.8672,609,966.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="878" y1="966.8672" y2="966.8672"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="961.6934">Response</text><polygon fill="#A80036" points="349,992.1016,339,996.1016,349,1000.1016,345,996.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="996.1016" y2="996.1016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="990.9277">Response</text><polygon fill="#A80036" points="85,1021.3359,75,1025.3359,85,1029.3359,81,1025.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1025.3359" y2="1025.3359"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="91" y="1020.1621">Response</text><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2387.5" x="0" y="1053.9531"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="1053.9531" y2="1053.9531"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="1056.9531" y2="1056.9531"/><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="340" x="1023.75" y="1043.3359"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="323" x="1029.75" y="1059.3965">Part 1: Create Consent and Send Authentication Request</text><path d="M79,1081.5703 L79,1151.5703 L425,1151.5703 L425,1091.5703 L415,1081.5703 L79,1081.5703 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M415,1081.5703 L415,1091.5703 L425,1091.5703 L415,1081.5703 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="85" y="1098.6309">The Third-Party App requests an Access Token using</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="325" x="85" y="1113.8652">the Client Credentials grant type. Nominally authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="85" y="1129.0996">is through Mutual Authentication over TLS but it could</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="91" x="85" y="1144.334">equally be using</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="179" y="1144.4419">private_key_jwt</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="299" y="1144.334">.</text><polygon fill="#A80036" points="326,1178.6406,336,1182.6406,326,1186.6406,330,1182.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="1182.6406" y2="1182.6406"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="81" y="1177.5747">POST /token</text><polygon fill="#A80036" points="1993,1207.875,2003,1211.875,1993,1215.875,1997,1211.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="1211.875" y2="1211.875"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="1206.7012">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,1237.1094,339,1241.1094,349,1245.1094,345,1241.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="1241.1094" y2="1241.1094"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1235.9355">Response</text><polygon fill="#A80036" points="590,1266.3438,600,1270.3438,590,1274.3438,594,1270.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="1270.3438" y2="1270.3438"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="128" x="345" y="1265.1699">Access Token request</text><polygon fill="#A80036" points="867,1295.5781,877,1299.5781,867,1303.5781,871,1299.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="873" y1="1299.5781" y2="1299.5781"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="128" x="609" y="1294.4043">Access Token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="1328.8125" y2="1328.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="1328.8125" y2="1341.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="1341.8125" y2="1341.8125"/><polygon fill="#A80036" points="890,1337.8125,880,1341.8125,890,1345.8125,886,1341.8125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="68" x="886" y="1323.6387">Verify Client</text><polygon fill="#A80036" points="613,1367.0469,603,1371.0469,613,1375.0469,609,1371.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="607" x2="878" y1="1371.0469" y2="1371.0469"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="117" x="619" y="1365.873">Issue Access Token</text><polygon fill="#A80036" points="349,1411.3125,339,1415.3125,349,1419.3125,345,1415.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="1415.3125" y2="1415.3125"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="355" y="1395.1138">200 OK</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="355" y="1410.2466">{"access_token": "..."}</text><polygon fill="#A80036" points="85,1455.5781,75,1459.5781,85,1463.5781,81,1459.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1459.5781" y2="1459.5781"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="91" y="1439.3794">200 OK</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="91" y="1454.5122">{"access_token": "..."}</text><path d="M79,1472.5781 L79,1542.5781 L422,1542.5781 L422,1482.5781 L412,1472.5781 L79,1472.5781 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M412,1472.5781 L412,1482.5781 L422,1482.5781 L412,1472.5781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="314" x="85" y="1489.6387">With the Access Token in hand the Third-Party can then</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="1504.873">create the consent resource. This needs to be completed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="300" x="85" y="1520.1074">before the Authentication Request as the value of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="85" y="1535.4497">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="225" x="160" y="1535.3418">is required to set the value of the scope.</text><polygon fill="#A80036" points="326,1569.6484,336,1573.6484,326,1577.6484,330,1573.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="1573.6484" y2="1573.6484"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="81" y="1568.5825">POST /payments/v1/consents</text><polygon fill="#A80036" points="1993,1598.8828,2003,1602.8828,1993,1606.8828,1997,1602.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="1602.8828" y2="1602.8828"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="1597.709">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,1628.1172,339,1632.1172,349,1636.1172,345,1632.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="1632.1172" y2="1632.1172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1626.9434">Response</text><polygon fill="#A80036" points="590,1657.25,600,1661.25,590,1665.25,594,1661.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="1661.25" y2="1661.25"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="345" y="1656.1841">POST /payments/v1/consents</text><polygon fill="#A80036" points="1076,1686.3828,1086,1690.3828,1076,1694.3828,1080,1690.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1082" y1="1690.3828" y2="1690.3828"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="609" y="1685.3169">POST /payments/v1/consents</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1088" x2="1130" y1="1719.6172" y2="1719.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1130" x2="1130" y1="1719.6172" y2="1732.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1089" x2="1130" y1="1732.6172" y2="1732.6172"/><polygon fill="#A80036" points="1099,1728.6172,1089,1732.6172,1099,1736.6172,1095,1732.6172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="201" x="1095" y="1714.4434">Validate consent request properties</text><polygon fill="#A80036" points="613,1772.8828,603,1776.8828,613,1780.8828,609,1776.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1087" y1="1776.8828" y2="1776.8828"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="619" y="1756.6841">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="619" y="1771.8169">{consentId: "..."}</text><polygon fill="#A80036" points="349,1817.1484,339,1821.1484,349,1825.1484,345,1821.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="1821.1484" y2="1821.1484"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="1800.9497">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="355" y="1816.0825">{consentId: "..."}</text><polygon fill="#A80036" points="85,1861.4141,75,1865.4141,85,1869.4141,81,1865.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1865.4141" y2="1865.4141"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="1845.2153">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="91" y="1860.3481">{consentId: "..."}</text><path d="M79,1878.4141 L79,1933.4141 L463,1933.4141 L463,1888.4141 L453,1878.4141 L79,1878.4141 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,1878.4141 L453,1888.4141 L463,1888.4141 L453,1878.4141 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="1895.4746">The Third-Party App can now create and send the Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="352" x="85" y="1910.709">Request. This includes the dynamic scope that holds the value</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="33" x="85" y="1925.9434">of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="121" y="1926.0513">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="189" x="196" y="1925.9434">returned by Identity Management.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="116" y1="1964.3516" y2="1964.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="116" x2="116" y1="1964.3516" y2="1977.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="75" x2="116" y1="1977.3516" y2="1977.3516"/><polygon fill="#A80036" points="85,1973.3516,75,1977.3516,85,1981.3516,81,1977.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="172" x="81" y="1959.1777">Create Authentication Request</text><polygon fill="#A80036" points="326,2002.4844,336,2006.4844,326,2010.4844,330,2006.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="2006.4844" y2="2006.4844"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="81" y="2001.4185">POST /bc-authorize</text><polygon fill="#A80036" points="1993,2031.7188,2003,2035.7188,1993,2039.7188,1997,2035.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="2035.7188" y2="2035.7188"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="2030.5449">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,2060.9531,339,2064.9531,349,2068.9531,345,2064.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="2064.9531" y2="2064.9531"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="2059.7793">Response</text><polygon fill="#A80036" points="590,2090.0859,600,2094.0859,590,2098.0859,594,2094.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="2094.0859" y2="2094.0859"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="345" y="2089.02">POST /bc-authorize</text><path d="M607,2107.0859 L607,2193.0859 L1040,2193.0859 L1040,2117.0859 L1030,2107.0859 L607,2107.0859 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1030,2107.0859 L1030,2117.0859 L1040,2117.0859 L1030,2107.0859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="347" x="613" y="2124.1465">As with the redirection-based FAPI profiles the Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="330" x="613" y="2139.3809">Request is a JSON Web Signature. It therefore needs to be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="339" x="613" y="2154.6152">checked for validity. Note that in the context of CIBA Pushed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="380" x="613" y="2169.8496">Authorization Request is not required as the Authentication Request</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="412" x="613" y="2185.084">is always sent via a secured backchannel and never through the browser.</text><polygon fill="#A80036" points="1860,2219.4922,1870,2223.4922,1860,2227.4922,1864,2223.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1866" y1="2223.4922" y2="2223.4922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="609" y="2218.3184">Get JSON Web Key Set</text><polygon fill="#A80036" points="613,2248.7266,603,2252.7266,613,2256.7266,609,2252.7266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1871" y1="2252.7266" y2="2252.7266"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="2247.5527">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="644" y1="2297.1953" y2="2297.1953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644" x2="644" y1="2297.1953" y2="2310.1953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="603" x2="644" y1="2310.1953" y2="2310.1953"/><polygon fill="#A80036" points="613,2306.1953,603,2310.1953,613,2314.1953,609,2310.1953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="121" x="609" y="2276.7871">Match Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="108" x="609" y="2292.0215">Request parameter</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="720" y="2292.1294">kid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="644" y1="2354.6641" y2="2354.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644" x2="644" y1="2354.6641" y2="2367.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="603" x2="644" y1="2367.6641" y2="2367.6641"/><polygon fill="#A80036" points="613,2363.6641,603,2367.6641,613,2371.6641,609,2367.6641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="609" y="2334.2559">Verify Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="164" x="609" y="2349.4902">Request parameter signature</text><polygon fill="#A80036" points="867,2392.8984,877,2396.8984,867,2400.8984,871,2396.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="873" y1="2396.8984" y2="2396.8984"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="181" x="609" y="2391.7246">Forward Authentication Request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="2426.1328" y2="2426.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="2426.1328" y2="2439.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="2439.1328" y2="2439.1328"/><polygon fill="#A80036" points="890,2435.1328,880,2439.1328,890,2443.1328,886,2439.1328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="181" x="886" y="2420.959">Validate Authentication Request</text><path d="M884,2452.1328 L884,2507.1328 L1193,2507.1328 L1193,2462.1328 L1183,2452.1328 L884,2452.1328 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1183,2452.1328 L1183,2462.1328 L1193,2462.1328 L1183,2452.1328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="287" x="890" y="2469.1934">Note this approach is non-normative and the actual</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="288" x="890" y="2484.4277">implementation required should be considered on a</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="890" y="2499.6621">case-by-case basis.</text><polygon fill="#A80036" points="1504,2534.0703,1514,2538.0703,1504,2542.0703,1508,2538.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="1510" y1="2538.0703" y2="2538.0703"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="231" x="886" y="2532.8965">Send Authentication Request notification</text><polygon fill="#A80036" points="613,2578.3359,603,2582.3359,613,2586.3359,609,2582.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="878" y1="2582.3359" y2="2582.3359"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="619" y="2562.1372">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="619" y="2577.27">{auth_req_id: "..."}</text><polygon fill="#A80036" points="349,2622.6016,339,2626.6016,349,2630.6016,345,2626.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="2626.6016" y2="2626.6016"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="2606.4028">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="355" y="2621.5356">{auth_req_id: "..."}</text><polygon fill="#A80036" points="85,2666.8672,75,2670.8672,85,2674.8672,81,2670.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="2670.8672" y2="2670.8672"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="2650.6685">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="91" y="2665.8013">{auth_req_id: "..."}</text><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2387.5" x="0" y="2699.4844"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="2699.4844" y2="2699.4844"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="2702.4844" y2="2702.4844"/><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="328" x="1029.75" y="2688.8672"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="311" x="1035.75" y="2704.9277">Part 2: Customer Authenticates at Mobile Banking App</text><path d="M1521,2727.1016 L1521,2813.1016 L1862,2813.1016 L1862,2737.1016 L1852,2727.1016 L1521,2727.1016 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1852,2727.1016 L1852,2737.1016 L1862,2737.1016 L1852,2727.1016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="306" x="1527" y="2744.1621">The flow shown is a hypothetical approach to allowing</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="320" x="1527" y="2759.3965">the End User to authenticate and confirm consent. In this</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="1527" y="2774.6309">scenario has installed their mobile banking app and can</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="319" x="1527" y="2789.8652">receive and act-on a request to authenticate and confirm</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="49" x="1527" y="2805.0996">consent.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1516" x2="1558" y1="2858.7422" y2="2858.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1558" x2="1558" y1="2858.7422" y2="2871.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1517" x2="1558" y1="2871.7422" y2="2871.7422"/><polygon fill="#A80036" points="1527,2867.7422,1517,2871.7422,1527,2875.7422,1523,2871.7422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="136" x="1523" y="2838.334">Correlate Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="132" x="1523" y="2853.5684">Request with Customer</text><polygon fill="#A80036" points="1738,2896.9766,1748,2900.9766,1738,2904.9766,1742,2900.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1516" x2="1744" y1="2900.9766" y2="2900.9766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="210" x="1523" y="2895.8027">Trigger push notification to Customer</text><path d="M1755,2913.9766 L1755,2968.9766 L2062,2968.9766 L2062,2923.9766 L2052,2913.9766 L1755,2913.9766 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2052,2913.9766 L2052,2923.9766 L2062,2923.9766 L2052,2913.9766 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="1761" y="2931.0371">The push notification needs to carry some context.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="93" x="1761" y="2946.2715">For example, the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="1857" y="2946.3794">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="81" x="1932" y="2946.2715">- to require the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="192" x="1761" y="2961.5059">consent to be correlated correctly.</text><polygon fill="#A80036" points="2094,2995.9141,2104,2999.9141,2094,3003.9141,2098,2999.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1750" x2="2100" y1="2999.9141" y2="2999.9141"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="254" x="1757" y="2994.7402">Send push notification to mobile banking app</text><polygon fill="#A80036" points="2337,3025.1484,2347,3029.1484,2337,3033.1484,2341,3029.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2106" x2="2343" y1="3029.1484" y2="3029.1484"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="92" x="2113" y="3023.9746">Notify Customer</text><polygon fill="#A80036" points="2117,3054.3828,2107,3058.3828,2117,3062.3828,2113,3058.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2111" x2="2348" y1="3058.3828" y2="3058.3828"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="2123" y="3053.209">Tap notification</text><polygon fill="#A80036" points="2337,3098.8516,2347,3102.8516,2337,3106.8516,2341,3102.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2106" x2="2343" y1="3102.8516" y2="3102.8516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="103" x="2113" y="3082.4434">Request biometric</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="2113" y="3097.6777">gesture to authenticate</text><polygon fill="#A80036" points="2117,3143.3203,2107,3147.3203,2117,3151.3203,2113,3147.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2111" x2="2348" y1="3147.3203" y2="3147.3203"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="100" x="2123" y="3126.9121">Present biometric</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="43" x="2123" y="3142.1465">gesture</text><path d="M1521,3160.3203 L1521,3280.3203 L1889,3280.3203 L1889,3170.3203 L1879,3160.3203 L1521,3160.3203 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1879,3160.3203 L1879,3170.3203 L1889,3170.3203 L1879,3160.3203 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="330" x="1527" y="3177.3809">As with the majority of mobile banking apps authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="345" x="1527" y="3192.6152">in this example is outsourced to the mobile operating system.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="347" x="1527" y="3207.8496">Once the customer has authenticated the mobile banking app</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="331" x="1527" y="3223.084">simply sends a "user authenticated" notification to the IDP.</text><line style="stroke:#000000;stroke-width:1.0;" x1="1527" x2="1527" y1="3228.2578" y2="3228.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="1527" x2="1527" y1="3228.2578" y2="3228.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="1527" x2="1527" y1="3228.2578" y2="3228.2578"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="318" x="1527" y="3242.3184">This flow is non-normative, implementation-specific and</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="325" x="1527" y="3257.5527">would be created based on the implementors architecture</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1527" y="3272.7871">and technology.</text><polygon fill="#A80036" points="1527,3307.1953,1517,3311.1953,1527,3315.1953,1523,3311.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1521" x2="2105" y1="3311.1953" y2="3311.1953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="174" x="1533" y="3306.0215">User authenticated notification</text><polygon fill="#A80036" points="2094,3336.4297,2104,3340.4297,2094,3344.4297,2098,3340.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1516" x2="2100" y1="3340.4297" y2="3340.4297"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="1523" y="3335.2559">Acknowledgement</text><polygon fill="#A80036" points="1761,3365.6641,1751,3369.6641,1761,3373.6641,1757,3369.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1755" x2="2105" y1="3369.6641" y2="3369.6641"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="161" x="1767" y="3364.4902">Request Customer accounts</text><polygon fill="#A80036" points="2094,3394.8984,2104,3398.8984,2094,3402.8984,2098,3398.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1750" x2="2100" y1="3398.8984" y2="3398.8984"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1757" y="3393.7246">Response</text><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2387.5" x="0" y="3427.5156"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="3427.5156" y2="3427.5156"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="3430.5156" y2="3430.5156"/><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="344" x="1021.75" y="3416.8984"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="327" x="1027.75" y="3432.959">Part 3: Customer Confirms Consent and Selects Account</text><path d="M1713,3455.1328 L1713,3575.1328 L2097,3575.1328 L2097,3465.1328 L2087,3455.1328 L1713,3455.1328 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2087,3455.1328 L2087,3465.1328 L2097,3465.1328 L2087,3455.1328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="345" x="1719" y="3472.1934">As Consent needs to be retrieved from a hostile security zone</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="335" x="1719" y="3487.4277">i.e. from a Customer's mobile device the request to Consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="340" x="1719" y="3502.6621">Management should be routed via the Ingress Controller/API</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="341" x="1719" y="3517.8965">Gateway. This flow is implementation-specific and would be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="1719" y="3533.1309">created based on the implementors architecture and technology.</text><line style="stroke:#000000;stroke-width:1.0;" x1="1719" x2="1719" y1="3538.3047" y2="3538.3047"/><line style="stroke:#000000;stroke-width:1.0;" x1="1719" x2="1719" y1="3538.3047" y2="3538.3047"/><line style="stroke:#000000;stroke-width:1.0;" x1="1719" x2="1719" y1="3538.3047" y2="3538.3047"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="275" x="1719" y="3552.3652">In this example the Customer is the sole account</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="1719" y="3567.5996">holder and therefore no further authorizations are required.</text><polygon fill="#A80036" points="349,3602.0078,339,3606.0078,349,3610.0078,345,3606.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="2105" y1="3606.0078" y2="3606.0078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="95" x="355" y="3600.834">Retrieve consent</text><polygon fill="#A80036" points="590,3631.2422,600,3635.2422,590,3639.2422,594,3635.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="3635.2422" y2="3635.2422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="95" x="345" y="3630.0684">Retrieve consent</text><polygon fill="#A80036" points="1076,3660.4766,1086,3664.4766,1076,3668.4766,1080,3664.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1082" y1="3664.4766" y2="3664.4766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="95" x="609" y="3659.3027">Retrieve consent</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1088" x2="1130" y1="3693.7109" y2="3693.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1130" x2="1130" y1="3693.7109" y2="3706.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1089" x2="1130" y1="3706.7109" y2="3706.7109"/><polygon fill="#A80036" points="1099,3702.7109,1089,3706.7109,1099,3710.7109,1095,3706.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="1095" y="3688.5371">Retrieve Consent</text><polygon fill="#A80036" points="613,3731.9453,603,3735.9453,613,3739.9453,609,3735.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1087" y1="3735.9453" y2="3735.9453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="3730.7715">Response</text><polygon fill="#A80036" points="349,3761.1797,339,3765.1797,349,3769.1797,345,3765.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="3765.1797" y2="3765.1797"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="3760.0059">Response</text><polygon fill="#A80036" points="2094,3790.4141,2104,3794.4141,2094,3798.4141,2098,3794.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="338" x2="2100" y1="3794.4141" y2="3794.4141"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="345" y="3789.2402">Response</text><path d="M1755,3807.4141 L1755,3908.4141 L2242,3908.4141 L2242,3817.4141 L2232,3807.4141 L1755,3807.4141 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2232,3807.4141 L2232,3817.4141 L2242,3817.4141 L2232,3807.4141 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="466" x="1761" y="3824.4746">The Consent Confirmation screen requires the following properties to be displayed:</text><ellipse cx="1766.5" cy="3835.3828" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="1773" y="3839.709">Transaction Value.</text><ellipse cx="1766.5" cy="3850.6172" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="207" x="1773" y="3854.9434">Recipient details (name, CPF/CNPJ).</text><ellipse cx="1766.5" cy="3865.8516" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="83" x="1773" y="3870.1777">Payment Date.</text><ellipse cx="1766.5" cy="3881.0859" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="231" x="1773" y="3885.4121">Payment method (currently fixed on PIX).</text><ellipse cx="1766.5" cy="3896.3203" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="230" x="1773" y="3900.6465">Fee amount charged by the bank (if any).</text><path d="M1704.5,3924.8203 L1768.5,3924.8203 L1768.5,3931.8203 L1758.5,3941.8203 L1704.5,3941.8203 L1704.5,3924.8203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="463.1094" style="stroke:#000000;stroke-width:2.0;" width="659.5" x="1704.5" y="3924.8203"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="1719.5" y="3937.8809">par</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171" x="1783.5" y="3937.0254">[Request fee amount for payment]</text><path d="M1755,3947.0547 L1755,3972.0547 L2128,3972.0547 L2128,3957.0547 L2118,3947.0547 L1755,3947.0547 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2118,3947.0547 L2118,3957.0547 L2128,3957.0547 L2118,3947.0547 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="352" x="1761" y="3964.1152">Fees for payment must be provided from the Banking Systems</text><polygon fill="#A80036" points="1761,3998.5234,1751,4002.5234,1761,4006.5234,1757,4002.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1755" x2="2105" y1="4002.5234" y2="4002.5234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="115" x="1767" y="3997.3496">Request fee amount</text><polygon fill="#A80036" points="2094,4027.7578,2104,4031.7578,2094,4035.7578,2098,4031.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1750" x2="2100" y1="4031.7578" y2="4031.7578"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1757" y="4026.584">Response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1704.5" x2="2364" y1="4040.7578" y2="4040.7578"/><path d="M1745,4048.7578 L1804,4048.7578 L1804,4055.7578 L1794,4065.7578 L1745,4065.7578 L1745,4048.7578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="332.1719" style="stroke:#000000;stroke-width:2.0;" width="609" x="1745" y="4048.7578"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1760" y="4061.8184">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="203" x="1819" y="4060.9629">[Debtor account not provided in Consent]</text><path d="M1755,4070.9922 L1755,4186.9922 L2182,4186.9922 L2182,4080.9922 L2172,4070.9922 L1755,4070.9922 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2172,4070.9922 L2172,4080.9922 L2182,4080.9922 L2172,4070.9922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="357" x="1761" y="4088.0527">If the debtor account has not been provided in the Consent then</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="331" x="1761" y="4103.2871">the customer's payment accounts will need to be retrieved:</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="0" x="1764" y="4118.5215"/><ellipse cx="1766.5" cy="4129.4297" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="394" x="1773" y="4133.7559">If the customer only has one payment account then this is the default.</text><ellipse cx="1766.5" cy="4144.6641" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="361" x="1773" y="4148.9902">If they have multiple accounts they should be able to select one.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="0" x="1764" y="4164.2246"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="373" x="1761" y="4179.459">This should be incorporated into the Consent Confirmation screen.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2106" x2="2148" y1="4217.8672" y2="4217.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2148" x2="2148" y1="4217.8672" y2="4230.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2107" x2="2148" y1="4230.8672" y2="4230.8672"/><polygon fill="#A80036" points="2117,4226.8672,2107,4230.8672,2117,4234.8672,2113,4230.8672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="229" x="2113" y="4212.6934">Query account list for payment accounts</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1745" x2="2354" y1="4239.8672" y2="4239.8672"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="184" x="1750" y="4250.0723">[Debtor account provided in Consent]</text><path d="M1755,4258.7578 L1755,4328.7578 L2142,4328.7578 L2142,4268.7578 L2132,4258.7578 L1755,4258.7578 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2132,4258.7578 L2132,4268.7578 L2142,4268.7578 L2132,4258.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="366" x="1761" y="4275.8184">If the debtor account has already been provided ownership of the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="140" x="1761" y="4291.0527">account by the customer</text><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="1904" y="4291.0527">must</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="175" x="1936" y="4291.0527">be verified. In this example this</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="366" x="1761" y="4306.2871">can be done at the Mobile Banking App as it has already retrieved</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="169" x="1761" y="4321.5215">the list of customer accounts.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2106" x2="2148" y1="4359.9297" y2="4359.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2148" x2="2148" y1="4359.9297" y2="4372.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2107" x2="2148" y1="4372.9297" y2="4372.9297"/><polygon fill="#A80036" points="2117,4368.9297,2107,4372.9297,2117,4376.9297,2113,4372.9297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="183" x="2113" y="4354.7559">Verify debtor account ownership</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2106" x2="2148" y1="4431.3984" y2="4431.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2148" x2="2148" y1="4431.3984" y2="4444.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2107" x2="2148" y1="4444.3984" y2="4444.3984"/><polygon fill="#A80036" points="2117,4440.3984,2107,4444.3984,2117,4448.3984,2113,4444.3984" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="2113" y="4410.9902">Render consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="2113" y="4426.2246">confirmation screen</text><polygon fill="#A80036" points="2337,4484.8672,2347,4488.8672,2337,4492.8672,2341,4488.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2106" x2="2343" y1="4488.8672" y2="4488.8672"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="2113" y="4468.459">Request consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="72" x="2113" y="4483.6934">confirmation</text><polygon fill="#A80036" points="2117,4514.1016,2107,4518.1016,2117,4522.1016,2113,4518.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2111" x2="2348" y1="4518.1016" y2="4518.1016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="94" x="2123" y="4512.9277">Confirm consent</text><polygon fill="#A80036" points="349,4543.3359,339,4547.3359,349,4551.3359,345,4547.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="2105" y1="4547.3359" y2="4547.3359"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="168" x="355" y="4542.1621">Update consent as authorized</text><polygon fill="#A80036" points="590,4572.5703,600,4576.5703,590,4580.5703,594,4576.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="4576.5703" y2="4576.5703"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="168" x="345" y="4571.3965">Update consent as authorized</text><polygon fill="#A80036" points="1076,4601.8047,1086,4605.8047,1076,4609.8047,1080,4605.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1082" y1="4605.8047" y2="4605.8047"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="609" y="4600.6309">Update consent</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1088" x2="1130" y1="4635.0391" y2="4635.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1130" x2="1130" y1="4635.0391" y2="4648.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1089" x2="1130" y1="4648.0391" y2="4648.0391"/><polygon fill="#A80036" points="1099,4644.0391,1089,4648.0391,1099,4652.0391,1095,4648.0391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="90" x="1095" y="4629.8652">Update Consent</text><polygon fill="#A80036" points="613,4673.2734,603,4677.2734,613,4681.2734,609,4677.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1087" y1="4677.2734" y2="4677.2734"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="4672.0996">Response</text><polygon fill="#A80036" points="349,4702.5078,339,4706.5078,349,4710.5078,345,4706.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="4706.5078" y2="4706.5078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="4701.334">Response</text><polygon fill="#A80036" points="2094,4731.7422,2104,4735.7422,2094,4739.7422,2098,4735.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="338" x2="2100" y1="4735.7422" y2="4735.7422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="345" y="4730.5684">Response</text><path d="M1776,4748.7422 L1776,4864.7422 L2097,4864.7422 L2097,4758.7422 L2087,4748.7422 L1776,4748.7422 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2087,4748.7422 L2087,4758.7422 L2097,4758.7422 L2087,4748.7422 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="272" x="1782" y="4765.8027">The final step is to call the Identity Management</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="285" x="1782" y="4781.0371">component to indicate that the Customer has been</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="291" x="1782" y="4796.2715">authenticated. Identity Management will then signal</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="282" x="1782" y="4811.5059">to the Third-Party App using the chosen mode that</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="253" x="1782" y="4826.7402">authentication is complete. Again this flow is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="300" x="1782" y="4841.9746">implementation-specific and would be created based</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="279" x="1782" y="4857.209">on the implementors architecture and technology.</text><polygon fill="#A80036" points="613,4891.6172,603,4895.6172,613,4899.6172,609,4895.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="607" x2="2105" y1="4895.6172" y2="4895.6172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="205" x="619" y="4890.4434">Authentication complete notification</text><polygon fill="#A80036" points="867,4920.8516,877,4924.8516,867,4928.8516,871,4924.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="873" y1="4924.8516" y2="4924.8516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="253" x="609" y="4919.6777">Forward authentication complete notification</text><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2387.5" x="0" y="4953.4688"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="4953.4688" y2="4953.4688"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="4956.4688" y2="4956.4688"/><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="226" x="1080.75" y="4942.8516"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="209" x="1086.75" y="4958.9121">Part 4: Client Granted Access Token</text><path d="M79,4981.0859 L79,5174.0859 L485,5174.0859 L485,4991.0859 L475,4981.0859 L79,4981.0859 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M475,4981.0859 L475,4991.0859 L485,4991.0859 L475,4981.0859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="148" x="85" y="4998.1465">Notes on Token behaviors</text><line style="stroke:#A80036;stroke-width:1.0;" x1="80" x2="484" y1="5001.3203" y2="5001.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="80" x2="484" y1="5003.3203" y2="5003.3203"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="5017.3809">The Third-Party App is made aware of the success of the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="318" x="85" y="5032.6152">based on their registered delivery mode. Each of these is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="78" x="85" y="5047.8496">shown below.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="5053.0234" y2="5053.0234"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="5053.0234" y2="5053.0234"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="5053.0234" y2="5053.0234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="85" y="5067.084">Note that the Poll looping example is purely illustrative</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="85" y="5082.3184">as the Third-Party App would poll as soon as they received</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="18" x="85" y="5097.5527">the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="106" y="5097.6606">auth_req_id</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="197" x="197" y="5097.5527">from the AS. Writing the diagram to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="385" x="85" y="5112.7871">incorporate this sequentially would, however be extremely confusing</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="196" x="85" y="5128.0215">hence the sequence shown below.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="5133.1953" y2="5133.1953"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="5133.1953" y2="5133.1953"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="5133.1953" y2="5133.1953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="317" x="85" y="5147.2559">For Poll and Ping mode the Third-Party App must use the</text><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="87" x="85" y="5162.4902">CIBA grant type</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="229" x="175" y="5162.4902">as described in the source specification.</text><path d="M10,5190.6641 L69,5190.6641 L69,5197.6641 L59,5207.6641 L10,5207.6641 L10,5190.6641 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1587.6797" style="stroke:#000000;stroke-width:2.0;" width="2071.5" x="10" y="5190.6641"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="25" y="5203.7246">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="145" x="84" y="5202.8691">[Client Registered Poll Mode]</text><path d="M79,5212.8984 L79,5282.8984 L474,5282.8984 L474,5222.8984 L464,5212.8984 L79,5212.8984 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M464,5212.8984 L464,5222.8984 L474,5222.8984 L464,5212.8984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="342" x="85" y="5229.959">In Poll mode the TPP will periodically call the Token endpoint</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="85" y="5245.1934">until they get a positive response i.e. they do not receive</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="374" x="85" y="5260.4277">the 400 HTTP response code but instead are returned one-or-more</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="309" x="85" y="5275.6621">tokens (Access, Refresh, ID) from the Token endpoint.</text><path d="M20,5299.8359 L89,5299.8359 L89,5306.8359 L79,5316.8359 L20,5316.8359 L20,5299.8359 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="335.1719" style="stroke:#000000;stroke-width:2.0;" width="2051.5" x="20" y="5299.8359"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="35" y="5312.8965">loop</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="232" x="104" y="5312.041">[Exit when Authentication Request successful]</text><polygon fill="#A80036" points="326,5334.2031,336,5338.2031,326,5342.2031,330,5338.2031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="5338.2031" y2="5338.2031"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="5333.1372">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1993,5363.4375,2003,5367.4375,1993,5371.4375,1997,5367.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="5367.4375" y2="5367.4375"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="5362.2637">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,5392.6719,339,5396.6719,349,5400.6719,345,5396.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="5396.6719" y2="5396.6719"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="5391.498">Response</text><polygon fill="#A80036" points="590,5421.9063,600,5425.9063,590,5429.9063,594,5425.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="5425.9063" y2="5425.9063"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="5420.7324">Forward token request</text><polygon fill="#A80036" points="867,5451.1406,877,5455.1406,867,5459.1406,871,5455.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="873" y1="5455.1406" y2="5455.1406"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="609" y="5449.9668">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="5484.375" y2="5484.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="5484.375" y2="5497.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="5497.375" y2="5497.375"/><polygon fill="#A80036" points="890,5493.375,880,5497.375,890,5501.375,886,5497.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="886" y="5479.2012">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="5526.6094" y2="5526.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="5526.6094" y2="5539.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="5539.6094" y2="5539.6094"/><polygon fill="#A80036" points="890,5535.6094,880,5539.6094,890,5543.6094,886,5539.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="75" x="886" y="5521.4355">Check status</text><polygon fill="#A80036" points="613,5564.7422,603,5568.7422,613,5572.7422,609,5568.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="878" y1="5568.7422" y2="5568.7422"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="619" y="5563.6763">400 Bad Request {...}</text><polygon fill="#A80036" points="349,5593.875,339,5597.875,349,5601.875,345,5597.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="5597.875" y2="5597.875"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="355" y="5592.8091">400 Bad Request {...}</text><polygon fill="#A80036" points="85,5623.0078,75,5627.0078,85,5631.0078,81,5627.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="5627.0078" y2="5627.0078"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="91" y="5621.9419">400 Bad Request {...}</text><polygon fill="#A80036" points="326,5659.1406,336,5663.1406,326,5667.1406,330,5663.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="5663.1406" y2="5663.1406"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="5658.0747">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1993,5688.375,2003,5692.375,1993,5696.375,1997,5692.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="5692.375" y2="5692.375"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="5687.2012">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,5717.6094,339,5721.6094,349,5725.6094,345,5721.6094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="5721.6094" y2="5721.6094"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="5716.4355">Response</text><polygon fill="#A80036" points="590,5746.8438,600,5750.8438,590,5754.8438,594,5750.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="5750.8438" y2="5750.8438"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="5745.6699">Forward token request</text><polygon fill="#A80036" points="867,5776.0781,877,5780.0781,867,5784.0781,871,5780.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="873" y1="5780.0781" y2="5780.0781"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="609" y="5774.9043">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="5809.3125" y2="5809.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="5809.3125" y2="5822.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="5822.3125" y2="5822.3125"/><polygon fill="#A80036" points="890,5818.3125,880,5822.3125,890,5826.3125,886,5822.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="886" y="5804.1387">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="5851.5469" y2="5851.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="5851.5469" y2="5864.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="5864.5469" y2="5864.5469"/><polygon fill="#A80036" points="890,5860.5469,880,5864.5469,890,5868.5469,886,5864.5469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="75" x="886" y="5846.373">Check status</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="5893.7813" y2="5893.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="5893.7813" y2="5906.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="5906.7813" y2="5906.7813"/><polygon fill="#A80036" points="890,5902.7813,880,5906.7813,890,5910.7813,886,5906.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="886" y="5888.6074">Create tokens</text><polygon fill="#A80036" points="613,5931.9141,603,5935.9141,613,5939.9141,609,5935.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="878" y1="5935.9141" y2="5935.9141"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="619" y="5930.8481">200 OK {...}</text><polygon fill="#A80036" points="349,5961.0469,339,5965.0469,349,5969.0469,345,5965.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="5965.0469" y2="5965.0469"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="355" y="5959.981">200 OK {...}</text><polygon fill="#A80036" points="85,5990.1797,75,5994.1797,85,5998.1797,81,5994.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="5994.1797" y2="5994.1797"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="91" y="5989.1138">200 OK {...}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="2081.5" y1="6003.1797" y2="6003.1797"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="148" x="15" y="6013.3848">[Client Registered Ping Mode]</text><path d="M79,6022.0703 L79,6092.0703 L463,6092.0703 L463,6032.0703 L453,6022.0703 L79,6022.0703 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,6022.0703 L453,6032.0703 L463,6032.0703 L453,6022.0703 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="6039.1309">Ping mode is a simple notification by the AS to a callback</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="85" y="6054.3652">URL pre-registered by the Third-Party App in Part 0. On</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="337" x="85" y="6069.5996">receipt the Third-Party App can then call the Token endpoint</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="6084.834">in the same way as in Poll mode and collect one-or-more tokens.</text><polygon fill="#A80036" points="85,6119.2422,75,6123.2422,85,6127.2422,81,6123.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79" x2="878" y1="6123.2422" y2="6123.2422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="255" x="91" y="6118.0684">Authentication Request complete notification</text><polygon fill="#A80036" points="867,6148.375,877,6152.375,867,6156.375,871,6152.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="74" x2="873" y1="6152.375" y2="6152.375"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="81" y="6147.3091">204 No Content</text><polygon fill="#A80036" points="326,6177.5078,336,6181.5078,326,6185.5078,330,6181.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="6181.5078" y2="6181.5078"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="6176.4419">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1993,6206.7422,2003,6210.7422,1993,6214.7422,1997,6210.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="6210.7422" y2="6210.7422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="6205.5684">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,6235.9766,339,6239.9766,349,6243.9766,345,6239.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="6239.9766" y2="6239.9766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="6234.8027">Response</text><polygon fill="#A80036" points="590,6265.2109,600,6269.2109,590,6273.2109,594,6269.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="6269.2109" y2="6269.2109"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="6264.0371">Forward token request</text><polygon fill="#A80036" points="867,6294.4453,877,6298.4453,867,6302.4453,871,6298.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="873" y1="6298.4453" y2="6298.4453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="609" y="6293.2715">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="6327.6797" y2="6327.6797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="6327.6797" y2="6340.6797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="6340.6797" y2="6340.6797"/><polygon fill="#A80036" points="890,6336.6797,880,6340.6797,890,6344.6797,886,6340.6797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="886" y="6322.5059">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="6369.9141" y2="6369.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="6369.9141" y2="6382.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="6382.9141" y2="6382.9141"/><polygon fill="#A80036" points="890,6378.9141,880,6382.9141,890,6386.9141,886,6382.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="886" y="6364.7402">Create tokens</text><polygon fill="#A80036" points="613,6408.0469,603,6412.0469,613,6416.0469,609,6412.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="878" y1="6412.0469" y2="6412.0469"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="619" y="6406.981">200 OK {...}</text><polygon fill="#A80036" points="349,6437.1797,339,6441.1797,349,6445.1797,345,6441.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="6441.1797" y2="6441.1797"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="355" y="6436.1138">200 OK {...}</text><polygon fill="#A80036" points="85,6466.3125,75,6470.3125,85,6474.3125,81,6470.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="6470.3125" y2="6470.3125"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="91" y="6465.2466">200 OK {...}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="2081.5" y1="6479.3125" y2="6479.3125"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151" x="15" y="6489.5176">[Client Registered Push Mode]</text><path d="M79,6498.2031 L79,6568.2031 L463,6568.2031 L463,6508.2031 L453,6498.2031 L79,6498.2031 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,6498.2031 L453,6508.2031 L463,6508.2031 L453,6498.2031 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="6515.2637">In Push mode tokens are created by the AS and then transmitted</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="349" x="85" y="6530.498">to the Third-Party App, therefore negating the need for them to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="356" x="85" y="6545.7324">visit the Token endpoint. Their are various implications of using</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="221" x="85" y="6560.9668">this method which are discussed in the</text><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="74" x="309" y="6560.9668">specification</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="383" y="6560.9668">.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="6599.375" y2="6599.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="6599.375" y2="6612.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="6612.375" y2="6612.375"/><polygon fill="#A80036" points="890,6608.375,880,6612.375,890,6616.375,886,6612.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="886" y="6594.2012">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="6641.6094" y2="6641.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="6641.6094" y2="6654.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="6654.6094" y2="6654.6094"/><polygon fill="#A80036" points="890,6650.6094,880,6654.6094,890,6658.6094,886,6654.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="886" y="6636.4355">Create tokens</text><line style="stroke:#A80036;stroke-width:1.0;" x1="879" x2="921" y1="6699.0781" y2="6699.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921" x2="921" y1="6699.0781" y2="6712.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="880" x2="921" y1="6712.0781" y2="6712.0781"/><polygon fill="#A80036" points="890,6708.0781,880,6712.0781,890,6716.0781,886,6712.0781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="195" x="886" y="6678.6699">Retrieve callback URL and security</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="141" x="886" y="6693.9043">token for Third-Party App</text><polygon fill="#A80036" points="85,6737.2109,75,6741.2109,85,6745.2109,81,6741.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79" x2="878" y1="6741.2109" y2="6741.2109"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="91" y="6736.145">POST /cb {...}</text><polygon fill="#A80036" points="867,6766.3438,877,6770.3438,867,6774.3438,871,6770.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="74" x2="873" y1="6770.3438" y2="6770.3438"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="81" y="6765.2778">204 No Content</text><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2387.5" x="0" y="6805.9609"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="6805.9609" y2="6805.9609"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2387.5" y1="6808.9609" y2="6808.9609"/><rect fill="#EEEEEE" filter="url(#f1vhmagji47d6w)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="293" x="1047.25" y="6795.3438"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="276" x="1053.25" y="6811.4043">Part 5: TPP Makes Payment Instruction Request</text><path d="M79,6833.5781 L79,6903.5781 L438,6903.5781 L438,6843.5781 L428,6833.5781 L79,6833.5781 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M428,6833.5781 L428,6843.5781 L438,6843.5781 L428,6833.5781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="338" x="85" y="6850.6387">With the Access Token in hand the Third-Party App can now</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="327" x="85" y="6865.873">make the payment instruction request. The Access Token</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="321" x="85" y="6881.1074">is bound to this single operation and will be revoked once</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="293" x="85" y="6896.3418">the payment instruction is successfully transmitted.</text><polygon fill="#A80036" points="326,6930.6484,336,6934.6484,326,6938.6484,330,6934.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="6934.6484" y2="6934.6484"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="81" y="6929.5825">POST /payments/v1/pix/payments</text><polygon fill="#A80036" points="1993,6959.8828,2003,6963.8828,1993,6967.8828,1997,6963.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1999" y1="6963.8828" y2="6963.8828"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="6958.709">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,6989.1172,339,6993.1172,349,6997.1172,345,6993.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="2004" y1="6993.1172" y2="6993.1172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="6987.9434">Response</text><polygon fill="#A80036" points="590,7018.25,600,7022.25,590,7026.25,594,7022.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="7022.25" y2="7022.25"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="345" y="7017.1841">POST /payments/v1/pix/payments</text><path d="M607,7035.25 L607,7090.25 L1081,7090.25 L1081,7045.25 L1071,7035.25 L607,7035.25 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1071,7035.25 L1071,7045.25 L1081,7045.25 L1071,7035.25 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="453" x="613" y="7052.3105">The approach to Access Token introspection remains the same under payments</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="435" x="613" y="7067.5449">i.e. the API Gateway will need an assertion that indicates the consent granted</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="315" x="613" y="7082.7793">by the Customer matches the payment being instructed.</text><polygon fill="#A80036" points="1076,7117.1875,1086,7121.1875,1076,7125.1875,1080,7121.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1082" y1="7121.1875" y2="7121.1875"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="192" x="609" y="7116.0137">Request Access Token properties</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1088" x2="1130" y1="7150.4219" y2="7150.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1130" x2="1130" y1="7150.4219" y2="7163.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1089" x2="1130" y1="7163.4219" y2="7163.4219"/><polygon fill="#A80036" points="1099,7159.4219,1089,7163.4219,1099,7167.4219,1095,7163.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="191" x="1095" y="7145.248">Retrieve Access Token properties</text><polygon fill="#A80036" points="613,7188.6563,603,7192.6563,613,7196.6563,609,7192.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1087" y1="7192.6563" y2="7192.6563"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="7187.4824">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="644" y1="7221.8906" y2="7221.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644" x2="644" y1="7221.8906" y2="7234.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="603" x2="644" y1="7234.8906" y2="7234.8906"/><polygon fill="#A80036" points="613,7230.8906,603,7234.8906,613,7238.8906,609,7234.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="203" x="609" y="7216.7168">Introspect Access Token properties</text><path d="M607,7247.8906 L607,7317.8906 L1064,7317.8906 L1064,7257.8906 L1054,7247.8906 L607,7247.8906 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1054,7247.8906 L1054,7257.8906 L1064,7257.8906 L1054,7247.8906 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="392" x="613" y="7264.9512">On introspecting the Access Token the API Gateway will decorate the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="421" x="613" y="7280.1855">request with the debtor account which is stored with the Consent. This can</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="436" x="613" y="7295.4199">then be forwarded to the API Builder application and used to make the correct</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="251" x="613" y="7310.6543">payment instruction in the Banking Systems.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="644" y1="7349.0625" y2="7349.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644" x2="644" y1="7349.0625" y2="7362.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="603" x2="644" y1="7362.0625" y2="7362.0625"/><polygon fill="#A80036" points="613,7358.0625,603,7362.0625,613,7366.0625,609,7362.0625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="213" x="609" y="7343.8887">Decorate request with debtor account</text><polygon fill="#A80036" points="1316,7387.1953,1326,7391.1953,1316,7395.1953,1320,7391.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1322" y1="7391.1953" y2="7391.1953"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="609" y="7386.1294">POST /payments/v1/pix/payments</text><path d="M1333,7404.1953 L1333,7459.1953 L1735,7459.1953 L1735,7414.1953 L1725,7404.1953 L1333,7404.1953 " fill="#FBFB77" filter="url(#f1vhmagji47d6w)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1725,7404.1953 L1725,7414.1953 L1735,7414.1953 L1725,7404.1953 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="377" x="1339" y="7421.2559">This flow is non-normative and will vary on customer requirements.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="8" x="1339" y="7436.4902">It</text><text fill="#000000" font-family="Roboto" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="31" x="1350" y="7436.4902">could</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="336" x="1384" y="7436.4902">be to a PIX-compliant API or any other available mechanism</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="1339" y="7451.7246">to make a PIX payment.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1328" x2="1370" y1="7490.1328" y2="7490.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1370" x2="1370" y1="7490.1328" y2="7503.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1329" x2="1370" y1="7503.1328" y2="7503.1328"/><polygon fill="#A80036" points="1339,7499.1328,1329,7503.1328,1339,7507.1328,1335,7503.1328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="139" x="1335" y="7484.959">Mediate request payload</text><polygon fill="#A80036" points="1738,7528.3672,1748,7532.3672,1738,7536.3672,1742,7532.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1328" x2="1744" y1="7532.3672" y2="7532.3672"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="1335" y="7527.1934">Deliver payment instruction to Banking System API</text><polygon fill="#A80036" points="1339,7557.6016,1329,7561.6016,1339,7565.6016,1335,7561.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1333" x2="1749" y1="7561.6016" y2="7561.6016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1345" y="7556.4277">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1328" x2="1370" y1="7590.8359" y2="7590.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1370" x2="1370" y1="7590.8359" y2="7603.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1329" x2="1370" y1="7603.8359" y2="7603.8359"/><polygon fill="#A80036" points="1339,7599.8359,1329,7603.8359,1339,7607.8359,1335,7603.8359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="149" x="1335" y="7585.6621">Mediate response payload</text><polygon fill="#A80036" points="613,7644.1016,603,7648.1016,613,7652.1016,609,7648.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1327" y1="7648.1016" y2="7648.1016"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="619" y="7627.9028">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="619" y="7643.0356">{paymentId: "..."}</text><polygon fill="#A80036" points="349,7688.3672,339,7692.3672,349,7696.3672,345,7692.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="7692.3672" y2="7692.3672"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="7672.1685">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="355" y="7687.3013">{paymentId: "..."}</text><polygon fill="#A80036" points="85,7732.6328,75,7736.6328,85,7740.6328,81,7736.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="7736.6328" y2="7736.6328"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="7716.4341">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="91" y="7731.5669">{paymentId: "..."}</text><!--MD5=[94b030939febd8a3d6b43489032c8e24]
@startuml CIBA_Example_Sequence

title \n\n\n
hide footbox

participant "Third-Party\nApp" as TPP

box Infrastructure #6FA8DC
participant "Ingress\nController" as INGRESS
participant "API\nGateway" as API_GATEWAY
end box

box Identity and Access Control #94c47d
participant "Identity Management\n- - -\nAuthorisation Server" as IAM
participant "Consent\nManagement\n- - -\nAPI" as CONSENT
end box

box Open Banking APIs #e06666
participant "API\nBuilder" as API_BUILDER
end box

box Core Banking Applications #d5a6bd
participant "Banking\nIdentity\nProvider" as ASPSP_IDP
participant "Banking\nSystems" as ASPSP_API
end box

participant "Open Banking\nDirectory\n- - -\nJSON Web Key Set" as OBD_JWKS
participant "Certificate\nAuthority\n- - -\nOCSP Endpoint" as OCSP
participant "Mobile\nBanking\nApp" as MOBILE
actor "Customer" as PSU

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

== Part 0: Registration of Token Delivery Preferences ==

note right of TPP
CIBA requires that Clients register a delivery mode prior to the
transmission of any Authentication Requests:
|||
[[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4 Clients registering to use CIBA MUST indicate a token delivery mode]]
|||
The Authorization Server (AS) therefore must host a registration
endpoint - defined in the discoverable OpenID Configuration -
that allows the Client to do so. The parameters for this call
are described in the CIBA specification and differ depending
on the method in question. The modes are:
|||
* **Poll**: Client polls the Token endpoint.
* **Ping**: AS notifies, Client retrieves from Token endpoint.
* **Push**: AS sends tokens to Client.
|||
The supported modes vary by AS as they are implementor specific i.e.
implementors of the AS can choose to only support one-or-more given
modes. The supported modes must be made pushed in the AS OpenID
Configuration.
end note

TPP -> INGRESS: ""POST /connect/register""

note right of INGRESS
The Kubernetes Ingress Controller is responsible for TLS
termination and perfoming an OCSP call to the Certificate
Authority to ensure the client certificate presented is
valid. The fingerprint of the certificate will be forwarded
to Identity Management to verify the validity of the OAuth
Client as this cannot be asserted via OCSP.
end note

INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Registration Request

note right of API_GATEWAY
The API Gateway acts as a proxy for both Identity and Consent
Management. This approach is designed to ensure all identity
and access control can be monitored and logged for analytics purposes
end note

API_GATEWAY -> IAM: Registration Request
IAM -> IAM: Verify Client
IAM -> IAM: Store Client Parameters
API_GATEWAY <- - IAM: Response
INGRESS <- - API_GATEWAY: Response
TPP <- - INGRESS: Response

== Part 1: Create Consent and Send Authentication Request ==

note right of TPP
The Third-Party App requests an Access Token using
the Client Credentials grant type. Nominally authentication
is through Mutual Authentication over TLS but it could
equally be using ""private_key_jwt"".
end note

TPP -> INGRESS: ""POST /token""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Access Token request
API_GATEWAY -> IAM: Access Token request
IAM -> IAM: Verify Client
API_GATEWAY <- IAM: Issue Access Token
INGRESS <- - API_GATEWAY: ""200 OK""\n""{"access_token": "..."}""
TPP <- - INGRESS: ""200 OK""\n""{"access_token": "..."}""

note right of TPP
With the Access Token in hand the Third-Party can then
create the consent resource. This needs to be completed
before the Authentication Request as the value of the
""consentId"" is required to set the value of the scope.
end note

TPP -> INGRESS: ""POST /payments/v1/consents""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: ""POST /payments/v1/consents""
API_GATEWAY -> CONSENT: ""POST /payments/v1/consents""
CONSENT -> CONSENT: Validate consent request properties
API_GATEWAY <- - CONSENT: ""201 Created""\n""{consentId: "..."}""
INGRESS <- - API_GATEWAY: ""201 Created""\n""{consentId: "..."}""
TPP <- - INGRESS: ""201 Created""\n""{consentId: "..."}""

note right of TPP
The Third-Party App can now create and send the Authentication
Request. This includes the dynamic scope that holds the value 
of the ""consentId"" returned by Identity Management.
end note

TPP -> TPP: Create Authentication Request
TPP -> INGRESS: ""POST /bc-authorize""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: ""POST /bc-authorize""

note right of API_GATEWAY
As with the redirection-based FAPI profiles the Authentication
Request is a JSON Web Signature. It therefore needs to be
checked for validity. Note that in the context of CIBA Pushed
Authorization Request is not required as the Authentication Request
is always sent via a secured backchannel and never through the browser.
end note

API_GATEWAY -> OBD_JWKS: Get JSON Web Key Set
API_GATEWAY <- - OBD_JWKS: Response
API_GATEWAY -> API_GATEWAY: Match Authentication\nRequest parameter ""kid""
API_GATEWAY -> API_GATEWAY: Verify Authentication\nRequest parameter signature
API_GATEWAY -> IAM: Forward Authentication Request
IAM -> IAM: Validate Authentication Request

note right of IAM
Note this approach is non-normative and the actual
implementation required should be considered on a
case-by-case basis.
end note

IAM -> ASPSP_IDP: Send Authentication Request notification
API_GATEWAY <- - IAM: ""201 Created""\n""{auth_req_id: "..."}""
INGRESS <- - API_GATEWAY: ""201 Created""\n""{auth_req_id: "..."}""
TPP <- - INGRESS: ""201 Created""\n""{auth_req_id: "..."}""

== Part 2: Customer Authenticates at Mobile Banking App ==

note right of ASPSP_IDP
The flow shown is a hypothetical approach to allowing
the End User to authenticate and confirm consent. In this
scenario has installed their mobile banking app and can
receive and act-on a request to authenticate and confirm
consent.
end note

ASPSP_IDP -> ASPSP_IDP: Correlate Authentication\nRequest with Customer
ASPSP_IDP -> ASPSP_API: Trigger push notification to Customer

note right of ASPSP_API
The push notification needs to carry some context.
For example, the ""consentId"" - to require the
consent to be correlated correctly.
end note

MOBILE <- ASPSP_API: Send push notification to mobile banking app
MOBILE -> PSU: Notify Customer

MOBILE <- - PSU: Tap notification
MOBILE -> PSU: Request biometric\ngesture to authenticate
MOBILE <- - PSU: Present biometric\ngesture

note right of ASPSP_IDP
As with the majority of mobile banking apps authentication
in this example is outsourced to the mobile operating system.
Once the customer has authenticated the mobile banking app
simply sends a "user authenticated" notification to the IDP.
|||
This flow is non-normative, implementation-specific and 
would be created based on the implementors architecture
and technology. 
end note

MOBILE -> ASPSP_IDP: User authenticated notification
MOBILE <- - ASPSP_IDP: Acknowledgement
MOBILE -> ASPSP_API: Request Customer accounts
MOBILE <- - ASPSP_API: Response

== Part 3: Customer Confirms Consent and Selects Account ==

note left of MOBILE
As Consent needs to be retrieved from a hostile security zone
i.e. from a Customer's mobile device the request to Consent
Management should be routed via the Ingress Controller/API
Gateway. This flow is implementation-specific and would be
created based on the implementors architecture and technology.
|||
In this example the Customer is the sole account
holder and therefore no further authorizations are required.
end note

MOBILE -> INGRESS: Retrieve consent
INGRESS -> API_GATEWAY: Retrieve consent
API_GATEWAY -> CONSENT: Retrieve consent
CONSENT -> CONSENT: Retrieve Consent
API_GATEWAY <- - CONSENT: Response
INGRESS <- - API_GATEWAY: Response
MOBILE <- - INGRESS: Response

note right of ASPSP_API
The Consent Confirmation screen requires the following properties to be displayed:
* Transaction Value.
* Recipient details (name, CPF/CNPJ).
* Payment Date.
* Payment method (currently fixed on PIX).
* Fee amount charged by the bank (if any).
end note

par Request fee amount for payment

note right of ASPSP_API
Fees for payment must be provided from the Banking Systems
end note

MOBILE -> ASPSP_API: Request fee amount
MOBILE <- - ASPSP_API: Response

else

alt Debtor account not provided in Consent

note right of ASPSP_API
If the debtor account has not been provided in the Consent then
the customer's payment accounts will need to be retrieved:

* If the customer only has one payment account then this is the default.
* If they have multiple accounts they should be able to select one.

This should be incorporated into the Consent Confirmation screen.
end note

MOBILE -> MOBILE: Query account list for payment accounts

else Debtor account provided in Consent

note right of ASPSP_API
If the debtor account has already been provided ownership of the
account by the customer **must** be verified. In this example this
can be done at the Mobile Banking App as it has already retrieved
the list of customer accounts.
end note

MOBILE -> MOBILE: Verify debtor account ownership

end alt

end par

MOBILE -> MOBILE: Render consent\nconfirmation screen
MOBILE -> PSU: Request consent\nconfirmation
MOBILE <- - PSU: Confirm consent

MOBILE -> INGRESS: Update consent as authorized
INGRESS -> API_GATEWAY: Update consent as authorized
API_GATEWAY -> CONSENT: Update consent
CONSENT -> CONSENT: Update Consent
API_GATEWAY <- - CONSENT: Response
INGRESS <- - API_GATEWAY: Response
MOBILE <- - INGRESS: Response

note left of MOBILE
The final step is to call the Identity Management
component to indicate that the Customer has been
authenticated. Identity Management will then signal
to the Third-Party App using the chosen mode that
authentication is complete. Again this flow is
implementation-specific and would be created based
on the implementors architecture and technology.
end note

MOBILE -> API_GATEWAY: Authentication complete notification
API_GATEWAY -> IAM: Forward authentication complete notification

== Part 4: Client Granted Access Token ==

note right of TPP
Notes on Token behaviors
===
The Third-Party App is made aware of the success of the
based on their registered delivery mode. Each of these is
shown below.
|||
Note that the Poll looping example is purely illustrative
as the Third-Party App would poll as soon as they received
the ""auth_req_id"" from the AS. Writing the diagram to
incorporate this sequentially would, however be extremely confusing
hence the sequence shown below.
|||
For Poll and Ping mode the Third-Party App must use the
[[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1 CIBA grant type]] as described in the source specification.
end note

alt Client Registered Poll Mode

note right of TPP
In Poll mode the TPP will periodically call the Token endpoint
until they get a positive response i.e. they do not receive
the 400 HTTP response code but instead are returned one-or-more
tokens (Access, Refresh, ID) from the Token endpoint.
end note

loop Exit when Authentication Request successful
TPP -> INGRESS: ""POST /token auth_req_id=...""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Forward token request
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Check status
API_GATEWAY <- - IAM: ""400 Bad Request {...}""
INGRESS <- - API_GATEWAY: ""400 Bad Request {...}""
TPP <- - INGRESS: ""400 Bad Request {...}""
end loop

TPP -> INGRESS: ""POST /token auth_req_id=...""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Forward token request
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Check status
IAM -> IAM: Create tokens
API_GATEWAY <- - IAM: ""200 OK {...}""
INGRESS <- - API_GATEWAY: ""200 OK {...}""
TPP <- - INGRESS: ""200 OK {...}""

else Client Registered Ping Mode

note right of TPP
Ping mode is a simple notification by the AS to a callback
URL pre-registered by the Third-Party App in Part 0. On
receipt the Third-Party App can then call the Token endpoint
in the same way as in Poll mode and collect one-or-more tokens.
end note

TPP <- IAM: Authentication Request complete notification
TPP - -> IAM: ""204 No Content""

TPP -> INGRESS: ""POST /token auth_req_id=...""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: Forward token request
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Create tokens
API_GATEWAY <- - IAM: ""200 OK {...}""
INGRESS <- - API_GATEWAY: ""200 OK {...}""
TPP <- - INGRESS: ""200 OK {...}""

else Client Registered Push Mode

note right of TPP
In Push mode tokens are created by the AS and then transmitted
to the Third-Party App, therefore negating the need for them to
visit the Token endpoint. Their are various implications of using
this method which are discussed in the [[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3 specification]].
end note

IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Create tokens
IAM -> IAM: Retrieve callback URL and security\ntoken for Third-Party App

TPP <- IAM: ""POST /cb {...}""
TPP - -> IAM: ""204 No Content""

end alt

== Part 5: TPP Makes Payment Instruction Request ==

note right of TPP
With the Access Token in hand the Third-Party App can now
make the payment instruction request. The Access Token
is bound to this single operation and will be revoked once
the payment instruction is successfully transmitted.
end note

TPP -> INGRESS: ""POST /payments/v1/pix/payments""
INGRESS -> OCSP: Check Client Certificate Validity
INGRESS <- - OCSP: Response
INGRESS -> API_GATEWAY: ""POST /payments/v1/pix/payments""

note right of API_GATEWAY
The approach to Access Token introspection remains the same under payments
i.e. the API Gateway will need an assertion that indicates the consent granted
by the Customer matches the payment being instructed.
end note

API_GATEWAY -> CONSENT: Request Access Token properties
CONSENT -> CONSENT: Retrieve Access Token properties
API_GATEWAY <- - CONSENT: Response
API_GATEWAY -> API_GATEWAY: Introspect Access Token properties

note right of API_GATEWAY
On introspecting the Access Token the API Gateway will decorate the
request with the debtor account which is stored with the Consent. This can
then be forwarded to the API Builder application and used to make the correct
payment instruction in the Banking Systems.
end note

API_GATEWAY -> API_GATEWAY: Decorate request with debtor account
API_GATEWAY -> API_BUILDER: ""POST /payments/v1/pix/payments""

note right of API_BUILDER
This flow is non-normative and will vary on customer requirements.
It //could// be to a PIX-compliant API or any other available mechanism
to make a PIX payment.
end note

API_BUILDER -> API_BUILDER: Mediate request payload
API_BUILDER -> ASPSP_API: Deliver payment instruction to Banking System API
API_BUILDER <- - ASPSP_API: Response
API_BUILDER -> API_BUILDER: Mediate response payload
API_GATEWAY <- - API_BUILDER: ""201 Created""\n""{paymentId: "..."}""
INGRESS <- - API_GATEWAY: ""201 Created""\n""{paymentId: "..."}""
TPP <- - INGRESS: ""201 Created""\n""{paymentId: "..."}""

@enduml

PlantUML version 1.2021.7(Sun May 23 13:40:07 BST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>