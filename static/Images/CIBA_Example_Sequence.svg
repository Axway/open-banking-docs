<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="6413px" preserveAspectRatio="none" style="width:1942px;height:6413px;background:#FFFFFF;" version="1.1" viewBox="0 0 1942 6413" width="1942px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ugn405s546m4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="969.75" y="28.6992"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="969.75" y="49.793"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="969.75" y="70.8867"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="969.75" y="91.9805"/><rect fill="#E06666" height="6295.8516" style="stroke:#A80036;stroke-width:1.0;" width="339.5" x="297" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="410.25" y="116.4355">Open Banking APIs</text><rect fill="#94C47D" height="6295.8516" style="stroke:#A80036;stroke-width:1.0;" width="318" x="658.5" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="736.5" y="116.4355">Identity and Access Control</text><rect fill="#D5A6BD" height="6295.8516" style="stroke:#A80036;stroke-width:1.0;" width="312.5" x="1098" y="104.375"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="1177.25" y="116.4355">Core Banking Applications</text><rect fill="#FFFFFF" filter="url(#f1ugn405s546m4)" height="217.7656" style="stroke:#000000;stroke-width:2.0;" width="243" x="1682.5" y="3456.3047"/><rect fill="#FFFFFF" height="161.2969" style="stroke:none;stroke-width:1.0;" width="243" x="1682.5" y="3512.7734"/><rect fill="#FFFFFF" filter="url(#f1ugn405s546m4)" height="1412.5781" style="stroke:#000000;stroke-width:2.0;" width="1692.5" x="10" y="4287.1641"/><rect fill="#FFFFFF" filter="url(#f1ugn405s546m4)" height="276.8047" style="stroke:#000000;stroke-width:2.0;" width="1672.5" x="20" y="4396.3359"/><rect fill="#FFFFFF" height="417.7656" style="stroke:none;stroke-width:1.0;" width="1692.5" x="10" y="4981.9453"/><rect fill="#FFFFFF" height="300.0313" style="stroke:none;stroke-width:1.0;" width="1692.5" x="10" y="5399.7109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="74" x2="74" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="338" x2="338" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="601.5" x2="601.5" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="712.5" x2="712.5" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="921.5" x2="921.5" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1137" x2="1137" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1370.5" x2="1370.5" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1492.5" x2="1492.5" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1625.5" x2="1625.5" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1726.5" x2="1726.5" y1="191.8281" y2="6406.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1881.5" x2="1881.5" y1="191.8281" y2="6406.2266"/><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="84" x="30" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="37" y="160.0039">Third-Party</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="59.5" y="176.4102">App</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="70" x="301" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="325" y="160.0039">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="308" y="176.4102">Gateway</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="57" x="571.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="589" y="160.0039">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="43" x="578.5" y="176.4102">Builder</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="662.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="687.5" y="160.0039">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="669.5" y="176.4102">Management</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="871.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="894" y="160.0039">Consent</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="878.5" y="176.4102">Management</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="66" x="1102" y="123.6094"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1109.5" y="143.5977">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="1111.5" y="160.0039">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="1109" y="176.4102">Provider</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1335.5" y="140.0156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1343.5" y="160.0039">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="53" x="1342.5" y="176.4102">Systems</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="79.625" style="stroke:#A80036;stroke-width:1.5;" width="129" x="1426.5" y="107.2031"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="87" x="1447.5" y="127.1914">Open Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="1463" y="143.5977">Directory</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="1485" y="160.0039">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="115" x="1433.5" y="176.4102">JSON Web Key Set</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="79.625" style="stroke:#A80036;stroke-width:1.5;" width="109" x="1569.5" y="107.2031"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="64" x="1592" y="127.1914">Certificate</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="58" x="1595" y="143.5977">Authority</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="12" x="1618" y="160.0039">---</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="95" x="1576.5" y="176.4102">OCSP Endpoint</text><rect fill="#FEFECE" filter="url(#f1ugn405s546m4)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="65" x="1692.5" y="123.6094"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="41" x="1704.5" y="143.5977">Mobile</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1699.5" y="160.0039">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="1712.5" y="176.4102">App</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="61" x="1848.5" y="188.4102">Customer</text><ellipse cx="1882" cy="118.4219" fill="#FEFECE" filter="url(#f1ugn405s546m4)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1882,126.4219 L1882,153.4219 M1869,134.4219 L1895,134.4219 M1882,153.4219 L1869,168.4219 M1882,153.4219 L1895,168.4219 " fill="none" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1935.5" x="0" y="222.4453"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="222.4453" y2="222.4453"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="225.4453" y2="225.4453"/><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="306" x="814.75" y="211.8281"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="289" x="820.75" y="227.8887">Part 0: Registration of Token Delivery Preferences</text><path d="M79,250.0625 L79,504.0625 L497,504.0625 L497,260.0625 L487,250.0625 L79,250.0625 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M487,250.0625 L487,260.0625 L497,260.0625 L487,250.0625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="344" x="85" y="267.123">CIBA requires that Clients register a delivery mode prior to the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="257" x="85" y="282.3574">transmission of any Authentication Requests:</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="287.5313" y2="287.5313"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="287.5313" y2="287.5313"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="287.5313" y2="287.5313"/><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="383" x="85" y="301.5918">Clients registering to use CIBA MUST indicate a token delivery mode</text></a><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="306.7656" y2="306.7656"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="306.7656" y2="306.7656"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="306.7656" y2="306.7656"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="358" x="85" y="320.8262">The Authorization Server (AS) therefore must host a registration</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="343" x="85" y="336.0605">endpoint - defined in the discoverable OpenID Configuration -</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="85" y="351.2949">that allows the Client to do so. The parameters for this call</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="339" x="85" y="366.5293">are described in the CIBA specification and differ depending</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="240" x="85" y="381.7637">on the method in question. The modes are:</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="386.9375" y2="386.9375"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="386.9375" y2="386.9375"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="386.9375" y2="386.9375"/><ellipse cx="90.5" cy="396.6719" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="97" y="400.998">Poll</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="183" x="118" y="400.998">: Client polls the Token endpoint.</text><ellipse cx="90.5" cy="411.9063" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="97" y="416.2324">Ping</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="282" x="122" y="416.2324">: AS notifies, Client retrieves from Token endpoint.</text><ellipse cx="90.5" cy="427.1406" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="97" y="431.4668">Push</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="154" x="126" y="431.4668">: AS sends tokens to Client.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="436.6406" y2="436.6406"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="436.6406" y2="436.6406"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="436.6406" y2="436.6406"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="392" x="85" y="450.7012">The supported modes vary by AS as they are implementor specific i.e.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="393" x="85" y="465.9355">implementors of the AS can choose to only support one-or-more given</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="397" x="85" y="481.1699">modes. The supported modes must be made pushed in the AS OpenID</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="85" y="496.4043">Configuration.</text><polygon fill="#A80036" points="326,530.7109,336,534.7109,326,538.7109,330,534.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="534.7109" y2="534.7109"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="81" y="529.645">POST /connect/register</text><path d="M343,547.7109 L343,587.7109 L680,587.7109 L680,557.7109 L670,547.7109 L343,547.7109 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M670,547.7109 L670,557.7109 L680,557.7109 L670,547.7109 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="316" x="349" y="564.7715">In this diagram the API Gateway acts as a proxy for both</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="197" x="349" y="580.0059">Identity and Consent Management.</text><polygon fill="#A80036" points="1614,614.4141,1624,618.4141,1614,622.4141,1618,618.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="618.4141" y2="618.4141"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="613.2402">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,643.6484,339,647.6484,349,651.6484,345,647.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="647.6484" y2="647.6484"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="642.4746">Response</text><polygon fill="#A80036" points="701,672.8828,711,676.8828,701,680.8828,705,676.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="676.8828" y2="676.8828"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="345" y="671.709">Registration Request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="706.1172" y2="706.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="706.1172" y2="719.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="719.1172" y2="719.1172"/><polygon fill="#A80036" points="724,715.1172,714,719.1172,724,723.1172,720,719.1172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="68" x="720" y="700.9434">Verify Client</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="748.3516" y2="748.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="748.3516" y2="761.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="761.3516" y2="761.3516"/><polygon fill="#A80036" points="724,757.3516,714,761.3516,724,765.3516,720,761.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="720" y="743.1777">Store Client Parameters</text><polygon fill="#A80036" points="349,786.5859,339,790.5859,349,794.5859,345,790.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="712" y1="790.5859" y2="790.5859"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="785.4121">Response</text><polygon fill="#A80036" points="85,815.8203,75,819.8203,85,823.8203,81,819.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="819.8203" y2="819.8203"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="91" y="814.6465">Response</text><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1935.5" x="0" y="848.4375"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="848.4375" y2="848.4375"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="851.4375" y2="851.4375"/><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="340" x="797.75" y="837.8203"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="323" x="803.75" y="853.8809">Part 1: Create Consent and Send Authentication Request</text><path d="M79,876.0547 L79,946.0547 L425,946.0547 L425,886.0547 L415,876.0547 L79,876.0547 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M415,876.0547 L415,886.0547 L425,886.0547 L415,876.0547 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="85" y="893.1152">The Third-Party App requests an Access Token using</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="325" x="85" y="908.3496">the Client Credentials grant type. Nominally authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="85" y="923.584">is through Mutual Authentication over TLS but it could</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="91" x="85" y="938.8184">equally be using</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="179" y="938.9263">private_key_jwt</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="299" y="938.8184">.</text><polygon fill="#A80036" points="326,973.125,336,977.125,326,981.125,330,977.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="977.125" y2="977.125"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="81" y="972.0591">POST /token</text><polygon fill="#A80036" points="1614,1002.3594,1624,1006.3594,1614,1010.3594,1618,1006.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="1006.3594" y2="1006.3594"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="1001.1855">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,1031.5938,339,1035.5938,349,1039.5938,345,1035.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="1035.5938" y2="1035.5938"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1030.4199">Response</text><polygon fill="#A80036" points="701,1060.8281,711,1064.8281,701,1068.8281,705,1064.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="1064.8281" y2="1064.8281"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="128" x="345" y="1059.6543">Access Token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="1094.0625" y2="1094.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="1094.0625" y2="1107.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="1107.0625" y2="1107.0625"/><polygon fill="#A80036" points="724,1103.0625,714,1107.0625,724,1111.0625,720,1107.0625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="68" x="720" y="1088.8887">Verify Client</text><polygon fill="#A80036" points="349,1132.2969,339,1136.2969,349,1140.2969,345,1136.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="712" y1="1136.2969" y2="1136.2969"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="117" x="355" y="1131.123">Issue Access Token</text><polygon fill="#A80036" points="85,1176.5625,75,1180.5625,85,1184.5625,81,1180.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1180.5625" y2="1180.5625"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="91" y="1160.3638">200 OK</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="91" y="1175.4966">{"access_token": "..."}</text><path d="M79,1193.5625 L79,1263.5625 L422,1263.5625 L422,1203.5625 L412,1193.5625 L79,1193.5625 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M412,1193.5625 L412,1203.5625 L422,1203.5625 L412,1193.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="314" x="85" y="1210.623">With the Access Token in hand the Third-Party can then</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="1225.8574">create the consent resource. This needs to be completed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="300" x="85" y="1241.0918">before the Authentication Request as the value of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="85" y="1256.4341">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="225" x="160" y="1256.3262">is required to set the value of the scope.</text><polygon fill="#A80036" points="326,1290.6328,336,1294.6328,326,1298.6328,330,1294.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="1294.6328" y2="1294.6328"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="81" y="1289.5669">POST /payments/v1/consents</text><polygon fill="#A80036" points="1614,1319.8672,1624,1323.8672,1614,1327.8672,1618,1323.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="1323.8672" y2="1323.8672"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="1318.6934">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,1349.1016,339,1353.1016,349,1357.1016,345,1353.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="1353.1016" y2="1353.1016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1347.9277">Response</text><polygon fill="#A80036" points="910,1378.2344,920,1382.2344,910,1386.2344,914,1382.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="916" y1="1382.2344" y2="1382.2344"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="345" y="1377.1685">POST /payments/v1/consents</text><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="964" y1="1411.4688" y2="1411.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="964" x2="964" y1="1411.4688" y2="1424.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="923" x2="964" y1="1424.4688" y2="1424.4688"/><polygon fill="#A80036" points="933,1420.4688,923,1424.4688,933,1428.4688,929,1424.4688" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="201" x="929" y="1406.2949">Validate consent request properties</text><polygon fill="#A80036" points="349,1464.7344,339,1468.7344,349,1472.7344,345,1468.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="921" y1="1468.7344" y2="1468.7344"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="1448.5356">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="355" y="1463.6685">{consentId: "..."}</text><polygon fill="#A80036" points="85,1509,75,1513,85,1517,81,1513" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="1513" y2="1513"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="1492.8013">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="91" y="1507.9341">{consentId: "..."}</text><path d="M79,1526 L79,1581 L463,1581 L463,1536 L453,1526 L79,1526 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,1526 L453,1536 L463,1536 L453,1526 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="1543.0605">The Third-Party App can now create and send the Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="352" x="85" y="1558.2949">Request. This includes the dynamic scope that holds the value</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="33" x="85" y="1573.5293">of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="121" y="1573.6372">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="189" x="196" y="1573.5293">returned by Identity Management.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="116" y1="1611.9375" y2="1611.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="116" x2="116" y1="1611.9375" y2="1624.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="75" x2="116" y1="1624.9375" y2="1624.9375"/><polygon fill="#A80036" points="85,1620.9375,75,1624.9375,85,1628.9375,81,1624.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="172" x="81" y="1606.7637">Create Authentication Request</text><polygon fill="#A80036" points="326,1650.0703,336,1654.0703,326,1658.0703,330,1654.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="1654.0703" y2="1654.0703"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="81" y="1649.0044">POST /bc-authorize</text><polygon fill="#A80036" points="1614,1679.3047,1624,1683.3047,1614,1687.3047,1618,1683.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="1683.3047" y2="1683.3047"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="1678.1309">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,1708.5391,339,1712.5391,349,1716.5391,345,1712.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="1712.5391" y2="1712.5391"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1707.3652">Response</text><path d="M343,1725.5391 L343,1811.5391 L776,1811.5391 L776,1735.5391 L766,1725.5391 L343,1725.5391 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M766,1725.5391 L766,1735.5391 L776,1735.5391 L766,1725.5391 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="347" x="349" y="1742.5996">As with the redirection-based FAPI profiles the Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="330" x="349" y="1757.834">Request is a JSON Web Signature. It therefore needs to be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="339" x="349" y="1773.0684">checked for validity. Note that in the context of CIBA Pushed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="380" x="349" y="1788.3027">Authorization Request is not required as the Authentication Request</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="412" x="349" y="1803.5371">is always sent via a secured backchannel and never through the browser.</text><polygon fill="#A80036" points="1481,1837.9453,1491,1841.9453,1481,1845.9453,1485,1841.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1487" y1="1841.9453" y2="1841.9453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="345" y="1836.7715">Get JSON Web Key Set</text><polygon fill="#A80036" points="349,1867.1797,339,1871.1797,349,1875.1797,345,1871.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1492" y1="1871.1797" y2="1871.1797"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="1866.0059">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="380" y1="1915.6484" y2="1915.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="380" x2="380" y1="1915.6484" y2="1928.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="339" x2="380" y1="1928.6484" y2="1928.6484"/><polygon fill="#A80036" points="349,1924.6484,339,1928.6484,349,1932.6484,345,1928.6484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="121" x="345" y="1895.2402">Match Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="108" x="345" y="1910.4746">Request parameter</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="456" y="1910.5825">kid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="380" y1="1973.1172" y2="1973.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="380" x2="380" y1="1973.1172" y2="1986.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="339" x2="380" y1="1986.1172" y2="1986.1172"/><polygon fill="#A80036" points="349,1982.1172,339,1986.1172,349,1990.1172,345,1986.1172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="345" y="1952.709">Verify Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="164" x="345" y="1967.9434">Request parameter signature</text><polygon fill="#A80036" points="701,2011.3516,711,2015.3516,701,2019.3516,705,2015.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="2015.3516" y2="2015.3516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="181" x="345" y="2010.1777">Forward Authentication Request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="2044.5859" y2="2044.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="2044.5859" y2="2057.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="2057.5859" y2="2057.5859"/><polygon fill="#A80036" points="724,2053.5859,714,2057.5859,724,2061.5859,720,2057.5859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="181" x="720" y="2039.4121">Validate Authentication Request</text><path d="M718,2070.5859 L718,2125.5859 L1027,2125.5859 L1027,2080.5859 L1017,2070.5859 L718,2070.5859 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1017,2070.5859 L1017,2080.5859 L1027,2080.5859 L1017,2070.5859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="287" x="724" y="2087.6465">Note this approach is non-normative and the actual</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="288" x="724" y="2102.8809">implementation required should be considered on a</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="724" y="2118.1152">case-by-case basis.</text><polygon fill="#A80036" points="1125,2152.5234,1135,2156.5234,1125,2160.5234,1129,2156.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="1131" y1="2156.5234" y2="2156.5234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="231" x="720" y="2151.3496">Send Authentication Request notification</text><polygon fill="#A80036" points="349,2196.7891,339,2200.7891,349,2204.7891,345,2200.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="712" y1="2200.7891" y2="2200.7891"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="2180.5903">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="355" y="2195.7231">{auth_req_id: "..."}</text><polygon fill="#A80036" points="85,2241.0547,75,2245.0547,85,2249.0547,81,2245.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="2245.0547" y2="2245.0547"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="2224.856">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="91" y="2239.9888">{auth_req_id: "..."}</text><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1935.5" x="0" y="2273.6719"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="2273.6719" y2="2273.6719"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="2276.6719" y2="2276.6719"/><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="328" x="803.75" y="2263.0547"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="311" x="809.75" y="2279.1152">Part 2: Customer Authenticates at Mobile Banking App</text><path d="M1142,2301.2891 L1142,2387.2891 L1483,2387.2891 L1483,2311.2891 L1473,2301.2891 L1142,2301.2891 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1473,2301.2891 L1473,2311.2891 L1483,2311.2891 L1473,2301.2891 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="306" x="1148" y="2318.3496">The flow shown is a hypothetical approach to allowing</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="320" x="1148" y="2333.584">the End User to authenticate and confirm consent. In this</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="1148" y="2348.8184">scenario has installed their mobile banking app and can</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="319" x="1148" y="2364.0527">receive and act-on a request to authenticate and confirm</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="49" x="1148" y="2379.2871">consent.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1137" x2="1179" y1="2432.9297" y2="2432.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1179" x2="1179" y1="2432.9297" y2="2445.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1138" x2="1179" y1="2445.9297" y2="2445.9297"/><polygon fill="#A80036" points="1148,2441.9297,1138,2445.9297,1148,2449.9297,1144,2445.9297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="136" x="1144" y="2412.5215">Correlate Authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="132" x="1144" y="2427.7559">Request with Customer</text><polygon fill="#A80036" points="1359,2471.1641,1369,2475.1641,1359,2479.1641,1363,2475.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137" x2="1365" y1="2475.1641" y2="2475.1641"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="210" x="1144" y="2469.9902">Trigger push notification to Customer</text><path d="M1376,2488.1641 L1376,2543.1641 L1683,2543.1641 L1683,2498.1641 L1673,2488.1641 L1376,2488.1641 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1673,2488.1641 L1673,2498.1641 L1683,2498.1641 L1673,2488.1641 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="1382" y="2505.2246">The push notification needs to carry some context.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="93" x="1382" y="2520.459">For example, the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="1478" y="2520.5669">consentId</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="81" x="1553" y="2520.459">- to require the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="192" x="1382" y="2535.6934">consent to be correlated correctly.</text><polygon fill="#A80036" points="1715,2570.1016,1725,2574.1016,1715,2578.1016,1719,2574.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1371" x2="1721" y1="2574.1016" y2="2574.1016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="254" x="1378" y="2568.9277">Send push notification to mobile banking app</text><polygon fill="#A80036" points="1870,2599.3359,1880,2603.3359,1870,2607.3359,1874,2603.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1727" x2="1876" y1="2603.3359" y2="2603.3359"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="92" x="1734" y="2598.1621">Notify Customer</text><polygon fill="#A80036" points="1738,2628.5703,1728,2632.5703,1738,2636.5703,1734,2632.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1732" x2="1881" y1="2632.5703" y2="2632.5703"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1744" y="2627.3965">Tap notification</text><polygon fill="#A80036" points="1870,2673.0391,1880,2677.0391,1870,2681.0391,1874,2677.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1727" x2="1876" y1="2677.0391" y2="2677.0391"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="103" x="1734" y="2656.6309">Request biometric</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="1734" y="2671.8652">gesture to authenticate</text><polygon fill="#A80036" points="1738,2717.5078,1728,2721.5078,1738,2725.5078,1734,2721.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1732" x2="1881" y1="2721.5078" y2="2721.5078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="100" x="1744" y="2701.0996">Present biometric</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="43" x="1744" y="2716.334">gesture</text><path d="M1142,2734.5078 L1142,2854.5078 L1510,2854.5078 L1510,2744.5078 L1500,2734.5078 L1142,2734.5078 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1500,2734.5078 L1500,2744.5078 L1510,2744.5078 L1500,2734.5078 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="330" x="1148" y="2751.5684">As with the majority of mobile banking apps authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="345" x="1148" y="2766.8027">in this example is outsourced to the mobile operating system.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="347" x="1148" y="2782.0371">Once the customer has authenticated the mobile banking app</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="331" x="1148" y="2797.2715">simply sends a "user authenticated" notification to the IDP.</text><line style="stroke:#000000;stroke-width:1.0;" x1="1148" x2="1148" y1="2802.4453" y2="2802.4453"/><line style="stroke:#000000;stroke-width:1.0;" x1="1148" x2="1148" y1="2802.4453" y2="2802.4453"/><line style="stroke:#000000;stroke-width:1.0;" x1="1148" x2="1148" y1="2802.4453" y2="2802.4453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="318" x="1148" y="2816.5059">This flow is non-normative, implementation-specific and</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="325" x="1148" y="2831.7402">would be created based on the implementors architecture</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1148" y="2846.9746">and technology.</text><polygon fill="#A80036" points="1148,2881.3828,1138,2885.3828,1148,2889.3828,1144,2885.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1142" x2="1726" y1="2885.3828" y2="2885.3828"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="174" x="1154" y="2880.209">User authenticated notification</text><polygon fill="#A80036" points="1715,2910.6172,1725,2914.6172,1715,2918.6172,1719,2914.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1137" x2="1721" y1="2914.6172" y2="2914.6172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="1144" y="2909.4434">Acknowledgement</text><polygon fill="#A80036" points="1382,2939.8516,1372,2943.8516,1382,2947.8516,1378,2943.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1376" x2="1726" y1="2943.8516" y2="2943.8516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="161" x="1388" y="2938.6777">Request Customer accounts</text><polygon fill="#A80036" points="1715,2969.0859,1725,2973.0859,1715,2977.0859,1719,2973.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1371" x2="1721" y1="2973.0859" y2="2973.0859"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1378" y="2967.9121">Response</text><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1935.5" x="0" y="3001.7031"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="3001.7031" y2="3001.7031"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="3004.7031" y2="3004.7031"/><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="344" x="795.75" y="2991.0859"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="327" x="801.75" y="3007.1465">Part 3: Customer Confirms Consent and Selects Account</text><path d="M1352,3029.3203 L1352,3149.3203 L1718,3149.3203 L1718,3039.3203 L1708,3029.3203 L1352,3029.3203 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1708,3029.3203 L1708,3039.3203 L1718,3039.3203 L1708,3029.3203 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="345" x="1358" y="3046.3809">As Consent needs to be retrieved from a hostile security zone</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="335" x="1358" y="3061.6152">i.e. from a Customer's mobile device the request to Consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="319" x="1358" y="3076.8496">Management should be routed via the API Gateway. This</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="1358" y="3092.084">flow is implementation-specific and would be created</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="317" x="1358" y="3107.3184">based on the implementors architecture and technology.</text><line style="stroke:#000000;stroke-width:1.0;" x1="1358" x2="1358" y1="3112.4922" y2="3112.4922"/><line style="stroke:#000000;stroke-width:1.0;" x1="1358" x2="1358" y1="3112.4922" y2="3112.4922"/><line style="stroke:#000000;stroke-width:1.0;" x1="1358" x2="1358" y1="3112.4922" y2="3112.4922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="275" x="1358" y="3126.5527">In this example the Customer is the sole account</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="1358" y="3141.7871">holder and therefore no further authorizations are required.</text><polygon fill="#A80036" points="349,3176.1953,339,3180.1953,349,3184.1953,345,3180.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="1726" y1="3180.1953" y2="3180.1953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="95" x="355" y="3175.0215">Retrieve consent</text><polygon fill="#A80036" points="910,3205.4297,920,3209.4297,910,3213.4297,914,3209.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="916" y1="3209.4297" y2="3209.4297"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="95" x="345" y="3204.2559">Retrieve consent</text><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="964" y1="3238.6641" y2="3238.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="964" x2="964" y1="3238.6641" y2="3251.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="923" x2="964" y1="3251.6641" y2="3251.6641"/><polygon fill="#A80036" points="933,3247.6641,923,3251.6641,933,3255.6641,929,3251.6641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="929" y="3233.4902">Retrieve Consent</text><polygon fill="#A80036" points="349,3276.8984,339,3280.8984,349,3284.8984,345,3280.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="921" y1="3280.8984" y2="3280.8984"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="3275.7246">Response</text><polygon fill="#A80036" points="1715,3306.1328,1725,3310.1328,1715,3314.1328,1719,3310.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="338" x2="1721" y1="3310.1328" y2="3310.1328"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="345" y="3304.959">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1727" x2="1769" y1="3354.6016" y2="3354.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1769" x2="1769" y1="3354.6016" y2="3367.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1728" x2="1769" y1="3367.6016" y2="3367.6016"/><polygon fill="#A80036" points="1738,3363.6016,1728,3367.6016,1738,3371.6016,1734,3367.6016" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1734" y="3334.1934">Render consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="1734" y="3349.4277">confirmation screen</text><polygon fill="#A80036" points="1870,3408.0703,1880,3412.0703,1870,3416.0703,1874,3412.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1727" x2="1876" y1="3412.0703" y2="3412.0703"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="1734" y="3391.6621">Request consent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="72" x="1734" y="3406.8965">confirmation</text><polygon fill="#A80036" points="1738,3437.3047,1728,3441.3047,1738,3445.3047,1734,3441.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1732" x2="1881" y1="3441.3047" y2="3441.3047"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="94" x="1744" y="3436.1309">Confirm consent</text><path d="M1682.5,3456.3047 L1741.5,3456.3047 L1741.5,3463.3047 L1731.5,3473.3047 L1682.5,3473.3047 L1682.5,3456.3047 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="217.7656" style="stroke:#000000;stroke-width:2.0;" width="243" x="1682.5" y="3456.3047"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1697.5" y="3469.3652">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="1756.5" y="3468.5098">[Account included in consent]</text><path d="M1732,3478.5391 L1732,3503.5391 L1814,3503.5391 L1814,3488.5391 L1804,3478.5391 L1732,3478.5391 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1804,3478.5391 L1804,3488.5391 L1814,3488.5391 L1804,3478.5391 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="61" x="1738" y="3495.5996">Do nothing</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1682.5" x2="1925.5" y1="3513.7734" y2="3513.7734"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="140" x="1687.5" y="3523.9785">[Account selection required]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1727" x2="1769" y1="3564.1328" y2="3564.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1769" x2="1769" y1="3564.1328" y2="3577.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1728" x2="1769" y1="3577.1328" y2="3577.1328"/><polygon fill="#A80036" points="1738,3573.1328,1728,3577.1328,1738,3581.1328,1734,3577.1328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="1734" y="3543.7246">Render account</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="94" x="1734" y="3558.959">selection screen</text><polygon fill="#A80036" points="1870,3617.6016,1880,3621.6016,1870,3625.6016,1874,3621.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1727" x2="1876" y1="3621.6016" y2="3621.6016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="1734" y="3601.1934">Request account</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="52" x="1734" y="3616.4277">selection</text><polygon fill="#A80036" points="1738,3662.0703,1728,3666.0703,1738,3670.0703,1734,3666.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1732" x2="1881" y1="3666.0703" y2="3666.0703"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="88" x="1744" y="3645.6621">Select payment</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="46" x="1744" y="3660.8965">account</text><polygon fill="#A80036" points="349,3698.3047,339,3702.3047,349,3706.3047,345,3702.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="1726" y1="3702.3047" y2="3702.3047"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="168" x="355" y="3697.1309">Update consent as authorized</text><polygon fill="#A80036" points="910,3727.5391,920,3731.5391,910,3735.5391,914,3731.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="916" y1="3731.5391" y2="3731.5391"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="89" x="345" y="3726.3652">Update consent</text><line style="stroke:#A80036;stroke-width:1.0;" x1="922" x2="964" y1="3760.7734" y2="3760.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="964" x2="964" y1="3760.7734" y2="3773.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="923" x2="964" y1="3773.7734" y2="3773.7734"/><polygon fill="#A80036" points="933,3769.7734,923,3773.7734,933,3777.7734,929,3773.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="90" x="929" y="3755.5996">Update Consent</text><polygon fill="#A80036" points="349,3799.0078,339,3803.0078,349,3807.0078,345,3803.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="921" y1="3803.0078" y2="3803.0078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="3797.834">Response</text><polygon fill="#A80036" points="1715,3828.2422,1725,3832.2422,1715,3836.2422,1719,3832.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="338" x2="1721" y1="3832.2422" y2="3832.2422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="345" y="3827.0684">Response</text><path d="M1397,3845.2422 L1397,3961.2422 L1718,3961.2422 L1718,3855.2422 L1708,3845.2422 L1397,3845.2422 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1708,3845.2422 L1708,3855.2422 L1718,3855.2422 L1708,3845.2422 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="272" x="1403" y="3862.3027">The final step is to call the Identity Management</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="285" x="1403" y="3877.5371">component to indicate that the Customer has been</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="291" x="1403" y="3892.7715">authenticated. Identity Management will then signal</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="282" x="1403" y="3908.0059">to the Third-Party App using the chosen mode that</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="253" x="1403" y="3923.2402">authentication is complete. Again this flow is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="300" x="1403" y="3938.4746">implementation-specific and would be created based</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="279" x="1403" y="3953.709">on the implementors architecture and technology.</text><polygon fill="#A80036" points="349,3988.1172,339,3992.1172,349,3996.1172,345,3992.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="343" x2="1726" y1="3992.1172" y2="3992.1172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="205" x="355" y="3986.9434">Authentication complete notification</text><polygon fill="#A80036" points="701,4017.3516,711,4021.3516,701,4025.3516,705,4021.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="4021.3516" y2="4021.3516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="253" x="345" y="4016.1777">Forward authentication complete notification</text><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1935.5" x="0" y="4049.9688"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="4049.9688" y2="4049.9688"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="4052.9688" y2="4052.9688"/><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="226" x="854.75" y="4039.3516"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="209" x="860.75" y="4055.4121">Part 4: Client Granted Access Token</text><path d="M79,4077.5859 L79,4270.5859 L485,4270.5859 L485,4087.5859 L475,4077.5859 L79,4077.5859 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M475,4077.5859 L475,4087.5859 L485,4087.5859 L475,4077.5859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="148" x="85" y="4094.6465">Notes on Token behaviors</text><line style="stroke:#A80036;stroke-width:1.0;" x1="80" x2="484" y1="4097.8203" y2="4097.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="80" x2="484" y1="4099.8203" y2="4099.8203"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="4113.8809">The Third-Party App is made aware of the success of the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="318" x="85" y="4129.1152">based on their registered delivery mode. Each of these is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="78" x="85" y="4144.3496">shown below.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4149.5234" y2="4149.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4149.5234" y2="4149.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4149.5234" y2="4149.5234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="85" y="4163.584">Note that the Poll looping example is purely illustrative</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="328" x="85" y="4178.8184">as the Third-Party App would poll as soon as they received</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="18" x="85" y="4194.0527">the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="106" y="4194.1606">auth_req_id</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="197" x="197" y="4194.0527">from the AS. Writing the diagram to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="385" x="85" y="4209.2871">incorporate this sequentially would, however be extremely confusing</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="196" x="85" y="4224.5215">hence the sequence shown below.</text><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4229.6953" y2="4229.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4229.6953" y2="4229.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="85" y1="4229.6953" y2="4229.6953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="317" x="85" y="4243.7559">For Poll and Ping mode the Third-Party App must use the</text><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="87" x="85" y="4258.9902">CIBA grant type</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="229" x="175" y="4258.9902">as described in the source specification.</text><path d="M10,4287.1641 L69,4287.1641 L69,4294.1641 L59,4304.1641 L10,4304.1641 L10,4287.1641 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1412.5781" style="stroke:#000000;stroke-width:2.0;" width="1692.5" x="10" y="4287.1641"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="25" y="4300.2246">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="145" x="84" y="4299.3691">[Client Registered Poll Mode]</text><path d="M79,4309.3984 L79,4379.3984 L474,4379.3984 L474,4319.3984 L464,4309.3984 L79,4309.3984 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M464,4309.3984 L464,4319.3984 L474,4319.3984 L464,4309.3984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="342" x="85" y="4326.459">In Poll mode the TPP will periodically call the Token endpoint</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="85" y="4341.6934">until they get a positive response i.e. they do not receive</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="374" x="85" y="4356.9277">the 400 HTTP response code but instead are returned one-or-more</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="309" x="85" y="4372.1621">tokens (Access, Refresh, ID) from the Token endpoint.</text><path d="M20,4396.3359 L89,4396.3359 L89,4403.3359 L79,4413.3359 L20,4413.3359 L20,4396.3359 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="276.8047" style="stroke:#000000;stroke-width:2.0;" width="1672.5" x="20" y="4396.3359"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="35" y="4409.3965">loop</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="232" x="104" y="4408.541">[Exit when Authentication Request successful]</text><polygon fill="#A80036" points="326,4430.7031,336,4434.7031,326,4438.7031,330,4434.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="4434.7031" y2="4434.7031"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="4429.6372">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1614,4459.9375,1624,4463.9375,1614,4467.9375,1618,4463.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="4463.9375" y2="4463.9375"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="4458.7637">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,4489.1719,339,4493.1719,349,4497.1719,345,4493.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="4493.1719" y2="4493.1719"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="4487.998">Response</text><polygon fill="#A80036" points="701,4518.4063,711,4522.4063,701,4526.4063,705,4522.4063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="4522.4063" y2="4522.4063"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="4517.2324">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="4551.6406" y2="4551.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="4551.6406" y2="4564.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="4564.6406" y2="4564.6406"/><polygon fill="#A80036" points="724,4560.6406,714,4564.6406,724,4568.6406,720,4564.6406" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="720" y="4546.4668">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="4593.875" y2="4593.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="4593.875" y2="4606.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="4606.875" y2="4606.875"/><polygon fill="#A80036" points="724,4602.875,714,4606.875,724,4610.875,720,4606.875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="75" x="720" y="4588.7012">Check status</text><polygon fill="#A80036" points="349,4632.0078,339,4636.0078,349,4640.0078,345,4636.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="712" y1="4636.0078" y2="4636.0078"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="355" y="4630.9419">400 Bad Request {...}</text><polygon fill="#A80036" points="85,4661.1406,75,4665.1406,85,4669.1406,81,4665.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="4665.1406" y2="4665.1406"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="91" y="4660.0747">400 Bad Request {...}</text><polygon fill="#A80036" points="326,4697.2734,336,4701.2734,326,4705.2734,330,4701.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="4701.2734" y2="4701.2734"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="4696.2075">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1614,4726.5078,1624,4730.5078,1614,4734.5078,1618,4730.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="4730.5078" y2="4730.5078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="4725.334">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,4755.7422,339,4759.7422,349,4763.7422,345,4759.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="4759.7422" y2="4759.7422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="4754.5684">Response</text><polygon fill="#A80036" points="701,4784.9766,711,4788.9766,701,4792.9766,705,4788.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="4788.9766" y2="4788.9766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="4783.8027">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="4818.2109" y2="4818.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="4818.2109" y2="4831.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="4831.2109" y2="4831.2109"/><polygon fill="#A80036" points="724,4827.2109,714,4831.2109,724,4835.2109,720,4831.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="720" y="4813.0371">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="4860.4453" y2="4860.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="4860.4453" y2="4873.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="4873.4453" y2="4873.4453"/><polygon fill="#A80036" points="724,4869.4453,714,4873.4453,724,4877.4453,720,4873.4453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="75" x="720" y="4855.2715">Check status</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="4902.6797" y2="4902.6797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="4902.6797" y2="4915.6797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="4915.6797" y2="4915.6797"/><polygon fill="#A80036" points="724,4911.6797,714,4915.6797,724,4919.6797,720,4915.6797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="720" y="4897.5059">Create tokens</text><polygon fill="#A80036" points="349,4940.8125,339,4944.8125,349,4948.8125,345,4944.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="712" y1="4944.8125" y2="4944.8125"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="355" y="4939.7466">200 OK {...}</text><polygon fill="#A80036" points="85,4969.9453,75,4973.9453,85,4977.9453,81,4973.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="4973.9453" y2="4973.9453"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="91" y="4968.8794">200 OK {...}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1702.5" y1="4982.9453" y2="4982.9453"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="148" x="15" y="4993.1504">[Client Registered Ping Mode]</text><path d="M79,5001.8359 L79,5071.8359 L463,5071.8359 L463,5011.8359 L453,5001.8359 L79,5001.8359 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,5001.8359 L453,5011.8359 L463,5011.8359 L453,5001.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="322" x="85" y="5018.8965">Ping mode is a simple notification by the AS to a callback</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="303" x="85" y="5034.1309">URL pre-registered by the Third-Party App in Part 0. On</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="337" x="85" y="5049.3652">receipt the Third-Party App can then call the Token endpoint</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="5064.5996">in the same way as in Poll mode and collect one-or-more tokens.</text><polygon fill="#A80036" points="85,5099.0078,75,5103.0078,85,5107.0078,81,5103.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79" x2="712" y1="5103.0078" y2="5103.0078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="255" x="91" y="5097.834">Authentication Request complete notification</text><polygon fill="#A80036" points="701,5128.1406,711,5132.1406,701,5136.1406,705,5132.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="74" x2="707" y1="5132.1406" y2="5132.1406"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="81" y="5127.0747">204 No Content</text><polygon fill="#A80036" points="326,5157.2734,336,5161.2734,326,5165.2734,330,5161.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="5161.2734" y2="5161.2734"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="81" y="5156.2075">POST /token auth_req_id=...</text><polygon fill="#A80036" points="1614,5186.5078,1624,5190.5078,1614,5194.5078,1618,5190.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="5190.5078" y2="5190.5078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="5185.334">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,5215.7422,339,5219.7422,349,5223.7422,345,5219.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="5219.7422" y2="5219.7422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="5214.5684">Response</text><polygon fill="#A80036" points="701,5244.9766,711,5248.9766,701,5252.9766,705,5248.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="5248.9766" y2="5248.9766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="345" y="5243.8027">Forward token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="5278.2109" y2="5278.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="5278.2109" y2="5291.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="5291.2109" y2="5291.2109"/><polygon fill="#A80036" points="724,5287.2109,714,5291.2109,724,5295.2109,720,5291.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="720" y="5273.0371">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="5320.4453" y2="5320.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="5320.4453" y2="5333.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="5333.4453" y2="5333.4453"/><polygon fill="#A80036" points="724,5329.4453,714,5333.4453,724,5337.4453,720,5333.4453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="720" y="5315.2715">Create tokens</text><polygon fill="#A80036" points="349,5358.5781,339,5362.5781,349,5366.5781,345,5362.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="712" y1="5362.5781" y2="5362.5781"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="355" y="5357.5122">200 OK {...}</text><polygon fill="#A80036" points="85,5387.7109,75,5391.7109,85,5395.7109,81,5391.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="5391.7109" y2="5391.7109"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="91" y="5386.645">200 OK {...}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1702.5" y1="5400.7109" y2="5400.7109"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151" x="15" y="5410.916">[Client Registered Push Mode]</text><path d="M79,5419.6016 L79,5489.6016 L463,5489.6016 L463,5429.6016 L453,5419.6016 L79,5419.6016 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,5419.6016 L453,5429.6016 L463,5429.6016 L453,5419.6016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="363" x="85" y="5436.6621">In Push mode tokens are created by the AS and then transmitted</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="349" x="85" y="5451.8965">to the Third-Party App, therefore negating the need for them to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="356" x="85" y="5467.1309">visit the Token endpoint. Their are various implications of using</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="221" x="85" y="5482.3652">this method which are discussed in the</text><a href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" target="_top" title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:show="new" xlink:title="https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="74" x="309" y="5482.3652">specification</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="383" y="5482.3652">.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="5520.7734" y2="5520.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="5520.7734" y2="5533.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="5533.7734" y2="5533.7734"/><polygon fill="#A80036" points="724,5529.7734,714,5533.7734,724,5537.7734,720,5533.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="720" y="5515.5996">Retrieve Authentication request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="5563.0078" y2="5563.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="5563.0078" y2="5576.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="5576.0078" y2="5576.0078"/><polygon fill="#A80036" points="724,5572.0078,714,5576.0078,724,5580.0078,720,5576.0078" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="720" y="5557.834">Create tokens</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="5620.4766" y2="5620.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="5620.4766" y2="5633.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="5633.4766" y2="5633.4766"/><polygon fill="#A80036" points="724,5629.4766,714,5633.4766,724,5637.4766,720,5633.4766" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="195" x="720" y="5600.0684">Retrieve callback URL and security</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="141" x="720" y="5615.3027">token for Third-Party App</text><polygon fill="#A80036" points="85,5658.6094,75,5662.6094,85,5666.6094,81,5662.6094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79" x2="712" y1="5662.6094" y2="5662.6094"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="91" y="5657.5435">POST /cb {...}</text><polygon fill="#A80036" points="701,5687.7422,711,5691.7422,701,5695.7422,705,5691.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="74" x2="707" y1="5691.7422" y2="5691.7422"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="81" y="5686.6763">204 No Content</text><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1935.5" x="0" y="5727.3594"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="5727.3594" y2="5727.3594"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1935.5" y1="5730.3594" y2="5730.3594"/><rect fill="#EEEEEE" filter="url(#f1ugn405s546m4)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="293" x="821.25" y="5716.7422"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="276" x="827.25" y="5732.8027">Part 5: TPP Makes Payment Instruction Request</text><path d="M79,5754.9766 L79,5824.9766 L438,5824.9766 L438,5764.9766 L428,5754.9766 L79,5754.9766 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M428,5754.9766 L428,5764.9766 L438,5764.9766 L428,5754.9766 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="338" x="85" y="5772.0371">With the Access Token in hand the Third-Party App can now</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="327" x="85" y="5787.2715">make the payment instruction request. The Access Token</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="321" x="85" y="5802.5059">is bound to this single operation and will be revoked once</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="293" x="85" y="5817.7402">the payment instruction is successfully transmitted.</text><polygon fill="#A80036" points="326,5852.0469,336,5856.0469,326,5860.0469,330,5856.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="332" y1="5856.0469" y2="5856.0469"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="81" y="5850.981">POST /payments/v1/pix/payments</text><polygon fill="#A80036" points="1614,5881.2813,1624,5885.2813,1614,5889.2813,1618,5885.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="1620" y1="5885.2813" y2="5885.2813"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="177" x="345" y="5880.1074">Check Client Certificate Validity</text><polygon fill="#A80036" points="349,5910.5156,339,5914.5156,349,5918.5156,345,5914.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1625" y1="5914.5156" y2="5914.5156"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="5909.3418">Response</text><path d="M343,5927.5156 L343,5997.5156 L688,5997.5156 L688,5937.5156 L678,5927.5156 L343,5927.5156 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M678,5927.5156 L678,5937.5156 L688,5937.5156 L678,5927.5156 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="324" x="349" y="5944.5762">The approach to Access Token introspection remains the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="313" x="349" y="5959.8105">same under Payments i.e. the API Gateway will need an</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="349" y="5975.0449">assertion that indicates the consent granted by the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="278" x="349" y="5990.2793">Customer matches the payment being instructed.</text><polygon fill="#A80036" points="701,6024.6875,711,6028.6875,701,6032.6875,705,6028.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="707" y1="6028.6875" y2="6028.6875"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="143" x="345" y="6023.5137">Introspect Access Token</text><line style="stroke:#A80036;stroke-width:1.0;" x1="713" x2="755" y1="6057.9219" y2="6057.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755" x2="755" y1="6057.9219" y2="6070.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="714" x2="755" y1="6070.9219" y2="6070.9219"/><polygon fill="#A80036" points="724,6066.9219,714,6070.9219,724,6074.9219,720,6070.9219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="191" x="720" y="6052.748">Retrieve Access Token properties</text><polygon fill="#A80036" points="349,6096.1563,339,6100.1563,349,6104.1563,345,6100.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="712" y1="6100.1563" y2="6100.1563"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="355" y="6094.9824">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="380" y1="6129.3906" y2="6129.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="380" x2="380" y1="6129.3906" y2="6142.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="339" x2="380" y1="6142.3906" y2="6142.3906"/><polygon fill="#A80036" points="349,6138.3906,339,6142.3906,349,6146.3906,345,6142.3906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="125" x="345" y="6124.2168">Apply access controls</text><polygon fill="#A80036" points="590,6167.5234,600,6171.5234,590,6175.5234,594,6171.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338" x2="596" y1="6171.5234" y2="6171.5234"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="345" y="6166.4575">POST /payments/v1/pix/payments</text><path d="M607,6184.5234 L607,6239.5234 L1009,6239.5234 L1009,6194.5234 L999,6184.5234 L607,6184.5234 " fill="#FBFB77" filter="url(#f1ugn405s546m4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M999,6184.5234 L999,6194.5234 L1009,6194.5234 L999,6184.5234 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="377" x="613" y="6201.584">This flow is non-normative and will vary on customer requirements.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="8" x="613" y="6216.8184">It</text><text fill="#000000" font-family="Roboto" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="31" x="624" y="6216.8184">could</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="336" x="658" y="6216.8184">be to a PIX-compliant API or any other available mechanism</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="613" y="6232.0527">to make a PIX payment.</text><polygon fill="#A80036" points="1359,6266.4609,1369,6270.4609,1359,6274.4609,1363,6270.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="1365" y1="6270.4609" y2="6270.4609"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="609" y="6265.2871">Deliver payment instruction to Banking System API</text><polygon fill="#A80036" points="613,6295.6953,603,6299.6953,613,6303.6953,609,6299.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="607" x2="1370" y1="6299.6953" y2="6299.6953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="619" y="6294.5215">Response</text><polygon fill="#A80036" points="349,6339.9609,339,6343.9609,349,6347.9609,345,6343.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="601" y1="6343.9609" y2="6343.9609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="355" y="6323.7622">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="355" y="6338.895">{paymentId: "..."}</text><polygon fill="#A80036" points="85,6384.2266,75,6388.2266,85,6392.2266,81,6388.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="337" y1="6388.2266" y2="6388.2266"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="91" y="6368.0278">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="91" y="6383.1606">{paymentId: "..."}</text><!--MD5=[0a66a1ac55c5ed89369a19820b233a17]
@startuml CIBA_Example_Sequence

title \n\n\n
hide footbox

participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
participant "Consent\nManagement" as CONSENT
end box

box Core Banking Applications #d5a6bd
participant "Banking\nIdentity\nProvider" as ASPSP_IDP
participant "Banking\nSystems" as ASPSP_API
end box

participant "Open Banking\nDirectory\n- - -\nJSON Web Key Set" as OBD_JWKS
participant "Certificate\nAuthority\n- - -\nOCSP Endpoint" as OCSP
participant "Mobile\nBanking\nApp" as MOBILE
actor "Customer" as PSU

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

== Part 0: Registration of Token Delivery Preferences ==

note right of TPP
CIBA requires that Clients register a delivery mode prior to the
transmission of any Authentication Requests:
|||
[[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.4 Clients registering to use CIBA MUST indicate a token delivery mode]]
|||
The Authorization Server (AS) therefore must host a registration
endpoint - defined in the discoverable OpenID Configuration -
that allows the Client to do so. The parameters for this call
are described in the CIBA specification and differ depending
on the method in question. The modes are:
|||
* **Poll**: Client polls the Token endpoint.
* **Ping**: AS notifies, Client retrieves from Token endpoint.
* **Push**: AS sends tokens to Client.
|||
The supported modes vary by AS as they are implementor specific i.e.
implementors of the AS can choose to only support one-or-more given
modes. The supported modes must be made pushed in the AS OpenID
Configuration.
end note

TPP -> API_GATEWAY: ""POST /connect/register""

note right of API_GATEWAY
In this diagram the API Gateway acts as a proxy for both
Identity and Consent Management.
end note

API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response
API_GATEWAY -> IAM: Registration Request
IAM -> IAM: Verify Client
IAM -> IAM: Store Client Parameters
API_GATEWAY <- - IAM: Response
TPP <- - API_GATEWAY: Response

== Part 1: Create Consent and Send Authentication Request ==

note right of TPP
The Third-Party App requests an Access Token using
the Client Credentials grant type. Nominally authentication
is through Mutual Authentication over TLS but it could
equally be using ""private_key_jwt"".
end note

TPP -> API_GATEWAY: ""POST /token""
API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response
API_GATEWAY -> IAM: Access Token request
IAM -> IAM: Verify Client
API_GATEWAY <- IAM: Issue Access Token
TPP <- - API_GATEWAY: ""200 OK""\n""{"access_token": "..."}""

note right of TPP
With the Access Token in hand the Third-Party can then
create the consent resource. This needs to be completed
before the Authentication Request as the value of the
""consentId"" is required to set the value of the scope.
end note

TPP -> API_GATEWAY: ""POST /payments/v1/consents""
API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response
API_GATEWAY -> CONSENT: ""POST /payments/v1/consents""
CONSENT -> CONSENT: Validate consent request properties
API_GATEWAY <- - CONSENT: ""201 Created""\n""{consentId: "..."}""
TPP <- - API_GATEWAY: ""201 Created""\n""{consentId: "..."}""

note right of TPP
The Third-Party App can now create and send the Authentication
Request. This includes the dynamic scope that holds the value 
of the ""consentId"" returned by Identity Management.
end note

TPP -> TPP: Create Authentication Request
TPP -> API_GATEWAY: ""POST /bc-authorize""
API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response

note right of API_GATEWAY
As with the redirection-based FAPI profiles the Authentication
Request is a JSON Web Signature. It therefore needs to be
checked for validity. Note that in the context of CIBA Pushed
Authorization Request is not required as the Authentication Request
is always sent via a secured backchannel and never through the browser.
end note

API_GATEWAY -> OBD_JWKS: Get JSON Web Key Set
API_GATEWAY <- - OBD_JWKS: Response
API_GATEWAY -> API_GATEWAY: Match Authentication\nRequest parameter ""kid""
API_GATEWAY -> API_GATEWAY: Verify Authentication\nRequest parameter signature
API_GATEWAY -> IAM: Forward Authentication Request
IAM -> IAM: Validate Authentication Request

note right of IAM
Note this approach is non-normative and the actual
implementation required should be considered on a
case-by-case basis.
end note

IAM -> ASPSP_IDP: Send Authentication Request notification
API_GATEWAY <- - IAM: ""201 Created""\n""{auth_req_id: "..."}""
TPP <- - API_GATEWAY: ""201 Created""\n""{auth_req_id: "..."}""

== Part 2: Customer Authenticates at Mobile Banking App ==

note right of ASPSP_IDP
The flow shown is a hypothetical approach to allowing
the End User to authenticate and confirm consent. In this
scenario has installed their mobile banking app and can
receive and act-on a request to authenticate and confirm
consent.
end note

ASPSP_IDP -> ASPSP_IDP: Correlate Authentication\nRequest with Customer
ASPSP_IDP -> ASPSP_API: Trigger push notification to Customer

note right of ASPSP_API
The push notification needs to carry some context.
For example, the ""consentId"" - to require the
consent to be correlated correctly.
end note

MOBILE <- ASPSP_API: Send push notification to mobile banking app
MOBILE -> PSU: Notify Customer

MOBILE <- - PSU: Tap notification
MOBILE -> PSU: Request biometric\ngesture to authenticate
MOBILE <- - PSU: Present biometric\ngesture

note right of ASPSP_IDP
As with the majority of mobile banking apps authentication
in this example is outsourced to the mobile operating system.
Once the customer has authenticated the mobile banking app
simply sends a "user authenticated" notification to the IDP.
|||
This flow is non-normative, implementation-specific and 
would be created based on the implementors architecture
and technology. 
end note

MOBILE -> ASPSP_IDP: User authenticated notification
MOBILE <- - ASPSP_IDP: Acknowledgement
MOBILE -> ASPSP_API: Request Customer accounts
MOBILE <- - ASPSP_API: Response

== Part 3: Customer Confirms Consent and Selects Account ==

note left of MOBILE
As Consent needs to be retrieved from a hostile security zone
i.e. from a Customer's mobile device the request to Consent
Management should be routed via the API Gateway. This
flow is implementation-specific and would be created
based on the implementors architecture and technology.
|||
In this example the Customer is the sole account
holder and therefore no further authorizations are required.
end note

MOBILE -> API_GATEWAY: Retrieve consent
API_GATEWAY -> CONSENT: Retrieve consent
CONSENT -> CONSENT: Retrieve Consent
API_GATEWAY <- - CONSENT: Response
MOBILE <- - API_GATEWAY: Response
MOBILE -> MOBILE: Render consent\nconfirmation screen
MOBILE -> PSU: Request consent\nconfirmation
MOBILE <- - PSU: Confirm consent

alt Account included in consent

note right of MOBILE
Do nothing
end note

else Account selection required
MOBILE -> MOBILE: Render account\nselection screen
MOBILE -> PSU: Request account\nselection
MOBILE <- - PSU: Select payment\naccount
end alt

MOBILE -> API_GATEWAY: Update consent as authorized
API_GATEWAY -> CONSENT: Update consent
CONSENT -> CONSENT: Update Consent
API_GATEWAY <- - CONSENT: Response
MOBILE <- - API_GATEWAY: Response

note left of MOBILE
The final step is to call the Identity Management
component to indicate that the Customer has been
authenticated. Identity Management will then signal
to the Third-Party App using the chosen mode that
authentication is complete. Again this flow is
implementation-specific and would be created based
on the implementors architecture and technology.
end note

MOBILE -> API_GATEWAY: Authentication complete notification
API_GATEWAY -> IAM: Forward authentication complete notification

== Part 4: Client Granted Access Token ==

note right of TPP
Notes on Token behaviors
===
The Third-Party App is made aware of the success of the
based on their registered delivery mode. Each of these is
shown below.
|||
Note that the Poll looping example is purely illustrative
as the Third-Party App would poll as soon as they received
the ""auth_req_id"" from the AS. Writing the diagram to
incorporate this sequentially would, however be extremely confusing
hence the sequence shown below.
|||
For Poll and Ping mode the Third-Party App must use the
[[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.1 CIBA grant type]] as described in the source specification.
end note

alt Client Registered Poll Mode

note right of TPP
In Poll mode the TPP will periodically call the Token endpoint
until they get a positive response i.e. they do not receive
the 400 HTTP response code but instead are returned one-or-more
tokens (Access, Refresh, ID) from the Token endpoint.
end note

loop Exit when Authentication Request successful
TPP -> API_GATEWAY: ""POST /token auth_req_id=...""
API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Check status
API_GATEWAY <- - IAM: ""400 Bad Request {...}""
TPP <- - API_GATEWAY: ""400 Bad Request {...}""
end loop

TPP -> API_GATEWAY: ""POST /token auth_req_id=...""
API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Check status
IAM -> IAM: Create tokens
API_GATEWAY <- - IAM: ""200 OK {...}""
TPP <- - API_GATEWAY: ""200 OK {...}""

else Client Registered Ping Mode

note right of TPP
Ping mode is a simple notification by the AS to a callback
URL pre-registered by the Third-Party App in Part 0. On
receipt the Third-Party App can then call the Token endpoint
in the same way as in Poll mode and collect one-or-more tokens.
end note

TPP <- IAM: Authentication Request complete notification
TPP - -> IAM: ""204 No Content""

TPP -> API_GATEWAY: ""POST /token auth_req_id=...""
API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response
API_GATEWAY -> IAM: Forward token request
IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Create tokens
API_GATEWAY <- - IAM: ""200 OK {...}""
TPP <- - API_GATEWAY: ""200 OK {...}""

else Client Registered Push Mode

note right of TPP
In Push mode tokens are created by the AS and then transmitted
to the Third-Party App, therefore negating the need for them to
visit the Token endpoint. Their are various implications of using
this method which are discussed in the [[https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.10.3 specification]].
end note

IAM -> IAM: Retrieve Authentication request
IAM -> IAM: Create tokens
IAM -> IAM: Retrieve callback URL and security\ntoken for Third-Party App

TPP <- IAM: ""POST /cb {...}""
TPP - -> IAM: ""204 No Content""

end alt

== Part 5: TPP Makes Payment Instruction Request ==

note right of TPP
With the Access Token in hand the Third-Party App can now
make the payment instruction request. The Access Token
is bound to this single operation and will be revoked once
the payment instruction is successfully transmitted.
end note

TPP -> API_GATEWAY: ""POST /payments/v1/pix/payments""
API_GATEWAY -> OCSP: Check Client Certificate Validity
API_GATEWAY <- - OCSP: Response

note right of API_GATEWAY
The approach to Access Token introspection remains the
same under Payments i.e. the API Gateway will need an
assertion that indicates the consent granted by the
Customer matches the payment being instructed.
end note

API_GATEWAY -> IAM: Introspect Access Token
IAM -> IAM: Retrieve Access Token properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Apply access controls
API_GATEWAY -> API_BUILDER: ""POST /payments/v1/pix/payments""

note right of API_BUILDER
This flow is non-normative and will vary on customer requirements.
It //could// be to a PIX-compliant API or any other available mechanism
to make a PIX payment.
end note

API_BUILDER -> ASPSP_API: Deliver payment instruction to Banking System API
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: ""201 Created""\n""{paymentId: "..."}""
TPP <- - API_GATEWAY: ""201 Created""\n""{paymentId: "..."}""


@enduml

PlantUML version 1.2021.7(Sun May 23 13:40:07 BST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>