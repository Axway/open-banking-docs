<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="960px" preserveAspectRatio="none" style="width:1324px;height:960px;background:#FFFFFF;" version="1.1" viewBox="0 0 1324 960" width="1324px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="58.8906" id="_title" style="stroke:none;stroke-width:1.0;" width="15" x="656.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="661.5" y="27.9951"> </text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="661.5" y="44.292"> </text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="661.5" y="60.5889"> </text><rect fill="#6FA8DC" height="871.875" style="stroke:#181818;stroke-width:0.5;" width="287" x="202" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101" x="292.5" y="87.9575">Infrastructure</text><rect fill="#FC877E" height="871.875" style="stroke:#181818;stroke-width:0.5;" width="152" x="602" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141" x="605" y="87.9575">Open Banking APIs</text><rect fill="#94C47D" height="871.875" style="stroke:#181818;stroke-width:0.5;" width="214" x="776" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="203" x="779" y="87.9575">Identity and Access Control</text><rect fill="#D5A6BD" height="871.875" style="stroke:#181818;stroke-width:0.5;" width="206" x="1112" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195" x="1115" y="87.9575">Core Banking Applications</text><rect fill="none" height="377.125" style="stroke:#000000;stroke-width:1.5;" width="607" x="402" y="384.8438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="44" x2="44" y1="158.9141" y2="953.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="246" x2="246" y1="158.9141" y2="953.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="448" x2="448" y1="158.9141" y2="953.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="677.5" x2="677.5" y1="158.9141" y2="953.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="882.5" x2="882.5" y1="158.9141" y2="953.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1054" x2="1054" y1="158.9141" y2="953.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1214.5" x2="1214.5" y1="158.9141" y2="953.7656"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="5" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="28.5" y="131.3154">Data</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="12" y="147.6123">Recipient</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="206" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="221" y="131.3154">Ingress</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="213" y="147.6123">Controller</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="412" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="438" y="131.3154">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="419" y="147.6123">Gateway</text><rect fill="#E2E2F0" height="62.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89" x="633.5" y="95.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="647.5" y="115.0186">Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="641" y="131.3154">Integration</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="640.5" y="147.6123">Application</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="830.5" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="858" y="131.3154">Identity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="837.5" y="147.6123">Management</text><rect fill="#E2E2F0" height="62.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="1013" y="95.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="1031" y="115.0186">Market</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="1020" y="131.3154">Certificate</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="1024" y="147.6123">Authority</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1178.5" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1187" y="131.3154">Banking</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1185.5" y="147.6123">Systems</text><path d="M49,173.9141 L49,213.9141 L439,213.9141 L439,183.9141 L429,173.9141 L49,173.9141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M429,173.9141 L429,183.9141 L439,183.9141 L429,173.9141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369" x="55" y="190.981">This diagram shows the specifics of mutual authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314" x="55" y="206.1138">as implemented in the open banking accelerator.</text><polygon fill="#181818" points="234.5,236.3125,244.5,240.3125,234.5,244.3125,238.5,240.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="44.5" x2="240.5" y1="240.3125" y2="240.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="51.5" y="235.2466">Request protected endpoint</text><line style="stroke:#181818;stroke-width:1.0;" x1="246.5" x2="288.5" y1="269.4453" y2="269.4453"/><line style="stroke:#181818;stroke-width:1.0;" x1="288.5" x2="288.5" y1="269.4453" y2="282.4453"/><line style="stroke:#181818;stroke-width:1.0;" x1="247.5" x2="288.5" y1="282.4453" y2="282.4453"/><polygon fill="#181818" points="257.5,278.4453,247.5,282.4453,257.5,286.4453,253.5,282.4453" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="253.5" y="264.3794">Validate certificate chain</text><polygon fill="#181818" points="436.5,307.5781,446.5,311.5781,436.5,315.5781,440.5,311.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="246.5" x2="442.5" y1="311.5781" y2="311.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="253.5" y="306.5122">Request protected endpoint</text><polygon fill="#181818" points="1042.5,336.7109,1052.5,340.7109,1042.5,344.7109,1046.5,340.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="448.5" x2="1048.5" y1="340.7109" y2="340.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="455.5" y="335.645">Check certificate status (OCSP/CRL)</text><polygon fill="#181818" points="459.5,365.8438,449.5,369.8438,459.5,373.8438,455.5,369.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="453.5" x2="1053.5" y1="369.8438" y2="369.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="465.5" y="364.7778">Response</text><path d="M402,384.8438 L466,384.8438 L466,391.9766 L456,401.9766 L402,401.9766 L402,384.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="377.125" style="stroke:#000000;stroke-width:1.5;" width="607" x="402" y="384.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="417" y="397.9106">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="206" x="481" y="397.0542">[Certificate binding is enforced]</text><path d="M453,406.9766 L453,510.9766 L742,510.9766 L742,416.9766 L732,406.9766 L453,406.9766 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M732,406.9766 L732,416.9766 L742,416.9766 L732,406.9766 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="459" y="424.0435">Binding the Access Token to a given client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="459" y="439.1763">certificate is enforced through FAPI which</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="459" y="454.3091">references</text><a href="https://datatracker.ietf.org/doc/html/rfc8705" target="_top" title="https://datatracker.ietf.org/doc/html/rfc8705" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc8705" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc8705" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="60" x="531" y="454.3091">RFC 8705</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="591" y="454.3091">.</text><line style="stroke:#000000;stroke-width:0.5;" x1="459" x2="459" y1="459.375" y2="459.375"/><line style="stroke:#000000;stroke-width:0.5;" x1="459" x2="459" y1="459.375" y2="459.375"/><line style="stroke:#000000;stroke-width:0.5;" x1="459" x2="459" y1="459.375" y2="459.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="459" y="473.4419">To support this the API Gateway uses the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="459" y="488.5747">Access Token introspection endpoint to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="459" y="503.7075">retrieve the stored certificate fingerprint.</text><polygon fill="#181818" points="871,549.0391,881,553.0391,871,557.0391,875,553.0391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="448.5" x2="877" y1="553.0391" y2="553.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="455.5" y="532.8403">Access Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="455.5" y="547.9731">introspection</text><line style="stroke:#181818;stroke-width:1.0;" x1="883" x2="925" y1="597.3047" y2="597.3047"/><line style="stroke:#181818;stroke-width:1.0;" x1="925" x2="925" y1="597.3047" y2="610.3047"/><line style="stroke:#181818;stroke-width:1.0;" x1="884" x2="925" y1="610.3047" y2="610.3047"/><polygon fill="#181818" points="894,606.3047,884,610.3047,894,614.3047,890,610.3047" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="890" y="577.106">Retrieve Access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="890" y="592.2388">Token properties</text><polygon fill="#181818" points="459.5,635.4375,449.5,639.4375,459.5,643.4375,455.5,639.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="453.5" x2="882" y1="639.4375" y2="639.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="465.5" y="634.3716">Response</text><line style="stroke:#181818;stroke-width:1.0;" x1="448.5" x2="490.5" y1="683.7031" y2="683.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="490.5" x2="490.5" y1="683.7031" y2="696.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="449.5" x2="490.5" y1="696.7031" y2="696.7031"/><polygon fill="#181818" points="459.5,692.7031,449.5,696.7031,459.5,700.7031,455.5,696.7031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="455.5" y="663.5044">Calculate certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="455.5" y="678.6372">fingerprint</text><line style="stroke:#181818;stroke-width:1.0;" x1="448.5" x2="490.5" y1="740.9688" y2="740.9688"/><line style="stroke:#181818;stroke-width:1.0;" x1="490.5" x2="490.5" y1="740.9688" y2="753.9688"/><line style="stroke:#181818;stroke-width:1.0;" x1="449.5" x2="490.5" y1="753.9688" y2="753.9688"/><polygon fill="#181818" points="459.5,749.9688,449.5,753.9688,459.5,757.9688,455.5,753.9688" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="455.5" y="720.77">Compare stored and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="455.5" y="735.9028">calculated fingerprints</text><polygon fill="#181818" points="666,786.1016,676,790.1016,666,794.1016,670,790.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="448.5" x2="672" y1="790.1016" y2="790.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="455.5" y="785.0356">Request protected endpoint</text><polygon fill="#181818" points="1203,815.2344,1213,819.2344,1203,823.2344,1207,819.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="678" x2="1209" y1="819.2344" y2="819.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="685" y="814.1685">Request backend data or service</text><polygon fill="#181818" points="689,844.3672,679,848.3672,689,852.3672,685,848.3672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="683" x2="1214" y1="848.3672" y2="848.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="695" y="843.3013">Response</text><polygon fill="#181818" points="459.5,873.5,449.5,877.5,459.5,881.5,455.5,877.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="453.5" x2="677" y1="877.5" y2="877.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="465.5" y="872.4341">Response</text><polygon fill="#181818" points="257.5,902.6328,247.5,906.6328,257.5,910.6328,253.5,906.6328" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="251.5" x2="447.5" y1="906.6328" y2="906.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="263.5" y="901.5669">Response</text><polygon fill="#181818" points="55.5,931.7656,45.5,935.7656,55.5,939.7656,51.5,935.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="49.5" x2="245.5" y1="935.7656" y2="935.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="61.5" y="930.6997">Response</text><!--MD5=[8193b9d055c66986a3cab2f80608bcc3]
@startuml Mutual_Authentication_Sequence

title \n\n

participant "Data\nRecipient" as DR

box Infrastructure #6FA8DC
participant "Ingress\nController" as INGRESS
participant "API\nGateway" as API_GATEWAY
end box

box Open Banking APIs #fc877e 
'participant "API\nGateway" as API_GATEWAY
participant "Backend\nIntegration\nApplication" as BIA
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

participant "Market\nCertificate\nAuthority" as CA
' participant "JSON Web\nKey Set" as OBD_JWKS

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox
'skinparam defaultFontName Roboto
skinparam BoxPadding 10

note right of DR
This diagram shows the specifics of mutual authentication
as implemented in the open banking accelerator.
end note

DR -> INGRESS: Request protected endpoint
INGRESS -> INGRESS: Validate certificate chain
INGRESS -> API_GATEWAY: Request protected endpoint
API_GATEWAY -> CA: Check certificate status (OCSP/CRL)
API_GATEWAY <- - CA: Response

alt Certificate binding is enforced

note right of API_GATEWAY
Binding the Access Token to a given client
certificate is enforced through FAPI which
references [[https://datatracker.ietf.org/doc/html/rfc8705 RFC 8705]].
|||
To support this the API Gateway uses the
Access Token introspection endpoint to
retrieve the stored certificate fingerprint.
end note

API_GATEWAY -> IAM: Access Token\nintrospection
IAM -> IAM: Retrieve Access\nToken properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Calculate certificate\nfingerprint
API_GATEWAY -> API_GATEWAY: Compare stored and\ncalculated fingerprints
end alt

API_GATEWAY -> BIA: Request protected endpoint
BIA -> ASPSP_API: Request backend data or service
BIA <- - ASPSP_API: Response
API_GATEWAY <- - BIA: Response
INGRESS <- - API_GATEWAY: Response
DR <- - INGRESS: Response

@enduml

@startuml Mutual_Authentication_Sequence

title \n\n

participant "Data\nRecipient" as DR

box Infrastructure #6FA8DC
participant "Ingress\nController" as INGRESS
participant "API\nGateway" as API_GATEWAY
end box

box Open Banking APIs #fc877e 
participant "Backend\nIntegration\nApplication" as BIA
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

participant "Market\nCertificate\nAuthority" as CA

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox
skinparam BoxPadding 10

note right of DR
This diagram shows the specifics of mutual authentication
as implemented in the open banking accelerator.
end note

DR -> INGRESS: Request protected endpoint
INGRESS -> INGRESS: Validate certificate chain
INGRESS -> API_GATEWAY: Request protected endpoint
API_GATEWAY -> CA: Check certificate status (OCSP/CRL)
API_GATEWAY <- - CA: Response

alt Certificate binding is enforced

note right of API_GATEWAY
Binding the Access Token to a given client
certificate is enforced through FAPI which
references [[https://datatracker.ietf.org/doc/html/rfc8705 RFC 8705]].
|||
To support this the API Gateway uses the
Access Token introspection endpoint to
retrieve the stored certificate fingerprint.
end note

API_GATEWAY -> IAM: Access Token\nintrospection
IAM -> IAM: Retrieve Access\nToken properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Calculate certificate\nfingerprint
API_GATEWAY -> API_GATEWAY: Compare stored and\ncalculated fingerprints
end alt

API_GATEWAY -> BIA: Request protected endpoint
BIA -> ASPSP_API: Request backend data or service
BIA <- - ASPSP_API: Response
API_GATEWAY <- - BIA: Response
INGRESS <- - API_GATEWAY: Response
DR <- - INGRESS: Response

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>