<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1238px" preserveAspectRatio="none" style="width:1152px;height:1238px;" version="1.1" viewBox="0 0 1152 1238" width="1152px" zoomAndPan="magnify"><defs><filter height="300%" id="ftwsrm7x01w5k" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#E06666" height="1219.1875" style="stroke:#A80036;stroke-width:1.0;" width="269" x="188" y="6"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="266" y="18.0605">Open Banking APIs</text><rect fill="#94C47D" height="1219.1875" style="stroke:#A80036;stroke-width:1.0;" width="168" x="479" y="6"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="482" y="18.0605">Identity and Access Control</text><rect fill="#D5A6BD" height="1219.1875" style="stroke:#A80036;stroke-width:1.0;" width="160" x="986" y="6"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="989" y="18.0605">Core Banking Applications</text><rect fill="#FFFFFF" filter="url(#ftwsrm7x01w5k)" height="434.875" style="stroke:#000000;stroke-width:2.0;" width="798" x="182" y="236.3906"/><rect fill="#FFFFFF" height="143.0625" style="stroke:none;stroke-width:1.0;" width="798" x="182" y="528.2031"/><rect fill="#FFFFFF" filter="url(#ftwsrm7x01w5k)" height="382.75" style="stroke:#000000;stroke-width:2.0;" width="496" x="182" y="685.2656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="49" x2="49" y1="93.4531" y2="1231.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="229" x2="229" y1="93.4531" y2="1231.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="409" x2="409" y1="93.4531" y2="1231.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="562.5" x2="562.5" y1="93.4531" y2="1231.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="704" x2="704" y1="93.4531" y2="1231.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="797" x2="797" y1="93.4531" y2="1231.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="917" x2="917" y1="93.4531" y2="1231.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1065.5" x2="1065.5" y1="93.4531" y2="1231.1875"/><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="84" x="5" y="41.6406"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="12" y="61.6289">Third-Party</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="34.5" y="78.0352">App</text><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="70" x="192" y="41.6406"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="216" y="61.6289">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="199" y="78.0352">Gateway</text><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="84" x="365" y="25.2344"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="396" y="45.2227">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="43" x="385.5" y="61.6289">Builder</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="372" y="78.0352">Application</text><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="512.5" y="41.6406"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="537.5" y="61.6289">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="519.5" y="78.0352">Management</text><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="78" x="663" y="25.2344"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="44" x="680" y="45.2227">Market</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="64" x="670" y="61.6289">Certificate</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="58" x="673" y="78.0352">Authority</text><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="30.4063" style="stroke:#A80036;stroke-width:1.5;" width="81" x="755" y="58.0469"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="67" x="762" y="78.0352">Konsentus</text><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="101" x="865" y="25.2344"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="60" x="885.5" y="45.2227">European</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="87" x="872" y="61.6289">Open Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="890" y="78.0352">Markets</text><rect fill="#FEFECE" filter="url(#ftwsrm7x01w5k)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1030.5" y="41.6406"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1038.5" y="61.6289">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="53" x="1037.5" y="78.0352">Systems</text><path d="M54,108.4531 L54,148.4531 L408,148.4531 L408,118.4531 L398,108.4531 L54,108.4531 " fill="#FBFB77" filter="url(#ftwsrm7x01w5k)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M398,108.4531 L398,118.4531 L408,118.4531 L398,108.4531 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="333" x="60" y="125.5137">This diagram shows the specifics of mutual authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="274" x="60" y="140.748">as implemented in the open banking accelerator.</text><polygon fill="#A80036" points="217,175.1563,227,179.1563,217,183.1563,221,179.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="223" y1="179.1563" y2="179.1563"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="156" x="56" y="173.9824">Request protected endpoint</text><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="271" y1="208.3906" y2="208.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="271" x2="271" y1="208.3906" y2="221.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230" x2="271" y1="221.3906" y2="221.3906"/><polygon fill="#A80036" points="240,217.3906,230,221.3906,240,225.3906,236,221.3906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="141" x="236" y="203.2168">Validate certificate chain</text><path d="M182,236.3906 L241,236.3906 L241,243.3906 L231,253.3906 L182,253.3906 L182,236.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="434.875" style="stroke:#000000;stroke-width:2.0;" width="798" x="182" y="236.3906"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="197" y="249.4512">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="256" y="248.5957">[European Market]</text><path d="M234,258.625 L234,328.625 L463,328.625 L463,268.625 L453,258.625 L234,258.625 " fill="#FBFB77" filter="url(#ftwsrm7x01w5k)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,258.625 L453,268.625 L463,268.625 L453,258.625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="206" x="240" y="275.6855">In PSD2 markets the solution can be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="208" x="240" y="290.9199">supported by Konsentus who provide</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="200" x="240" y="306.1543">a pan-EU solution for checking both</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="154" x="240" y="321.3887">certificate and TPP validity.</text><polygon fill="#A80036" points="785.5,355.7969,795.5,359.7969,785.5,363.7969,789.5,359.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="791.5" y1="359.7969" y2="359.7969"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="184" x="236" y="354.623">Request certification verification</text><line style="stroke:#A80036;stroke-width:1.0;" x1="797.5" x2="839.5" y1="404.2656" y2="404.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="839.5" x2="839.5" y1="404.2656" y2="417.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="839.5" y1="417.2656" y2="417.2656"/><polygon fill="#A80036" points="808.5,413.2656,798.5,417.2656,808.5,421.2656,804.5,417.2656" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="804.5" y="383.8574">Resolve certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="66" x="804.5" y="399.0918">provenance</text><polygon fill="#A80036" points="905.5,457.7344,915.5,461.7344,905.5,465.7344,909.5,461.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="797.5" x2="911.5" y1="461.7344" y2="461.7344"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="94" x="804.5" y="441.3262">Verify certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="53" x="804.5" y="456.5605">in market</text><polygon fill="#A80036" points="808.5,486.9688,798.5,490.9688,808.5,494.9688,804.5,490.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="802.5" x2="916.5" y1="490.9688" y2="490.9688"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="814.5" y="485.7949">Response</text><polygon fill="#A80036" points="240,516.2031,230,520.2031,240,524.2031,236,520.2031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="796.5" y1="520.2031" y2="520.2031"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="515.0293">Response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="182" x2="980" y1="529.2031" y2="529.2031"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115" x="187" y="539.4082">[Non-European Market]</text><path d="M234,548.0938 L234,603.0938 L501,603.0938 L501,558.0938 L491,548.0938 L234,548.0938 " fill="#FBFB77" filter="url(#ftwsrm7x01w5k)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M491,548.0938 L491,558.0938 L501,558.0938 L491,548.0938 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="246" x="240" y="565.1543">Non-PSD2 markets tend to implement more</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="231" x="240" y="580.3887">traditional PKIs where validity is checked</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="155" x="240" y="595.623">using either OCSP or a CRL.</text><polygon fill="#A80036" points="692,630.0313,702,634.0313,692,638.0313,696,634.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="698" y1="634.0313" y2="634.0313"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="209" x="236" y="628.8574">Check certificate status (OCSP/CRL)</text><polygon fill="#A80036" points="240,659.2656,230,663.2656,240,667.2656,236,663.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="703" y1="663.2656" y2="663.2656"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="658.0918">Response</text><path d="M182,685.2656 L241,685.2656 L241,692.2656 L231,702.2656 L182,702.2656 L182,685.2656 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="382.75" style="stroke:#000000;stroke-width:2.0;" width="496" x="182" y="685.2656"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="197" y="698.3262">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157" x="256" y="697.4707">[Certificate binding is enforced]</text><path d="M234,707.5 L234,812.5 L494,812.5 L494,717.5 L484,707.5 L234,707.5 " fill="#FBFB77" filter="url(#ftwsrm7x01w5k)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M484,707.5 L484,717.5 L494,717.5 L484,707.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="239" x="240" y="724.5605">Binding the Access Token to a given client</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="238" x="240" y="739.7949">certificate is enforced through FAPI which</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="62" x="240" y="755.0293">references</text><a href="https://datatracker.ietf.org/doc/html/rfc8705" target="_top" title="https://datatracker.ietf.org/doc/html/rfc8705" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc8705" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc8705" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="54" x="305" y="755.0293">RFC 8705</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="359" y="755.0293">.</text><line style="stroke:#000000;stroke-width:1.0;" x1="240" x2="240" y1="760.2031" y2="760.2031"/><line style="stroke:#000000;stroke-width:1.0;" x1="240" x2="240" y1="760.2031" y2="760.2031"/><line style="stroke:#000000;stroke-width:1.0;" x1="240" x2="240" y1="760.2031" y2="760.2031"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="234" x="240" y="774.2637">To support this the API Gateway uses the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="225" x="240" y="789.498">Access Token introspection endpoint to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="227" x="240" y="804.7324">retrieve the stored certificate fingerprint.</text><polygon fill="#A80036" points="551,854.375,561,858.375,551,862.375,555,858.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="557" y1="858.375" y2="858.375"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="82" x="236" y="837.9668">Access Token</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="74" x="236" y="853.2012">introspection</text><line style="stroke:#A80036;stroke-width:1.0;" x1="563" x2="605" y1="902.8438" y2="902.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="605" x2="605" y1="902.8438" y2="915.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="564" x2="605" y1="915.8438" y2="915.8438"/><polygon fill="#A80036" points="574,911.8438,564,915.8438,574,919.8438,570,915.8438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="92" x="570" y="882.4355">Retrieve Access</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="570" y="897.6699">Token properties</text><polygon fill="#A80036" points="240,941.0781,230,945.0781,240,949.0781,236,945.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="562" y1="945.0781" y2="945.0781"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="939.9043">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="271" y1="989.5469" y2="989.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="271" x2="271" y1="989.5469" y2="1002.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230" x2="271" y1="1002.5469" y2="1002.5469"/><polygon fill="#A80036" points="240,998.5469,230,1002.5469,240,1006.5469,236,1002.5469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="236" y="969.1387">Calculate certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="58" x="236" y="984.373">fingerprint</text><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="271" y1="1047.0156" y2="1047.0156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="271" x2="271" y1="1047.0156" y2="1060.0156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230" x2="271" y1="1060.0156" y2="1060.0156"/><polygon fill="#A80036" points="240,1056.0156,230,1060.0156,240,1064.0156,236,1060.0156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="236" y="1026.6074">Compare stored and</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="236" y="1041.8418">calculated fingerprints</text><polygon fill="#A80036" points="397,1092.25,407,1096.25,397,1100.25,401,1096.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="403" y1="1096.25" y2="1096.25"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="156" x="236" y="1091.0762">Request protected endpoint</text><polygon fill="#A80036" points="1054,1121.4844,1064,1125.4844,1054,1129.4844,1058,1125.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="409" x2="1060" y1="1125.4844" y2="1125.4844"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="185" x="416" y="1120.3105">Request backend data or service</text><polygon fill="#A80036" points="420,1150.7188,410,1154.7188,420,1158.7188,416,1154.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="414" x2="1065" y1="1154.7188" y2="1154.7188"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="426" y="1149.5449">Response</text><polygon fill="#A80036" points="240,1179.9531,230,1183.9531,240,1187.9531,236,1183.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="408" y1="1183.9531" y2="1183.9531"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="1178.7793">Response</text><polygon fill="#A80036" points="60,1209.1875,50,1213.1875,60,1217.1875,56,1213.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="228" y1="1213.1875" y2="1213.1875"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="66" y="1208.0137">Response</text><!--MD5=[67378675f00de02a59360bfe7d0e5114]
@startuml Overview of Mutual Authentication and Verification of TPP Certificate

participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder\nApplication" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

participant "Market\nCertificate\nAuthority" as CA
participant "Konsentus" as KON
participant "European\nOpen Banking\nMarkets" as EURO
' participant "JSON Web\nKey Set" as OBD_JWKS

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

note right of TPP
This diagram shows the specifics of mutual authentication
as implemented in the open banking accelerator.
end note

TPP -> API_GATEWAY: Request protected endpoint
API_GATEWAY -> API_GATEWAY: Validate certificate chain

alt European Market

note right of API_GATEWAY
In PSD2 markets the solution can be
supported by Konsentus who provide
a pan-EU solution for checking both
certificate and TPP validity.
end note

API_GATEWAY -> KON: Request certification verification
KON -> KON: Resolve certificate\nprovenance
KON -> EURO: Verify certificate\nin market
KON <- - EURO: Response
API_GATEWAY <- - KON: Response

else Non-European Market

note right of API_GATEWAY
Non-PSD2 markets tend to implement more
traditional PKIs where validity is checked
using either OCSP or a CRL.
end note

API_GATEWAY -> CA: Check certificate status (OCSP/CRL)
API_GATEWAY <- - CA: Response
end opt

alt Certificate binding is enforced

note right of API_GATEWAY
Binding the Access Token to a given client
certificate is enforced through FAPI which
references [[https://datatracker.ietf.org/doc/html/rfc8705 RFC 8705]].
|||
To support this the API Gateway uses the
Access Token introspection endpoint to
retrieve the stored certificate fingerprint.
end note

API_GATEWAY -> IAM: Access Token\nintrospection
IAM -> IAM: Retrieve Access\nToken properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Calculate certificate\nfingerprint
API_GATEWAY -> API_GATEWAY: Compare stored and\ncalculated fingerprints
end alt

API_GATEWAY -> API_BUILDER: Request protected endpoint
API_BUILDER -> ASPSP_API: Request backend data or service
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: Response
TPP <- - API_GATEWAY: Response

@enduml

@startuml Overview of Mutual Authentication and Verification of TPP Certificate

participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder\nApplication" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

participant "Market\nCertificate\nAuthority" as CA
participant "Konsentus" as KON
participant "European\nOpen Banking\nMarkets" as EURO

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

note right of TPP
This diagram shows the specifics of mutual authentication
as implemented in the open banking accelerator.
end note

TPP -> API_GATEWAY: Request protected endpoint
API_GATEWAY -> API_GATEWAY: Validate certificate chain

alt European Market

note right of API_GATEWAY
In PSD2 markets the solution can be
supported by Konsentus who provide
a pan-EU solution for checking both
certificate and TPP validity.
end note

API_GATEWAY -> KON: Request certification verification
KON -> KON: Resolve certificate\nprovenance
KON -> EURO: Verify certificate\nin market
KON <- - EURO: Response
API_GATEWAY <- - KON: Response

else Non-European Market

note right of API_GATEWAY
Non-PSD2 markets tend to implement more
traditional PKIs where validity is checked
using either OCSP or a CRL.
end note

API_GATEWAY -> CA: Check certificate status (OCSP/CRL)
API_GATEWAY <- - CA: Response
end opt

alt Certificate binding is enforced

note right of API_GATEWAY
Binding the Access Token to a given client
certificate is enforced through FAPI which
references [[https://datatracker.ietf.org/doc/html/rfc8705 RFC 8705]].
|||
To support this the API Gateway uses the
Access Token introspection endpoint to
retrieve the stored certificate fingerprint.
end note

API_GATEWAY -> IAM: Access Token\nintrospection
IAM -> IAM: Retrieve Access\nToken properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Calculate certificate\nfingerprint
API_GATEWAY -> API_GATEWAY: Compare stored and\ncalculated fingerprints
end alt

API_GATEWAY -> API_BUILDER: Request protected endpoint
API_BUILDER -> ASPSP_API: Request backend data or service
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: Response
TPP <- - API_GATEWAY: Response

@enduml

PlantUML version 1.2021.00(Sun Jan 10 10:25:05 GMT 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>