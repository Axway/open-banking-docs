<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1315px" preserveAspectRatio="none" style="width:1152px;height:1315px;background:#FFFFFF;" version="1.1" viewBox="0 0 1152 1315" width="1152px" zoomAndPan="magnify"><defs><filter height="300%" id="f1d9rm3panr4hd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="580.5" y="28.6992"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="580.5" y="49.793"/><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="580.5" y="70.8867"/><rect fill="#E06666" height="1219.1875" style="stroke:#A80036;stroke-width:1.0;" width="269" x="188" y="83.2813"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="266" y="95.3418">Open Banking APIs</text><rect fill="#94C47D" height="1219.1875" style="stroke:#A80036;stroke-width:1.0;" width="168" x="479" y="83.2813"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="482" y="95.3418">Identity and Access Control</text><rect fill="#D5A6BD" height="1219.1875" style="stroke:#A80036;stroke-width:1.0;" width="160" x="986" y="83.2813"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="989" y="95.3418">Core Banking Applications</text><rect fill="#FFFFFF" filter="url(#f1d9rm3panr4hd)" height="434.875" style="stroke:#000000;stroke-width:2.0;" width="798" x="182" y="313.6719"/><rect fill="#FFFFFF" height="143.0625" style="stroke:none;stroke-width:1.0;" width="798" x="182" y="605.4844"/><rect fill="#FFFFFF" filter="url(#f1d9rm3panr4hd)" height="382.75" style="stroke:#000000;stroke-width:2.0;" width="496" x="182" y="762.5469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="49" x2="49" y1="170.7344" y2="1308.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="229" x2="229" y1="170.7344" y2="1308.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="409" x2="409" y1="170.7344" y2="1308.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="562.5" x2="562.5" y1="170.7344" y2="1308.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="704" x2="704" y1="170.7344" y2="1308.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="797" x2="797" y1="170.7344" y2="1308.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="917" x2="917" y1="170.7344" y2="1308.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1065.5" x2="1065.5" y1="170.7344" y2="1308.4688"/><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="84" x="5" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="12" y="138.9102">Third-Party</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="34.5" y="155.3164">App</text><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="70" x="192" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="216" y="138.9102">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="199" y="155.3164">Gateway</text><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="84" x="365" y="102.5156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="396" y="122.5039">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="43" x="385.5" y="138.9102">Builder</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="372" y="155.3164">Application</text><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="512.5" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="537.5" y="138.9102">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="519.5" y="155.3164">Management</text><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="78" x="663" y="102.5156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="44" x="680" y="122.5039">Market</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="64" x="670" y="138.9102">Certificate</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="58" x="673" y="155.3164">Authority</text><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="30.4063" style="stroke:#A80036;stroke-width:1.5;" width="81" x="755" y="135.3281"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="67" x="762" y="155.3164">Konsentus</text><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="101" x="865" y="102.5156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="60" x="885.5" y="122.5039">European</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="87" x="872" y="138.9102">Open Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="890" y="155.3164">Markets</text><rect fill="#FEFECE" filter="url(#f1d9rm3panr4hd)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1030.5" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1038.5" y="138.9102">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="53" x="1037.5" y="155.3164">Systems</text><path d="M54,185.7344 L54,225.7344 L408,225.7344 L408,195.7344 L398,185.7344 L54,185.7344 " fill="#FBFB77" filter="url(#f1d9rm3panr4hd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M398,185.7344 L398,195.7344 L408,195.7344 L398,185.7344 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="333" x="60" y="202.7949">This diagram shows the specifics of mutual authentication</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="274" x="60" y="218.0293">as implemented in the open banking accelerator.</text><polygon fill="#A80036" points="217,252.4375,227,256.4375,217,260.4375,221,256.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="223" y1="256.4375" y2="256.4375"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="156" x="56" y="251.2637">Request protected endpoint</text><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="271" y1="285.6719" y2="285.6719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="271" x2="271" y1="285.6719" y2="298.6719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230" x2="271" y1="298.6719" y2="298.6719"/><polygon fill="#A80036" points="240,294.6719,230,298.6719,240,302.6719,236,298.6719" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="141" x="236" y="280.498">Validate certificate chain</text><path d="M182,313.6719 L241,313.6719 L241,320.6719 L231,330.6719 L182,330.6719 L182,313.6719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="434.875" style="stroke:#000000;stroke-width:2.0;" width="798" x="182" y="313.6719"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="197" y="326.7324">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="256" y="325.877">[European Market]</text><path d="M234,335.9063 L234,405.9063 L463,405.9063 L463,345.9063 L453,335.9063 L234,335.9063 " fill="#FBFB77" filter="url(#f1d9rm3panr4hd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453,335.9063 L453,345.9063 L463,345.9063 L453,335.9063 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="206" x="240" y="352.9668">In PSD2 markets the solution can be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="208" x="240" y="368.2012">supported by Konsentus who provide</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="200" x="240" y="383.4355">a pan-EU solution for checking both</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="154" x="240" y="398.6699">certificate and TPP validity.</text><polygon fill="#A80036" points="785.5,433.0781,795.5,437.0781,785.5,441.0781,789.5,437.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="791.5" y1="437.0781" y2="437.0781"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="184" x="236" y="431.9043">Request certification verification</text><line style="stroke:#A80036;stroke-width:1.0;" x1="797.5" x2="839.5" y1="481.5469" y2="481.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="839.5" x2="839.5" y1="481.5469" y2="494.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="839.5" y1="494.5469" y2="494.5469"/><polygon fill="#A80036" points="808.5,490.5469,798.5,494.5469,808.5,498.5469,804.5,494.5469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="804.5" y="461.1387">Resolve certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="66" x="804.5" y="476.373">provenance</text><polygon fill="#A80036" points="905.5,535.0156,915.5,539.0156,905.5,543.0156,909.5,539.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="797.5" x2="911.5" y1="539.0156" y2="539.0156"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="94" x="804.5" y="518.6074">Verify certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="53" x="804.5" y="533.8418">in market</text><polygon fill="#A80036" points="808.5,564.25,798.5,568.25,808.5,572.25,804.5,568.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="802.5" x2="916.5" y1="568.25" y2="568.25"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="814.5" y="563.0762">Response</text><polygon fill="#A80036" points="240,593.4844,230,597.4844,240,601.4844,236,597.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="796.5" y1="597.4844" y2="597.4844"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="592.3105">Response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="182" x2="980" y1="606.4844" y2="606.4844"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115" x="187" y="616.6895">[Non-European Market]</text><path d="M234,625.375 L234,680.375 L501,680.375 L501,635.375 L491,625.375 L234,625.375 " fill="#FBFB77" filter="url(#f1d9rm3panr4hd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M491,625.375 L491,635.375 L501,635.375 L491,625.375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="246" x="240" y="642.4355">Non-PSD2 markets tend to implement more</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="231" x="240" y="657.6699">traditional PKIs where validity is checked</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="155" x="240" y="672.9043">using either OCSP or a CRL.</text><polygon fill="#A80036" points="692,707.3125,702,711.3125,692,715.3125,696,711.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="698" y1="711.3125" y2="711.3125"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="209" x="236" y="706.1387">Check certificate status (OCSP/CRL)</text><polygon fill="#A80036" points="240,736.5469,230,740.5469,240,744.5469,236,740.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="703" y1="740.5469" y2="740.5469"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="735.373">Response</text><path d="M182,762.5469 L241,762.5469 L241,769.5469 L231,779.5469 L182,779.5469 L182,762.5469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="382.75" style="stroke:#000000;stroke-width:2.0;" width="496" x="182" y="762.5469"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="197" y="775.6074">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157" x="256" y="774.752">[Certificate binding is enforced]</text><path d="M234,784.7813 L234,889.7813 L494,889.7813 L494,794.7813 L484,784.7813 L234,784.7813 " fill="#FBFB77" filter="url(#f1d9rm3panr4hd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M484,784.7813 L484,794.7813 L494,794.7813 L484,784.7813 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="239" x="240" y="801.8418">Binding the Access Token to a given client</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="238" x="240" y="817.0762">certificate is enforced through FAPI which</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="62" x="240" y="832.3105">references</text><a href="https://datatracker.ietf.org/doc/html/rfc8705" target="_top" title="https://datatracker.ietf.org/doc/html/rfc8705" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc8705" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc8705" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="54" x="305" y="832.3105">RFC 8705</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="359" y="832.3105">.</text><line style="stroke:#000000;stroke-width:1.0;" x1="240" x2="240" y1="837.4844" y2="837.4844"/><line style="stroke:#000000;stroke-width:1.0;" x1="240" x2="240" y1="837.4844" y2="837.4844"/><line style="stroke:#000000;stroke-width:1.0;" x1="240" x2="240" y1="837.4844" y2="837.4844"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="234" x="240" y="851.5449">To support this the API Gateway uses the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="225" x="240" y="866.7793">Access Token introspection endpoint to</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="227" x="240" y="882.0137">retrieve the stored certificate fingerprint.</text><polygon fill="#A80036" points="551,931.6563,561,935.6563,551,939.6563,555,935.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="557" y1="935.6563" y2="935.6563"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="82" x="236" y="915.248">Access Token</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="74" x="236" y="930.4824">introspection</text><line style="stroke:#A80036;stroke-width:1.0;" x1="563" x2="605" y1="980.125" y2="980.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="605" x2="605" y1="980.125" y2="993.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="564" x2="605" y1="993.125" y2="993.125"/><polygon fill="#A80036" points="574,989.125,564,993.125,574,997.125,570,993.125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="92" x="570" y="959.7168">Retrieve Access</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="570" y="974.9512">Token properties</text><polygon fill="#A80036" points="240,1018.3594,230,1022.3594,240,1026.3594,236,1022.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="562" y1="1022.3594" y2="1022.3594"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="1017.1855">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="271" y1="1066.8281" y2="1066.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="271" x2="271" y1="1066.8281" y2="1079.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230" x2="271" y1="1079.8281" y2="1079.8281"/><polygon fill="#A80036" points="240,1075.8281,230,1079.8281,240,1083.8281,236,1079.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="236" y="1046.4199">Calculate certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="58" x="236" y="1061.6543">fingerprint</text><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="271" y1="1124.2969" y2="1124.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="271" x2="271" y1="1124.2969" y2="1137.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230" x2="271" y1="1137.2969" y2="1137.2969"/><polygon fill="#A80036" points="240,1133.2969,230,1137.2969,240,1141.2969,236,1137.2969" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="236" y="1103.8887">Compare stored and</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="127" x="236" y="1119.123">calculated fingerprints</text><polygon fill="#A80036" points="397,1169.5313,407,1173.5313,397,1177.5313,401,1173.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="229" x2="403" y1="1173.5313" y2="1173.5313"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="156" x="236" y="1168.3574">Request protected endpoint</text><polygon fill="#A80036" points="1054,1198.7656,1064,1202.7656,1054,1206.7656,1058,1202.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="409" x2="1060" y1="1202.7656" y2="1202.7656"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="185" x="416" y="1197.5918">Request backend data or service</text><polygon fill="#A80036" points="420,1228,410,1232,420,1236,416,1232" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="414" x2="1065" y1="1232" y2="1232"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="426" y="1226.8262">Response</text><polygon fill="#A80036" points="240,1257.2344,230,1261.2344,240,1265.2344,236,1261.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234" x2="408" y1="1261.2344" y2="1261.2344"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="246" y="1256.0605">Response</text><polygon fill="#A80036" points="60,1286.4688,50,1290.4688,60,1294.4688,56,1290.4688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="228" y1="1290.4688" y2="1290.4688"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="66" y="1285.2949">Response</text><!--MD5=[b1d64e4a6518166c722daca4c2684d62]
@startuml Mutual_Authentication_Sequence

title \n\n

participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder\nApplication" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

participant "Market\nCertificate\nAuthority" as CA
participant "Konsentus" as KON
participant "European\nOpen Banking\nMarkets" as EURO
' participant "JSON Web\nKey Set" as OBD_JWKS

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

note right of TPP
This diagram shows the specifics of mutual authentication
as implemented in the open banking accelerator.
end note

TPP -> API_GATEWAY: Request protected endpoint
API_GATEWAY -> API_GATEWAY: Validate certificate chain

alt European Market

note right of API_GATEWAY
In PSD2 markets the solution can be
supported by Konsentus who provide
a pan-EU solution for checking both
certificate and TPP validity.
end note

API_GATEWAY -> KON: Request certification verification
KON -> KON: Resolve certificate\nprovenance
KON -> EURO: Verify certificate\nin market
KON <- - EURO: Response
API_GATEWAY <- - KON: Response

else Non-European Market

note right of API_GATEWAY
Non-PSD2 markets tend to implement more
traditional PKIs where validity is checked
using either OCSP or a CRL.
end note

API_GATEWAY -> CA: Check certificate status (OCSP/CRL)
API_GATEWAY <- - CA: Response
end opt

alt Certificate binding is enforced

note right of API_GATEWAY
Binding the Access Token to a given client
certificate is enforced through FAPI which
references [[https://datatracker.ietf.org/doc/html/rfc8705 RFC 8705]].
|||
To support this the API Gateway uses the
Access Token introspection endpoint to
retrieve the stored certificate fingerprint.
end note

API_GATEWAY -> IAM: Access Token\nintrospection
IAM -> IAM: Retrieve Access\nToken properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Calculate certificate\nfingerprint
API_GATEWAY -> API_GATEWAY: Compare stored and\ncalculated fingerprints
end alt

API_GATEWAY -> API_BUILDER: Request protected endpoint
API_BUILDER -> ASPSP_API: Request backend data or service
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: Response
TPP <- - API_GATEWAY: Response

@enduml

@startuml Mutual_Authentication_Sequence

title \n\n

participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder\nApplication" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

participant "Market\nCertificate\nAuthority" as CA
participant "Konsentus" as KON
participant "European\nOpen Banking\nMarkets" as EURO

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

note right of TPP
This diagram shows the specifics of mutual authentication
as implemented in the open banking accelerator.
end note

TPP -> API_GATEWAY: Request protected endpoint
API_GATEWAY -> API_GATEWAY: Validate certificate chain

alt European Market

note right of API_GATEWAY
In PSD2 markets the solution can be
supported by Konsentus who provide
a pan-EU solution for checking both
certificate and TPP validity.
end note

API_GATEWAY -> KON: Request certification verification
KON -> KON: Resolve certificate\nprovenance
KON -> EURO: Verify certificate\nin market
KON <- - EURO: Response
API_GATEWAY <- - KON: Response

else Non-European Market

note right of API_GATEWAY
Non-PSD2 markets tend to implement more
traditional PKIs where validity is checked
using either OCSP or a CRL.
end note

API_GATEWAY -> CA: Check certificate status (OCSP/CRL)
API_GATEWAY <- - CA: Response
end opt

alt Certificate binding is enforced

note right of API_GATEWAY
Binding the Access Token to a given client
certificate is enforced through FAPI which
references [[https://datatracker.ietf.org/doc/html/rfc8705 RFC 8705]].
|||
To support this the API Gateway uses the
Access Token introspection endpoint to
retrieve the stored certificate fingerprint.
end note

API_GATEWAY -> IAM: Access Token\nintrospection
IAM -> IAM: Retrieve Access\nToken properties
API_GATEWAY <- - IAM: Response
API_GATEWAY -> API_GATEWAY: Calculate certificate\nfingerprint
API_GATEWAY -> API_GATEWAY: Compare stored and\ncalculated fingerprints
end alt

API_GATEWAY -> API_BUILDER: Request protected endpoint
API_BUILDER -> ASPSP_API: Request backend data or service
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: Response
TPP <- - API_GATEWAY: Response

@enduml

PlantUML version 1.2021.7(Sun May 23 13:40:07 BST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>