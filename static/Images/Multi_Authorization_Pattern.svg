<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1330px" preserveAspectRatio="none" style="width:1029px;height:1330px;background:#FFFFFF;" version="1.1" viewBox="0 0 1029 1330" width="1029px" zoomAndPan="magnify"><defs><filter height="300%" id="fewnzgnnkfjsg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="0" x="520.75" y="29.4023"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="0" x="520.75" y="50.6016"/><rect fill="#FFFFFF" filter="url(#fewnzgnnkfjsg)" height="188.1738" style="stroke:#000000;stroke-width:2.0;" width="661" x="20" y="229.7949"/><rect fill="#FFFFFF" filter="url(#fewnzgnnkfjsg)" height="191.4629" style="stroke:#000000;stroke-width:2.0;" width="890.5" x="115" y="431.9688"/><rect fill="#FFFFFF" height="73.5762" style="stroke:none;stroke-width:1.0;" width="890.5" x="115" y="549.8555"/><rect fill="#FFFFFF" filter="url(#fewnzgnnkfjsg)" height="669.0762" style="stroke:#000000;stroke-width:2.0;" width="995.5" x="20" y="637.4316"/><rect fill="#FFFFFF" height="494.9023" style="stroke:none;stroke-width:1.0;" width="995.5" x="20" y="811.6055"/><rect fill="#FFFFFF" filter="url(#fewnzgnnkfjsg)" height="235.7734" style="stroke:#000000;stroke-width:2.0;" width="900.5" x="105" y="992.1133"/><rect fill="#FFFFFF" filter="url(#fewnzgnnkfjsg)" height="117.8867" style="stroke:#000000;stroke-width:2.0;" width="485.5" x="115" y="1058.7344"/><rect fill="#FFFFFF" height="44.2656" style="stroke:none;stroke-width:1.0;" width="900.5" x="105" y="1183.6211"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="72" x2="72" y1="129.8633" y2="1323.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="161" x2="161" y1="129.8633" y2="1323.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="552.5" x2="552.5" y1="129.8633" y2="1323.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="958.5" x2="958.5" y1="129.8633" y2="1323.5078"/><rect fill="#FEFECE" filter="url(#fewnzgnnkfjsg)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="81" x="30" y="94.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="37" y="114.9102">Customer</text><rect fill="#FEFECE" filter="url(#fewnzgnnkfjsg)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="68" x="125" y="94.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="132" y="114.9102">ACP API</text><rect fill="#FEFECE" filter="url(#fewnzgnnkfjsg)" height="63.4648" style="stroke:#A80036;stroke-width:1.5;" width="71" x="515.5" y="61.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="534.5" y="81.9336">Bank</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="525.5" y="98.4219">Identity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="522.5" y="114.9102">Provider</text><rect fill="#FEFECE" filter="url(#fewnzgnnkfjsg)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="69" x="922.5" y="77.8867"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="929.5" y="98.4219">Banking</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="929.5" y="114.9102">Systems</text><polygon fill="#A80036" points="83.5,181.4844,73.5,185.4844,83.5,189.4844,79.5,185.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="552" y1="185.4844" y2="185.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="89.5" y="180.7422">Send approval prompt to Customer via existing channel</text><polygon fill="#A80036" points="541,210.7949,551,214.7949,541,218.7949,545,214.7949" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="72.5" x2="547" y1="214.7949" y2="214.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="79.5" y="210.0527">Follow approval prompt</text><path d="M20,229.7949 L94,229.7949 L94,236.7949 L84,246.7949 L20,246.7949 L20,229.7949 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="188.1738" style="stroke:#000000;stroke-width:2.0;" width="661" x="20" y="229.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="35" y="243.3633">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="292" x="109" y="242.4297">[Request required number of authentication factors]</text><path d="M77,252.1055 L77,307.1055 L443,307.1055 L443,262.1055 L433,252.1055 L77,252.1055 " fill="#FBFB77" filter="url(#fewnzgnnkfjsg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M433,252.1055 L433,262.1055 L443,262.1055 L433,252.1055 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="327" x="83" y="269.6738">This loop is intended to be indicative and the actual</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="83" y="284.9844">mechanics are entirely dependent on the bank's</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345" x="83" y="300.2949">implementation and their approach to user experience.</text><polygon fill="#A80036" points="83.5,334.3477,73.5,338.3477,83.5,342.3477,79.5,338.3477" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="552" y1="338.3477" y2="338.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="89.5" y="333.6055">Serve credentials input page</text><polygon fill="#A80036" points="541,363.6582,551,367.6582,541,371.6582,545,367.6582" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72.5" x2="547" y1="367.6582" y2="367.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="79.5" y="362.916">Submit credentials</text><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="595" y1="396.9688" y2="396.9688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="595" x2="595" y1="396.9688" y2="409.9688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="554" x2="595" y1="409.9688" y2="409.9688"/><polygon fill="#A80036" points="564,405.9688,554,409.9688,564,413.9688,560,409.9688" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="560" y="392.2266">Verify credentials</text><path d="M115,431.9688 L183,431.9688 L183,438.9688 L173,448.9688 L115,448.9688 L115,431.9688 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="191.4629" style="stroke:#000000;stroke-width:2.0;" width="890.5" x="115" y="431.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23" x="130" y="445.5371">par</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="75" x="198" y="444.6035">[Get Consent]</text><polygon fill="#A80036" points="172,466.4121,162,470.4121,172,474.4121,168,470.4121" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="166" x2="552" y1="470.4121" y2="470.4121"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="320" x="178" y="465.3462">GET /{operation}/v1/consent/{consent-id}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="161" x2="203" y1="499.7227" y2="499.7227"/><line style="stroke:#A80036;stroke-width:1.0;" x1="203" x2="203" y1="499.7227" y2="512.7227"/><line style="stroke:#A80036;stroke-width:1.0;" x1="162" x2="203" y1="512.7227" y2="512.7227"/><polygon fill="#A80036" points="172,508.7227,162,512.7227,172,516.7227,168,512.7227" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="168" y="494.9805">Retrieve "Intent"</text><polygon fill="#A80036" points="541,537.8555,551,541.8555,541,545.8555,545,541.8555" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="161" x2="547" y1="541.8555" y2="541.8555"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="168" y="536.7896">200 OK {...}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="115" x2="1005.5" y1="550.8555" y2="550.8555"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="111" x="120" y="561.4902">[Get Approval State]</text><polygon fill="#A80036" points="947,582.1211,957,586.1211,947,590.1211,951,586.1211" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="953" y1="586.1211" y2="586.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="560" y="581.3789">Retrieve approval state</text><polygon fill="#A80036" points="564,611.4316,554,615.4316,564,619.4316,560,615.4316" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="558" x2="958" y1="615.4316" y2="615.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="570" y="610.6895">Response</text><path d="M20,637.4316 L82,637.4316 L82,644.4316 L72,654.4316 L20,654.4316 L20,637.4316 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="669.0762" style="stroke:#000000;stroke-width:2.0;" width="995.5" x="20" y="637.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="35" y="651">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="275" x="97" y="650.0664">[Consent already been rejected another approver]</text><path d="M77,659.7422 L77,730.7422 L481,730.7422 L481,669.7422 L471,659.7422 L77,659.7422 " fill="#FBFB77" filter="url(#fewnzgnnkfjsg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M471,659.7422 L471,669.7422 L481,669.7422 L471,659.7422 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="83" y="677.3105">This indicates that the first approver who approved the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="383" x="83" y="692.6211">initial consent and (where appropriate) selected the in-scope</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369" x="83" y="707.9316">accounts approved the consent but a subsequent approver</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="83" y="723.2422">rejected it.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="595" y1="761.2949" y2="761.2949"/><line style="stroke:#A80036;stroke-width:1.0;" x1="595" x2="595" y1="761.2949" y2="774.2949"/><line style="stroke:#A80036;stroke-width:1.0;" x1="554" x2="595" y1="774.2949" y2="774.2949"/><polygon fill="#A80036" points="564,770.2949,554,774.2949,564,778.2949,560,774.2949" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="560" y="756.5527">Render consent rejected screen</text><polygon fill="#A80036" points="83.5,799.6055,73.5,803.6055,83.5,807.6055,79.5,803.6055" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="552" y1="803.6055" y2="803.6055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="89.5" y="798.8633">Serve consent rejected screen</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="1015.5" y1="812.6055" y2="812.6055"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="176" x="25" y="823.2402">[Consent has not been rejected]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="595" y1="847.8711" y2="847.8711"/><line style="stroke:#A80036;stroke-width:1.0;" x1="595" x2="595" y1="847.8711" y2="860.8711"/><line style="stroke:#A80036;stroke-width:1.0;" x1="554" x2="595" y1="860.8711" y2="860.8711"/><polygon fill="#A80036" points="564,856.8711,554,860.8711,564,864.8711,560,860.8711" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="560" y="843.1289">Retrieve approvals</text><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="595" y1="905.4922" y2="905.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="595" x2="595" y1="905.4922" y2="918.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="554" x2="595" y1="918.4922" y2="918.4922"/><polygon fill="#A80036" points="564,914.4922,554,918.4922,564,922.4922,560,918.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="560" y="885.4395">Render Consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="560" y="900.75">Confirmation screen</text><polygon fill="#A80036" points="83.5,943.8027,73.5,947.8027,83.5,951.8027,79.5,947.8027" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="552" y1="947.8027" y2="947.8027"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="89.5" y="943.0605">Serve Consent Confirmation screen</text><polygon fill="#A80036" points="541,973.1133,551,977.1133,541,981.1133,545,977.1133" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72.5" x2="547" y1="977.1133" y2="977.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="79.5" y="972.3711">Approve/reject consent</text><path d="M105,992.1133 L167,992.1133 L167,999.1133 L157,1009.1133 L105,1009.1133 L105,992.1133 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="235.7734" style="stroke:#000000;stroke-width:2.0;" width="900.5" x="105" y="992.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="120" y="1005.6816">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="84" x="182" y="1004.748">[Last approver]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="595" y1="1030.7344" y2="1030.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="595" x2="595" y1="1030.7344" y2="1043.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="554" x2="595" y1="1043.7344" y2="1043.7344"/><polygon fill="#A80036" points="564,1039.7344,554,1043.7344,564,1047.7344,560,1043.7344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="392" x="560" y="1025.9922">Update Resources API or payment instruction to correct status</text><path d="M115,1058.7344 L177,1058.7344 L177,1065.7344 L167,1075.7344 L115,1075.7344 L115,1058.7344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="117.8867" style="stroke:#000000;stroke-width:2.0;" width="485.5" x="115" y="1058.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="130" y="1072.3027">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110" x="192" y="1071.3691">[Payment Initiation]</text><polygon fill="#A80036" points="172,1093.1777,162,1097.1777,172,1101.1777,168,1097.1777" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="166" x2="552" y1="1097.1777" y2="1097.1777"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="368" x="178" y="1092.1118">POST ​/payments/v1/consent/{consent-id}/consume</text><line style="stroke:#A80036;stroke-width:1.0;" x1="161" x2="203" y1="1126.4883" y2="1126.4883"/><line style="stroke:#A80036;stroke-width:1.0;" x1="203" x2="203" y1="1126.4883" y2="1139.4883"/><line style="stroke:#A80036;stroke-width:1.0;" x1="162" x2="203" y1="1139.4883" y2="1139.4883"/><polygon fill="#A80036" points="172,1135.4883,162,1139.4883,172,1143.4883,168,1139.4883" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="168" y="1121.7461">Update status to</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="276" y="1121.4224">CONSUMED</text><polygon fill="#A80036" points="541,1164.6211,551,1168.6211,541,1172.6211,545,1168.6211" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="161" x2="547" y1="1168.6211" y2="1168.6211"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="168" y="1163.5552">200 OK</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="105" x2="1005.5" y1="1184.6211" y2="1184.6211"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="105" x="110" y="1195.2559">[Not last approver]</text><polygon fill="#A80036" points="947,1215.8867,957,1219.8867,947,1223.8867,951,1219.8867" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="953" y1="1219.8867" y2="1219.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="560" y="1215.1445">Update approval state</text><line style="stroke:#A80036;stroke-width:1.0;" x1="553" x2="595" y1="1256.1973" y2="1256.1973"/><line style="stroke:#A80036;stroke-width:1.0;" x1="595" x2="595" y1="1256.1973" y2="1269.1973"/><line style="stroke:#A80036;stroke-width:1.0;" x1="554" x2="595" y1="1269.1973" y2="1269.1973"/><polygon fill="#A80036" points="564,1265.1973,554,1269.1973,564,1273.1973,560,1269.1973" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="560" y="1251.4551">Render confirmation complete screen</text><polygon fill="#A80036" points="83.5,1294.5078,73.5,1298.5078,83.5,1302.5078,79.5,1298.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="552" y1="1298.5078" y2="1298.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="89.5" y="1293.7656">Serve confirmation complete screen</text><!--MD5=[5ea8888a0bb8ea309b961b1260760058]
@startuml Multi_Authorization_Pattern

title \n

participant "Customer" as PSU
participant "ACP API" as CONSENT
participant "Bank\nIdentity\nProvider" as ASPSP_WEB
participant "Banking\nSystems" as ASPSP_API

hide footbox

loop Required number of additional approvers

PSU <- ASPSP_WEB: Send approval prompt to Customer via existing channel
PSU - -> ASPSP_WEB: Follow approval prompt

loop Request required number of authentication factors

note right of PSU
This loop is intended to be indicative and the actual
mechanics are entirely dependent on the bank's
implementation and their approach to user experience.
end note

PSU <- - ASPSP_WEB: Serve credentials input page
PSU -> ASPSP_WEB: Submit credentials
ASPSP_WEB -> ASPSP_WEB: Verify credentials

end loop

par Get Consent

ASPSP_WEB -> CONSENT: ""GET /{operation}/v1/consent/{consent-id}""
CONSENT -> CONSENT: Retrieve "Intent"
ASPSP_WEB <- - CONSENT: ""200 OK {...}""

else Get Approval State

ASPSP_WEB -> ASPSP_API: Retrieve approval state
ASPSP_WEB <- - ASPSP_API: Response

end par

alt Consent already been rejected another approver

note right of PSU
This indicates that the first approver who approved the
initial consent and (where appropriate) selected the in-scope
accounts approved the consent but a subsequent approver
rejected it.
end note

ASPSP_WEB -> ASPSP_WEB: Render consent rejected screen
PSU <- - ASPSP_WEB: Serve consent rejected screen

else Consent has not been rejected

ASPSP_WEB -> ASPSP_WEB: Retrieve approvals

ASPSP_WEB -> ASPSP_WEB: Render Consent\nConfirmation screen
PSU <- - ASPSP_WEB: Serve Consent Confirmation screen


PSU -> ASPSP_WEB: Approve/reject consent

alt Last approver

ASPSP_WEB -> ASPSP_WEB: Update Resources API or payment instruction to correct status

alt Payment Initiation
ASPSP_WEB -> CONSENT: ""POST ​/payments/v1/consent/{consent-id}/consume""
CONSENT -> CONSENT: Update status to ""CONSUMED""
ASPSP_WEB <- - CONSENT: ""200 OK""
end alt

else Not last approver

ASPSP_WEB -> ASPSP_API: Update approval state

end alt

ASPSP_WEB -> ASPSP_WEB: Render confirmation complete screen
PSU <- - ASPSP_WEB: Serve confirmation complete screen

end loop

@enduml

PlantUML version 1.2021.7(Sun May 23 13:40:07 BST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>