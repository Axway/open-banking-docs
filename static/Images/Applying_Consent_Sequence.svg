<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1701px" preserveAspectRatio="none" style="width:1400px;height:1701px;" version="1.1" viewBox="0 0 1400 1701" width="1400px" zoomAndPan="magnify"><defs><filter height="300%" id="f1al26d51s1o5m" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="488" x="463.25" y="29.4023">Applying User Consent to Account Information Requests</text><rect fill="#E06666" height="1647.0313" style="stroke:#A80036;stroke-width:1.0;" width="348.5" x="296" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129" x="403.75" y="53.7676">Open Banking APIs</text><rect fill="#94C47D" height="1647.0313" style="stroke:#A80036;stroke-width:1.0;" width="195" x="823" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="185" x="826" y="53.7676">Identity and Access Control</text><rect fill="#D5A6BD" height="1647.0313" style="stroke:#A80036;stroke-width:1.0;" width="188" x="1020" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178" x="1023" y="53.7676">Core Banking Applications</text><rect fill="#FFFFFF" filter="url(#f1al26d51s1o5m)" height="1124.9766" style="stroke:#000000;stroke-width:2.0;" width="1376" x="10" y="480.6328"/><rect fill="#FFFFFF" height="993.1133" style="stroke:none;stroke-width:1.0;" width="1376" x="10" y="612.4961"/><rect fill="#FFFFFF" filter="url(#f1al26d51s1o5m)" height="964.1582" style="stroke:#000000;stroke-width:2.0;" width="1096" x="280" y="634.4512"/><rect fill="#FFFFFF" filter="url(#f1al26d51s1o5m)" height="551.2344" style="stroke:#000000;stroke-width:2.0;" width="1076" x="290" y="716.3828"/><rect fill="#FFFFFF" height="274.4395" style="stroke:none;stroke-width:1.0;" width="1076" x="290" y="993.1777"/><rect fill="#FFFFFF" height="323.9922" style="stroke:none;stroke-width:1.0;" width="1096" x="280" y="1274.6172"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="68" x2="68" y1="128.9746" y2="1694.2305"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="337" x2="337" y1="128.9746" y2="1694.2305"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="592.5" x2="592.5" y1="128.9746" y2="1694.2305"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="920" x2="920" y1="128.9746" y2="1694.2305"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1113.5" x2="1113.5" y1="128.9746" y2="1694.2305"/><rect fill="#FEFECE" filter="url(#f1al26d51s1o5m)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="93" x="20" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="27" y="97.5332">Third-Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="52.5" y="114.0215">App</text><rect fill="#FEFECE" filter="url(#f1al26d51s1o5m)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="71" x="300" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="324.5" y="97.5332">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="307" y="114.0215">Gateway</text><rect fill="#FEFECE" filter="url(#f1al26d51s1o5m)" height="63.4648" style="stroke:#A80036;stroke-width:1.5;" width="92" x="544.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="579.5" y="81.0449">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="566.5" y="97.5332">Builder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="551.5" y="114.0215">Application</text><rect fill="#FEFECE" filter="url(#f1al26d51s1o5m)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="103" x="867" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="893" y="97.5332">Identity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="874" y="114.0215">Management</text><rect fill="#FEFECE" filter="url(#f1al26d51s1o5m)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="69" x="1077.5" y="76.998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="1084.5" y="97.5332">Banking</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="1084.5" y="114.0215">Systems</text><path d="M73,143.9746 L73,318.9746 L522,318.9746 L522,153.9746 L512,143.9746 L73,143.9746 " fill="#FBFB77" filter="url(#f1al26d51s1o5m)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M512,143.9746 L512,153.9746 L522,153.9746 L512,143.9746 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="79" y="161.543">Overview</text><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="521" y1="164.2852" y2="164.2852"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="521" y1="166.2852" y2="166.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376" x="79" y="180.8535">Filtering responses for account/permissions at the Gateway</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="79" y="196.1641">is pragmatic in many use cases but is ultimately not scaleable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="79" y="211.4746">due to load and determinism for features such as pagination.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="428" x="79" y="226.7852">It should therefore be implemented as close to the system of record</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="79" y="242.0957">as possible i.e. Core Banking Applications. The order of prefer in</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="79" y="257.4063">terms of solutions is:</text><line style="stroke:#000000;stroke-width:1.0;" x1="79" x2="79" y1="262.1484" y2="262.1484"/><line style="stroke:#000000;stroke-width:1.0;" x1="79" x2="79" y1="262.1484" y2="262.1484"/><line style="stroke:#000000;stroke-width:1.0;" x1="79" x2="79" y1="262.1484" y2="262.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="79" y="276.7168">1. Filter at the Core Banking Application.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="360" x="79" y="292.0273">2. Filter at a microservice capable of "stateful" behaviour.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="79" y="307.3379">3. Filter at the Gateway.</text><polygon fill="#A80036" points="325.5,360.7012,335.5,364.7012,325.5,368.7012,329.5,364.7012" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="68.5" x2="331.5" y1="364.7012" y2="364.7012"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="75.5" y="344.6484">Request Account Information Resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="75.5" y="359.959">with valid Access Token</text><polygon fill="#A80036" points="908.5,390.0117,918.5,394.0117,908.5,398.0117,912.5,394.0117" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="914.5" y1="394.0117" y2="394.0117"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="344.5" y="389.2695">Call Access Token Introspect Endpoint</text><polygon fill="#A80036" points="348.5,419.3223,338.5,423.3223,348.5,427.3223,344.5,423.3223" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="342.5" x2="919.5" y1="423.3223" y2="423.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="354.5" y="418.5801">Return introspection information</text><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="379.5" y1="452.6328" y2="452.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="379.5" x2="379.5" y1="452.6328" y2="465.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338.5" x2="379.5" y1="465.6328" y2="465.6328"/><polygon fill="#A80036" points="348.5,461.6328,338.5,465.6328,348.5,469.6328,344.5,465.6328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="344.5" y="447.8906">Inspect request</text><path d="M10,480.6328 L72,480.6328 L72,487.6328 L62,497.6328 L10,497.6328 L10,480.6328 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1124.9766" style="stroke:#000000;stroke-width:2.0;" width="1376" x="10" y="480.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="494.2012">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="376" x="87" y="493.2676">[TPP does not have Consent for the requested account or resource]</text><path d="M73,502.9434 L73,573.9434 L420,573.9434 L420,512.9434 L410,502.9434 L73,502.9434 " fill="#FBFB77" filter="url(#f1al26d51s1o5m)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M410,502.9434 L410,512.9434 L420,512.9434 L410,502.9434 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307" x="79" y="520.5117">In some cases the permissions are binary i.e. the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="79" y="535.8223">TPP does or does not have permission to access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="79" y="551.1328">a given endpoint. In such cases the Gateway can</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="79" y="566.4434">immediately respond without going to the backend.</text><polygon fill="#A80036" points="79.5,600.4961,69.5,604.4961,79.5,608.4961,75.5,604.4961" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="73.5" x2="336.5" y1="604.4961" y2="604.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="85.5" y="599.7539">Respond with 403 (Forbidden)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1386" y1="613.4961" y2="613.4961"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="267" x="15" y="624.1309">[TPP has Consent to access requested resource]</text><path d="M280,634.4512 L342,634.4512 L342,641.4512 L332,651.4512 L280,651.4512 L280,634.4512 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="964.1582" style="stroke:#000000;stroke-width:2.0;" width="1096" x="280" y="634.4512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="295" y="648.0195">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="226" x="357" y="647.0859">[Filtering is performed outside Gateway]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="379.5" y1="688.3828" y2="688.3828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="379.5" x2="379.5" y1="688.3828" y2="701.3828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338.5" x2="379.5" y1="701.3828" y2="701.3828"/><polygon fill="#A80036" points="348.5,697.3828,338.5,701.3828,348.5,705.3828,344.5,701.3828" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="344.5" y="668.3301">Augment request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="344.5" y="683.6406">with consented accounts/permissions</text><path d="M290,716.3828 L352,716.3828 L352,723.3828 L342,733.3828 L290,733.3828 L290,716.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="551.2344" style="stroke:#000000;stroke-width:2.0;" width="1076" x="290" y="716.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="305" y="729.9512">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="293" x="367" y="729.0176">[Filtering is performed at Core Banking Application]</text><polygon fill="#A80036" points="580.5,766.3145,590.5,770.3145,580.5,774.3145,584.5,770.3145" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="586.5" y1="770.3145" y2="770.3145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="344.5" y="750.2617">Forward request with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="344.5" y="765.5723">consented accounts/permissions</text><line style="stroke:#A80036;stroke-width:1.0;" x1="592.5" x2="634.5" y1="799.625" y2="799.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="634.5" x2="634.5" y1="799.625" y2="812.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="593.5" x2="634.5" y1="812.625" y2="812.625"/><polygon fill="#A80036" points="603.5,808.625,593.5,812.625,603.5,816.625,599.5,812.625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="599.5" y="794.8828">Create request for consented accounts</text><polygon fill="#A80036" points="1102,837.9355,1112,841.9355,1102,845.9355,1106,841.9355" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="592.5" x2="1108" y1="841.9355" y2="841.9355"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="599.5" y="837.1934">Request data for consented accounts</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1114" x2="1156" y1="871.2461" y2="871.2461"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1156" x2="1156" y1="871.2461" y2="884.2461"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1115" x2="1156" y1="884.2461" y2="884.2461"/><polygon fill="#A80036" points="1125,880.2461,1115,884.2461,1125,888.2461,1121,884.2461" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="1121" y="866.5039">Retrieve data for consented accounts</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1114" x2="1156" y1="913.5566" y2="913.5566"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1156" x2="1156" y1="913.5566" y2="926.5566"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1115" x2="1156" y1="926.5566" y2="926.5566"/><polygon fill="#A80036" points="1125,922.5566,1115,926.5566,1125,930.5566,1121,926.5566" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="1121" y="908.8145">Apply permissions to requested data</text><polygon fill="#A80036" points="603.5,951.8672,593.5,955.8672,603.5,959.8672,599.5,955.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="597.5" x2="1113" y1="955.8672" y2="955.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="609.5" y="951.125">Return data for consented accounts</text><polygon fill="#A80036" points="348.5,981.1777,338.5,985.1777,348.5,989.1777,344.5,985.1777" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="342.5" x2="591.5" y1="985.1777" y2="985.1777"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="354.5" y="980.4355">Return response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="290" x2="1366" y1="994.1777" y2="994.1777"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="281" x="295" y="1004.8125">[Filtering is performed at API Builder Application]</text><polygon fill="#A80036" points="580.5,1040.7539,590.5,1044.7539,580.5,1048.7539,584.5,1044.7539" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="586.5" y1="1044.7539" y2="1044.7539"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="344.5" y="1024.7012">Forward request with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="344.5" y="1040.0117">consented accounts/permissions</text><line style="stroke:#A80036;stroke-width:1.0;" x1="592.5" x2="634.5" y1="1074.0645" y2="1074.0645"/><line style="stroke:#A80036;stroke-width:1.0;" x1="634.5" x2="634.5" y1="1074.0645" y2="1087.0645"/><line style="stroke:#A80036;stroke-width:1.0;" x1="593.5" x2="634.5" y1="1087.0645" y2="1087.0645"/><polygon fill="#A80036" points="603.5,1083.0645,593.5,1087.0645,603.5,1091.0645,599.5,1087.0645" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="599.5" y="1069.3223">Create request for consented accounts</text><polygon fill="#A80036" points="1102,1112.375,1112,1116.375,1102,1120.375,1106,1116.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="592.5" x2="1108" y1="1116.375" y2="1116.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="599.5" y="1111.6328">Request data for consented accounts</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1114" x2="1156" y1="1145.6855" y2="1145.6855"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1156" x2="1156" y1="1145.6855" y2="1158.6855"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1115" x2="1156" y1="1158.6855" y2="1158.6855"/><polygon fill="#A80036" points="1125,1154.6855,1115,1158.6855,1125,1162.6855,1121,1158.6855" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="1121" y="1140.9434">Retrieve data for consented accounts</text><polygon fill="#A80036" points="603.5,1183.9961,593.5,1187.9961,603.5,1191.9961,599.5,1187.9961" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="597.5" x2="1113" y1="1187.9961" y2="1187.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="609.5" y="1183.2539">Return data for consented accounts</text><line style="stroke:#A80036;stroke-width:1.0;" x1="592.5" x2="634.5" y1="1217.3066" y2="1217.3066"/><line style="stroke:#A80036;stroke-width:1.0;" x1="634.5" x2="634.5" y1="1217.3066" y2="1230.3066"/><line style="stroke:#A80036;stroke-width:1.0;" x1="593.5" x2="634.5" y1="1230.3066" y2="1230.3066"/><polygon fill="#A80036" points="603.5,1226.3066,593.5,1230.3066,603.5,1234.3066,599.5,1230.3066" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="599.5" y="1212.5645">Apply correct permissions to response data</text><polygon fill="#A80036" points="348.5,1255.6172,338.5,1259.6172,348.5,1263.6172,344.5,1259.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="342.5" x2="591.5" y1="1259.6172" y2="1259.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="354.5" y="1254.875">Return response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="280" x2="1376" y1="1275.6172" y2="1275.6172"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="222" x="285" y="1286.252">[Filtering is performed on API Gateway]</text><path d="M342,1294.5723 L342,1445.5723 L741,1445.5723 L741,1304.5723 L731,1294.5723 L342,1294.5723 " fill="#FBFB77" filter="url(#f1al26d51s1o5m)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M731,1294.5723 L731,1304.5723 L741,1304.5723 L731,1294.5723 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="348" y="1312.1406">The assumption here is that the API Gateway will</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="348" y="1327.4512">connect to the Core Banking Applications</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="348" y="1342.7617">directly.</text><line style="stroke:#000000;stroke-width:1.0;" x1="348" x2="348" y1="1347.5039" y2="1347.5039"/><line style="stroke:#000000;stroke-width:1.0;" x1="348" x2="348" y1="1347.5039" y2="1347.5039"/><line style="stroke:#000000;stroke-width:1.0;" x1="348" x2="348" y1="1347.5039" y2="1347.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="348" y="1362.0723">Note this approach works fine where low-volumes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="360" x="348" y="1377.3828">are expected. However in scenarios where a high-volume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="348" y="1392.6934">is expected it may not be hugely efficient i.e. lots</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="348" y="1408.0039">more data is returned to the gateway, then filtered.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="378" x="348" y="1423.3145">Unless the API Gateway has some means for managing state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="348" y="1438.625">this may also make pagination difficult.</text><polygon fill="#A80036" points="1102,1472.6777,1112,1476.6777,1102,1480.6777,1106,1476.6777" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="1108" y1="1476.6777" y2="1476.6777"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="344.5" y="1471.9355">Request target accounts</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1114" x2="1156" y1="1505.9883" y2="1505.9883"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1156" x2="1156" y1="1505.9883" y2="1518.9883"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1115" x2="1156" y1="1518.9883" y2="1518.9883"/><polygon fill="#A80036" points="1125,1514.9883,1115,1518.9883,1125,1522.9883,1121,1518.9883" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="1121" y="1501.2461">Retrieve data for consented accounts</text><polygon fill="#A80036" points="348.5,1544.2988,338.5,1548.2988,348.5,1552.2988,344.5,1548.2988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="342.5" x2="1113" y1="1548.2988" y2="1548.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="354.5" y="1543.5566">Return response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="379.5" y1="1577.6094" y2="1577.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="379.5" x2="379.5" y1="1577.6094" y2="1590.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338.5" x2="379.5" y1="1590.6094" y2="1590.6094"/><polygon fill="#A80036" points="348.5,1586.6094,338.5,1590.6094,348.5,1594.6094,344.5,1590.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="344.5" y="1572.8672">Apply permissions</text><line style="stroke:#A80036;stroke-width:1.0;" x1="337.5" x2="379.5" y1="1633.9199" y2="1633.9199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="379.5" x2="379.5" y1="1633.9199" y2="1646.9199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338.5" x2="379.5" y1="1646.9199" y2="1646.9199"/><polygon fill="#A80036" points="348.5,1642.9199,338.5,1646.9199,348.5,1650.9199,344.5,1646.9199" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="344.5" y="1629.1777">Format response for standards</text><polygon fill="#A80036" points="79.5,1672.2305,69.5,1676.2305,79.5,1680.2305,75.5,1676.2305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="73.5" x2="336.5" y1="1676.2305" y2="1676.2305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="85.5" y="1671.4883">Return response</text><!--MD5=[30c598023b4b71c214a504a5968886a0]
@startuml Apply User Consent to Request/Response

title Applying User Consent to Account Information Requests


participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder\nApplication" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox


note right of TPP
Overview
===
Filtering responses for account/permissions at the Gateway
is pragmatic in many use cases but is ultimately not scaleable
due to load and determinism for features such as pagination.
It should therefore be implemented as close to the system of record
as possible i.e. Core Banking Applications. The order of prefer in
terms of solutions is:
|||
1. Filter at the Core Banking Application.
2. Filter at a microservice capable of "stateful" behaviour.
3. Filter at the Gateway.
end note

TPP -> API_GATEWAY: Request Account Information Resource\nwith valid Access Token

API_GATEWAY -> IAM: Call Access Token Introspect Endpoint
API_GATEWAY <- - IAM: Return introspection information
API_GATEWAY -> API_GATEWAY: Inspect request

alt TPP does not have Consent for the requested account or resource

note right of TPP
In some cases the permissions are binary i.e. the
TPP does or does not have permission to access
a given endpoint. In such cases the Gateway can
immediately respond without going to the backend.
end note

TPP <- - API_GATEWAY: Respond with 403 (Forbidden)

else TPP has Consent to access requested resource

alt Filtering is performed outside Gateway
API_GATEWAY -> API_GATEWAY: Augment request\nwith consented accounts/permissions

alt Filtering is performed at Core Banking Application

API_GATEWAY -> API_BUILDER: Forward request with\nconsented accounts/permissions
API_BUILDER -> API_BUILDER: Create request for consented accounts
API_BUILDER -> ASPSP_API: Request data for consented accounts
ASPSP_API -> ASPSP_API: Retrieve data for consented accounts
ASPSP_API -> ASPSP_API: Apply permissions to requested data
API_BUILDER <- - ASPSP_API: Return data for consented accounts
API_GATEWAY <- - API_BUILDER: Return response

else Filtering is performed at API Builder Application

API_GATEWAY -> API_BUILDER: Forward request with\nconsented accounts/permissions
API_BUILDER -> API_BUILDER: Create request for consented accounts
API_BUILDER -> ASPSP_API: Request data for consented accounts
ASPSP_API -> ASPSP_API: Retrieve data for consented accounts
API_BUILDER <- - ASPSP_API: Return data for consented accounts
API_BUILDER -> API_BUILDER: Apply correct permissions to response data
API_GATEWAY <- - API_BUILDER: Return response

end alt

else Filtering is performed on API Gateway

note right of API_GATEWAY
The assumption here is that the API Gateway will
connect to the Core Banking Applications 
directly.
|||
Note this approach works fine where low-volumes
are expected. However in scenarios where a high-volume
is expected it may not be hugely efficient i.e. lots
more data is returned to the gateway, then filtered.
Unless the API Gateway has some means for managing state
this may also make pagination difficult.
end note

API_GATEWAY -> ASPSP_API: Request target accounts
ASPSP_API -> ASPSP_API: Retrieve data for consented accounts
API_GATEWAY <- - ASPSP_API: Return response
API_GATEWAY -> API_GATEWAY: Apply permissions

end alt
end alt

API_GATEWAY -> API_GATEWAY: Format response for standards
TPP <- - API_GATEWAY: Return response

@enduml

PlantUML version 1.2021.00(Sun Jan 10 10:25:05 GMT 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>