<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1708px" preserveAspectRatio="none" style="width:1464px;height:1708px;background:#FFFFFF;" version="1.1" viewBox="0 0 1464 1708" width="1464px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="58.8906" id="_title" style="stroke:none;stroke-width:1.0;" width="15" x="739.25" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="744.25" y="27.9951"> </text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="744.25" y="44.292"> </text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="5" x="744.25" y="60.5889"> </text><rect fill="#E06666" height="1619.875" style="stroke:#181818;stroke-width:0.5;" width="342" x="291" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141" x="389" y="87.9575">Open Banking APIs</text><rect fill="#94C47D" height="1619.875" style="stroke:#181818;stroke-width:0.5;" width="214" x="820" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="203" x="823" y="87.9575">Identity and Access Control</text><rect fill="#D5A6BD" height="1619.875" style="stroke:#181818;stroke-width:0.5;" width="206" x="1076" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195" x="1079" y="87.9575">Core Banking Applications</text><rect fill="none" height="1109.5938" style="stroke:#000000;stroke-width:1.5;" width="1447" x="10" y="503.9063"/><rect fill="none" height="953.9922" style="stroke:#000000;stroke-width:1.5;" width="1172" x="275" y="652.5078"/><rect fill="none" height="548.0625" style="stroke:#000000;stroke-width:1.5;" width="1152" x="285" y="733.9063"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="59" x2="59" y1="158.9141" y2="1701.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="331" x2="331" y1="158.9141" y2="1701.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="584" x2="584" y1="158.9141" y2="1701.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="926.5" x2="926.5" y1="158.9141" y2="1701.7656"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1178.5" x2="1178.5" y1="158.9141" y2="1701.7656"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="20" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="43.5" y="131.3154">Data</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="27" y="147.6123">Recipient</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="295" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="321" y="131.3154">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="302" y="147.6123">Gateway</text><rect fill="#E2E2F0" height="62.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89" x="540" y="95.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="554" y="115.0186">Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="547.5" y="131.3154">Integration</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="547" y="147.6123">Application</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="874.5" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="902" y="131.3154">Identity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="881.5" y="147.6123">Management</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1142.5" y="111.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1151" y="131.3154">Banking</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1149.5" y="147.6123">Systems</text><path d="M64,173.9141 L64,346.9141 L521,346.9141 L521,183.9141 L511,173.9141 L64,173.9141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M511,173.9141 L511,183.9141 L521,183.9141 L511,173.9141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="70" y="190.981">Overview</text><line style="stroke:#181818;stroke-width:1.0;" x1="65" x2="520" y1="194.0469" y2="194.0469"/><line style="stroke:#181818;stroke-width:1.0;" x1="65" x2="520" y1="196.0469" y2="196.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="378" x="70" y="210.1138">Filtering responses for account/permissions at the Gateway</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397" x="70" y="225.2466">is pragmatic in many use cases but is ultimately not scaleable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="70" y="240.3794">due to load and determinism for features such as pagination.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="70" y="255.5122">It should therefore be implemented as close to the system of record</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="70" y="270.645">as possible i.e. Core Banking Applications. The order of prefer in</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="70" y="285.7778">terms of solutions is:</text><line style="stroke:#000000;stroke-width:0.5;" x1="70" x2="70" y1="290.8438" y2="290.8438"/><line style="stroke:#000000;stroke-width:0.5;" x1="70" x2="70" y1="290.8438" y2="290.8438"/><line style="stroke:#000000;stroke-width:0.5;" x1="70" x2="70" y1="290.8438" y2="290.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="70" y="304.9106">1. Filter at the Core Banking Application.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="70" y="320.0435">2. Filter at a microservice capable of "stateful" behaviour.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="70" y="335.1763">3. Filter at the Gateway.</text><polygon fill="#181818" points="319.5,384.5078,329.5,388.5078,319.5,392.5078,323.5,388.5078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="59.5" x2="325.5" y1="388.5078" y2="388.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="66.5" y="368.3091">Request Account Information Resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="66.5" y="383.4419">with valid Access Token</text><polygon fill="#181818" points="915,413.6406,925,417.6406,915,421.6406,919,417.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="921" y1="417.6406" y2="417.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="338.5" y="412.5747">Call Access Token Introspect Endpoint</text><polygon fill="#181818" points="342.5,442.7734,332.5,446.7734,342.5,450.7734,338.5,446.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="336.5" x2="926" y1="446.7734" y2="446.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="348.5" y="441.7075">Return introspection information</text><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="373.5" y1="475.9063" y2="475.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="373.5" x2="373.5" y1="475.9063" y2="488.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="332.5" x2="373.5" y1="488.9063" y2="488.9063"/><polygon fill="#181818" points="342.5,484.9063,332.5,488.9063,342.5,492.9063,338.5,488.9063" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="338.5" y="470.8403">Inspect request</text><path d="M10,503.9063 L74,503.9063 L74,511.0391 L64,521.0391 L10,521.0391 L10,503.9063 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1109.5938" style="stroke:#000000;stroke-width:1.5;" width="1447" x="10" y="503.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="516.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="427" x="89" y="516.1167">[DR does not have Consent for the requested account or resource]</text><path d="M64,526.0391 L64,596.0391 L413,596.0391 L413,536.0391 L403,526.0391 L64,526.0391 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M403,526.0391 L403,536.0391 L413,536.0391 L403,526.0391 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314" x="70" y="543.106">In some cases the permissions are binary i.e. the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="70" y="558.2388">DR does or does not have permission to access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="70" y="573.3716">a given endpoint. In such cases the Gateway can</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="70" y="588.5044">immediately respond without going to the backend.</text><polygon fill="#181818" points="70.5,618.7031,60.5,622.7031,70.5,626.7031,66.5,622.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="330.5" y1="622.7031" y2="622.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="76.5" y="617.6372">Respond with 403 (Forbidden)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1457" y1="631.7031" y2="631.7031"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="305" x="15" y="641.9136">[DR has Consent to access requested resource]</text><path d="M275,652.5078 L339,652.5078 L339,659.6406 L329,669.6406 L275,669.6406 L275,652.5078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="953.9922" style="stroke:#000000;stroke-width:1.5;" width="1172" x="275" y="652.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="290" y="665.5747">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="261" x="354" y="664.7183">[Filtering is performed outside Gateway]</text><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="373.5" y1="705.9063" y2="705.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="373.5" x2="373.5" y1="705.9063" y2="718.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="332.5" x2="373.5" y1="718.9063" y2="718.9063"/><polygon fill="#181818" points="342.5,714.9063,332.5,718.9063,342.5,722.9063,338.5,718.9063" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="338.5" y="685.7075">Augment request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="338.5" y="700.8403">with consented accounts/permissions</text><path d="M285,733.9063 L349,733.9063 L349,741.0391 L339,751.0391 L285,751.0391 L285,733.9063 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="548.0625" style="stroke:#000000;stroke-width:1.5;" width="1152" x="285" y="733.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="300" y="746.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="332" x="364" y="746.1167">[Filtering is performed at Core Banking Application]</text><polygon fill="#181818" points="572.5,783.3047,582.5,787.3047,572.5,791.3047,576.5,787.3047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="578.5" y1="787.3047" y2="787.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="338.5" y="767.106">Forward request with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="338.5" y="782.2388">consented accounts/permissions</text><line style="stroke:#181818;stroke-width:1.0;" x1="584.5" x2="626.5" y1="816.4375" y2="816.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="626.5" x2="626.5" y1="816.4375" y2="829.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="626.5" y1="829.4375" y2="829.4375"/><polygon fill="#181818" points="595.5,825.4375,585.5,829.4375,595.5,833.4375,591.5,829.4375" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="591.5" y="811.3716">Create request for consented accounts</text><polygon fill="#181818" points="1167,854.5703,1177,858.5703,1167,862.5703,1171,858.5703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="584.5" x2="1173" y1="858.5703" y2="858.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="591.5" y="853.5044">Request data for consented accounts</text><line style="stroke:#181818;stroke-width:1.0;" x1="1179" x2="1221" y1="887.7031" y2="887.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1221" x2="1221" y1="887.7031" y2="900.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1180" x2="1221" y1="900.7031" y2="900.7031"/><polygon fill="#181818" points="1190,896.7031,1180,900.7031,1190,904.7031,1186,900.7031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="1186" y="882.6372">Retrieve data for consented accounts</text><line style="stroke:#181818;stroke-width:1.0;" x1="1179" x2="1221" y1="929.8359" y2="929.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="1221" x2="1221" y1="929.8359" y2="942.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="1180" x2="1221" y1="942.8359" y2="942.8359"/><polygon fill="#181818" points="1190,938.8359,1180,942.8359,1190,946.8359,1186,942.8359" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="1186" y="924.77">Apply permissions to requested data</text><polygon fill="#181818" points="595.5,967.9688,585.5,971.9688,595.5,975.9688,591.5,971.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="589.5" x2="1178" y1="971.9688" y2="971.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="601.5" y="966.9028">Return data for consented accounts</text><polygon fill="#181818" points="342.5,997.1016,332.5,1001.1016,342.5,1005.1016,338.5,1001.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="336.5" x2="583.5" y1="1001.1016" y2="1001.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="348.5" y="996.0356">Return response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="285" x2="1437" y1="1010.1016" y2="1010.1016"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="376" x="290" y="1020.312">[Filtering is performed at Backend Integration Application]</text><polygon fill="#181818" points="572.5,1056.1719,582.5,1060.1719,572.5,1064.1719,576.5,1060.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="578.5" y1="1060.1719" y2="1060.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="338.5" y="1039.9731">Forward request with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="338.5" y="1055.106">consented accounts/permissions</text><line style="stroke:#181818;stroke-width:1.0;" x1="584.5" x2="626.5" y1="1089.3047" y2="1089.3047"/><line style="stroke:#181818;stroke-width:1.0;" x1="626.5" x2="626.5" y1="1089.3047" y2="1102.3047"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="626.5" y1="1102.3047" y2="1102.3047"/><polygon fill="#181818" points="595.5,1098.3047,585.5,1102.3047,595.5,1106.3047,591.5,1102.3047" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="591.5" y="1084.2388">Create request for consented accounts</text><polygon fill="#181818" points="1167,1127.4375,1177,1131.4375,1167,1135.4375,1171,1131.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="584.5" x2="1173" y1="1131.4375" y2="1131.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="591.5" y="1126.3716">Request data for consented accounts</text><line style="stroke:#181818;stroke-width:1.0;" x1="1179" x2="1221" y1="1160.5703" y2="1160.5703"/><line style="stroke:#181818;stroke-width:1.0;" x1="1221" x2="1221" y1="1160.5703" y2="1173.5703"/><line style="stroke:#181818;stroke-width:1.0;" x1="1180" x2="1221" y1="1173.5703" y2="1173.5703"/><polygon fill="#181818" points="1190,1169.5703,1180,1173.5703,1190,1177.5703,1186,1173.5703" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="1186" y="1155.5044">Retrieve data for consented accounts</text><polygon fill="#181818" points="595.5,1198.7031,585.5,1202.7031,595.5,1206.7031,591.5,1202.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="589.5" x2="1178" y1="1202.7031" y2="1202.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="601.5" y="1197.6372">Return data for consented accounts</text><line style="stroke:#181818;stroke-width:1.0;" x1="584.5" x2="626.5" y1="1231.8359" y2="1231.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="626.5" x2="626.5" y1="1231.8359" y2="1244.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="585.5" x2="626.5" y1="1244.8359" y2="1244.8359"/><polygon fill="#181818" points="595.5,1240.8359,585.5,1244.8359,595.5,1248.8359,591.5,1244.8359" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="591.5" y="1226.77">Apply correct permissions to response data</text><polygon fill="#181818" points="342.5,1269.9688,332.5,1273.9688,342.5,1277.9688,338.5,1273.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="336.5" x2="583.5" y1="1273.9688" y2="1273.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="348.5" y="1268.9028">Return response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="275" x2="1447" y1="1289.9688" y2="1289.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="253" x="280" y="1300.1792">[Filtering is performed on API Gateway]</text><path d="M336,1308.7734 L336,1458.7734 L749,1458.7734 L749,1318.7734 L739,1308.7734 L336,1308.7734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M739,1308.7734 L739,1318.7734 L749,1318.7734 L739,1308.7734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="342" y="1325.8403">The assumption here is that the API Gateway will</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="342" y="1340.9731">connect to the Core Banking Applications</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="342" y="1356.106">directly.</text><line style="stroke:#000000;stroke-width:0.5;" x1="342" x2="342" y1="1361.1719" y2="1361.1719"/><line style="stroke:#000000;stroke-width:0.5;" x1="342" x2="342" y1="1361.1719" y2="1361.1719"/><line style="stroke:#000000;stroke-width:0.5;" x1="342" x2="342" y1="1361.1719" y2="1361.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314" x="342" y="1375.2388">Note this approach works fine where low-volumes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="342" y="1390.3716">are expected. However in scenarios where a high-volume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="342" y="1405.5044">is expected it may not be hugely efficient i.e. lots</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="342" y="1420.6372">more data is returned to the gateway, then filtered.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="392" x="342" y="1435.77">Unless the API Gateway has some means for managing state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="342" y="1450.9028">this may also make pagination difficult.</text><polygon fill="#181818" points="1167,1481.1016,1177,1485.1016,1167,1489.1016,1171,1485.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="1173" y1="1485.1016" y2="1485.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="338.5" y="1480.0356">Request target accounts</text><line style="stroke:#181818;stroke-width:1.0;" x1="1179" x2="1221" y1="1514.2344" y2="1514.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1221" x2="1221" y1="1514.2344" y2="1527.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1180" x2="1221" y1="1527.2344" y2="1527.2344"/><polygon fill="#181818" points="1190,1523.2344,1180,1527.2344,1190,1531.2344,1186,1527.2344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="1186" y="1509.1685">Retrieve data for consented accounts</text><polygon fill="#181818" points="342.5,1552.3672,332.5,1556.3672,342.5,1560.3672,338.5,1556.3672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="336.5" x2="1178" y1="1556.3672" y2="1556.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="348.5" y="1551.3013">Return response</text><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="373.5" y1="1585.5" y2="1585.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="373.5" x2="373.5" y1="1585.5" y2="1598.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="332.5" x2="373.5" y1="1598.5" y2="1598.5"/><polygon fill="#181818" points="342.5,1594.5,332.5,1598.5,342.5,1602.5,338.5,1598.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="338.5" y="1580.4341">Apply permissions</text><line style="stroke:#181818;stroke-width:1.0;" x1="331.5" x2="373.5" y1="1641.6328" y2="1641.6328"/><line style="stroke:#181818;stroke-width:1.0;" x1="373.5" x2="373.5" y1="1641.6328" y2="1654.6328"/><line style="stroke:#181818;stroke-width:1.0;" x1="332.5" x2="373.5" y1="1654.6328" y2="1654.6328"/><polygon fill="#181818" points="342.5,1650.6328,332.5,1654.6328,342.5,1658.6328,338.5,1654.6328" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="338.5" y="1636.5669">Format response for standards</text><polygon fill="#181818" points="70.5,1679.7656,60.5,1683.7656,70.5,1687.7656,66.5,1683.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="330.5" y1="1683.7656" y2="1683.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="76.5" y="1678.6997">Return response</text><!--MD5=[6474d98946c29d5b64e3f2e281beeabc]
@startuml Applying_Consent_Sequence

title \n\n

participant "Data\nRecipient" as DR

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "Backend\nIntegration\nApplication" as BIA
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
end box

box Core Banking Applications #d5a6bd
participant "Banking\nSystems" as ASPSP_API
end box

hide footbox

skinparam BoxPadding 20

note right of DR
Overview
===
Filtering responses for account/permissions at the Gateway
is pragmatic in many use cases but is ultimately not scaleable
due to load and determinism for features such as pagination.
It should therefore be implemented as close to the system of record
as possible i.e. Core Banking Applications. The order of prefer in
terms of solutions is:
|||
1. Filter at the Core Banking Application.
2. Filter at a microservice capable of "stateful" behaviour.
3. Filter at the Gateway.
end note

DR -> API_GATEWAY: Request Account Information Resource\nwith valid Access Token

API_GATEWAY -> IAM: Call Access Token Introspect Endpoint
API_GATEWAY <- - IAM: Return introspection information
API_GATEWAY -> API_GATEWAY: Inspect request

alt DR does not have Consent for the requested account or resource

note right of DR
In some cases the permissions are binary i.e. the
DR does or does not have permission to access
a given endpoint. In such cases the Gateway can
immediately respond without going to the backend.
end note

DR <- - API_GATEWAY: Respond with 403 (Forbidden)

else DR has Consent to access requested resource

alt Filtering is performed outside Gateway
API_GATEWAY -> API_GATEWAY: Augment request\nwith consented accounts/permissions

alt Filtering is performed at Core Banking Application

API_GATEWAY -> BIA: Forward request with\nconsented accounts/permissions
BIA -> BIA: Create request for consented accounts
BIA -> ASPSP_API: Request data for consented accounts
ASPSP_API -> ASPSP_API: Retrieve data for consented accounts
ASPSP_API -> ASPSP_API: Apply permissions to requested data
BIA <- - ASPSP_API: Return data for consented accounts
API_GATEWAY <- - BIA: Return response

else Filtering is performed at Backend Integration Application

API_GATEWAY -> BIA: Forward request with\nconsented accounts/permissions
BIA -> BIA: Create request for consented accounts
BIA -> ASPSP_API: Request data for consented accounts
ASPSP_API -> ASPSP_API: Retrieve data for consented accounts
BIA <- - ASPSP_API: Return data for consented accounts
BIA -> BIA: Apply correct permissions to response data
API_GATEWAY <- - BIA: Return response

end alt

else Filtering is performed on API Gateway

note right of API_GATEWAY
The assumption here is that the API Gateway will
connect to the Core Banking Applications 
directly.
|||
Note this approach works fine where low-volumes
are expected. However in scenarios where a high-volume
is expected it may not be hugely efficient i.e. lots
more data is returned to the gateway, then filtered.
Unless the API Gateway has some means for managing state
this may also make pagination difficult.
end note

API_GATEWAY -> ASPSP_API: Request target accounts
ASPSP_API -> ASPSP_API: Retrieve data for consented accounts
API_GATEWAY <- - ASPSP_API: Return response
API_GATEWAY -> API_GATEWAY: Apply permissions

end alt
end alt

API_GATEWAY -> API_GATEWAY: Format response for standards
DR <- - API_GATEWAY: Return response

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>