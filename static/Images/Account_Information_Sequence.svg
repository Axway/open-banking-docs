<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="6280px" preserveAspectRatio="none" style="width:1910px;height:6280px;" version="1.1" viewBox="0 0 1910 6280" width="1910px" zoomAndPan="magnify"><defs><filter height="300%" id="fkcb4mg5vwh20" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="441" x="731" y="28.6992">Overview of invoking the Brazil Account Information API</text><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="332" x="785.5" y="49.793">with the Axway Open Banking Accelerator</text><text fill="#000000" font-family="Roboto" font-size="18" lengthAdjust="spacing" textLength="0" x="953.5" y="70.8867"/><rect fill="#E06666" height="6184.6484" style="stroke:#A80036;stroke-width:1.0;" width="289.5" x="635.5" y="83.2813"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="723.75" y="95.3418">Open Banking APIs</text><rect fill="#94C47D" height="6184.6484" style="stroke:#A80036;stroke-width:1.0;" width="314" x="947" y="83.2813"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="1023" y="95.3418">Identity and Access Control</text><rect fill="#D5A6BD" height="6184.6484" style="stroke:#A80036;stroke-width:1.0;" width="315.5" x="1358.5" y="83.2813"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="1439.25" y="95.3418">Core Banking Applications</text><rect fill="#DDDDDD" height="6184.6484" style="stroke:#A80036;stroke-width:1.0;" width="196" x="1696" y="83.2813"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135" x="1726.5" y="95.3418">Open Banking Directory</text><rect fill="#FFFFFF" filter="url(#fkcb4mg5vwh20)" height="415.6406" style="stroke:#000000;stroke-width:2.0;" width="1620.5" x="183.5" y="940.2344"/><rect fill="#FFFFFF" height="359.1719" style="stroke:none;stroke-width:1.0;" width="1620.5" x="183.5" y="996.7031"/><rect fill="#FFFFFF" filter="url(#fkcb4mg5vwh20)" height="529.8047" style="stroke:#000000;stroke-width:2.0;" width="878.5" x="183.5" y="2272.1719"/><rect fill="#FFFFFF" height="300.9297" style="stroke:none;stroke-width:1.0;" width="878.5" x="183.5" y="2501.0469"/><rect fill="#FFFFFF" filter="url(#fkcb4mg5vwh20)" height="187.6406" style="stroke:#000000;stroke-width:2.0;" width="1505.5" x="10" y="3521.3672"/><rect fill="#FFFFFF" filter="url(#fkcb4mg5vwh20)" height="136.1719" style="stroke:#000000;stroke-width:2.0;" width="534" x="1146" y="3723.0078"/><rect fill="#FFFFFF" height="60.4688" style="stroke:none;stroke-width:1.0;" width="534" x="1146" y="3798.7109"/><rect fill="#FFFFFF" filter="url(#fkcb4mg5vwh20)" height="145.0625" style="stroke:#000000;stroke-width:2.0;" width="484" x="1146" y="4422.3359"/><rect fill="#FFFFFF" height="54.125" style="stroke:none;stroke-width:1.0;" width="484" x="1146" y="4513.2734"/><rect fill="#FFFFFF" filter="url(#fkcb4mg5vwh20)" height="420.5156" style="stroke:#000000;stroke-width:2.0;" width="1496.5" x="183.5" y="5836.4141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="53" x2="53" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="237.5" x2="237.5" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="676.5" x2="676.5" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="890" x2="890" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1001" x2="1001" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1206" x2="1206" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1397.5" x2="1397.5" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1634" x2="1634" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1747" x2="1747" y1="170.7344" y2="6273.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1846" x2="1846" y1="170.7344" y2="6273.9297"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="61" x="20" y="167.3164">Customer</text><ellipse cx="53.5" cy="97.3281" fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M53.5,105.3281 L53.5,132.3281 M40.5,113.3281 L66.5,113.3281 M53.5,132.3281 L40.5,147.3281 M53.5,132.3281 L66.5,147.3281 " fill="none" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="84" x="193.5" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="70" x="200.5" y="138.9102">Third-Party</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="25" x="223" y="155.3164">App</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="70" x="639.5" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="663.5" y="138.9102">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="56" x="646.5" y="155.3164">Gateway</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="57" x="860" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="22" x="877.5" y="138.9102">API</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="43" x="867" y="155.3164">Builder</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="951" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="976" y="138.9102">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="958" y="155.3164">Management</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="97" x="1156" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="1178.5" y="138.9102">Consent</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="83" x="1163" y="155.3164">Management</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="63.2188" style="stroke:#A80036;stroke-width:1.5;" width="66" x="1362.5" y="102.5156"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1370" y="122.5039">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="47" x="1372" y="138.9102">Identity</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="52" x="1369.5" y="155.3164">Provider</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1599" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="51" x="1607" y="138.9102">Banking</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="53" x="1606" y="155.3164">Systems</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="90" x="1700" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="76" x="1707" y="138.9102">Participants</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="23" x="1733.5" y="155.3164">List</text><rect fill="#FEFECE" filter="url(#fkcb4mg5vwh20)" height="46.8125" style="stroke:#A80036;stroke-width:1.5;" width="80" x="1804" y="118.9219"/><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="66" x="1811" y="138.9102">JSON Web</text><text fill="#000000" font-family="Roboto" font-size="14" lengthAdjust="spacing" textLength="46" x="1821" y="155.3164">Key Set</text><path d="M58,185.7344 L58,279.7344 L381,279.7344 L381,195.7344 L371,185.7344 L58,185.7344 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M371,185.7344 L371,195.7344 L381,195.7344 L371,185.7344 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="52" x="64" y="202.7949">Overview</text><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="380" y1="205.9688" y2="205.9688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="380" y1="207.9688" y2="207.9688"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="302" x="64" y="222.0293">This diagram shows the end-to-end flow for obtaining</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="291" x="64" y="237.2637">Consent and starting to collect Account Information</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="273" x="64" y="252.498">data. The goal is place the components from the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="185" x="64" y="267.7324">Architecture Overview in context.</text><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1903" x="0" y="309.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="309.5234" y2="309.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="312.5234" y2="312.5234"/><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="240" x="831.5" y="298.9063"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="223" x="837.5" y="314.9668">Part 1: TPP Obtains Customer Consent</text><path d="M58,337.1406 L58,488.1406 L355,488.1406 L355,347.1406 L345,337.1406 L58,337.1406 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M345,337.1406 L345,347.1406 L355,347.1406 L345,337.1406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="226" x="64" y="354.2012">Obtaining Consent from the Customer is</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="214" x="64" y="369.4355">usually outside the scope of technical</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="271" x="64" y="384.6699">standards. The Customer Experience Guidelines</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="276" x="64" y="399.9043">in Brazil inform how Consent should be displayed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="76" x="64" y="415.1387">and obtained.</text><line style="stroke:#000000;stroke-width:1.0;" x1="64" x2="64" y1="420.3125" y2="420.3125"/><line style="stroke:#000000;stroke-width:1.0;" x1="64" x2="64" y1="420.3125" y2="420.3125"/><line style="stroke:#000000;stroke-width:1.0;" x1="64" x2="64" y1="420.3125" y2="420.3125"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="242" x="64" y="434.373">The specifics of this process are therefore</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="265" x="64" y="449.6074">not shown here. The Third-Party Provider (TPP)</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="245" x="64" y="464.8418">is assumed to have completed this with the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="117" x="64" y="480.0762">guidelines specified.</text><polygon fill="#A80036" points="225.5,514.4844,235.5,518.4844,225.5,522.4844,229.5,518.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="231.5" y1="518.4844" y2="518.4844"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="153" x="60.5" y="513.3105">Indicate wish to share data</text><polygon fill="#A80036" points="64.5,574.1875,54.5,578.1875,64.5,582.1875,60.5,578.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="236.5" y1="578.1875" y2="578.1875"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="86" x="70.5" y="542.5449">Display "Intent"</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="70.5" y="557.7793">i.e. data to be accessed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="129" x="70.5" y="573.0137">or payment to be made</text><polygon fill="#A80036" points="225.5,603.4219,235.5,607.4219,225.5,611.4219,229.5,607.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="231.5" y1="607.4219" y2="607.4219"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="80" x="60.5" y="602.248">Confirm intent</text><polygon fill="#A80036" points="64.5,632.6563,54.5,636.6563,64.5,640.6563,60.5,636.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="236.5" y1="636.6563" y2="636.6563"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="160" x="70.5" y="631.4824">Show bank selection screen</text><polygon fill="#A80036" points="225.5,661.8906,235.5,665.8906,225.5,669.8906,229.5,665.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="231.5" y1="665.8906" y2="665.8906"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="60.5" y="660.7168">Confirm bank selection</text><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1903" x="0" y="694.5078"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="694.5078" y2="694.5078"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="697.5078" y2="697.5078"/><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="244" x="829.5" y="683.8906"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="227" x="835.5" y="699.9512">Part 2: TPP Creates and Lodges "Intent"</text><path d="M242,722.125 L242,812.125 L519,812.125 L519,732.125 L509,722.125 L242,722.125 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M509,722.125 L509,732.125 L519,732.125 L509,722.125 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="245" x="248" y="739.1855">With the consent of the Consumer obtained</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="248" x="248" y="754.4199">the TPP can now call the Consent API at the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="74" x="248" y="769.6543">correct bank.</text><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="774.8281" y2="774.8281"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="774.8281" y2="774.8281"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="774.8281" y2="774.8281"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="236" x="248" y="788.8887">Note at this point Consent is usual termed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="256" x="248" y="804.123">"Intent" as it has yet to confirmed at the bank.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="842.5313" y2="842.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="842.5313" y2="855.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="855.5313" y2="855.5313"/><polygon fill="#A80036" points="248.5,851.5313,238.5,855.5313,248.5,859.5313,244.5,855.5313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="120" x="244.5" y="837.3574">Create Intent payload</text><path d="M242,868.5313 L242,923.5313 L597,923.5313 L597,878.5313 L587,868.5313 L242,868.5313 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M587,868.5313 L587,878.5313 L597,878.5313 L587,868.5313 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="285" x="248" y="885.5918">Given the adherence to OpenID Connect Discovery</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="256" x="248" y="900.8262">in the standards TPPs are expected to collect</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="334" x="248" y="916.0605">OpenID Configuration information from participating banks.</text><path d="M183.5,940.2344 L242.5,940.2344 L242.5,947.2344 L232.5,957.2344 L183.5,957.2344 L183.5,940.2344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="415.6406" style="stroke:#000000;stroke-width:2.0;" width="1620.5" x="183.5" y="940.2344"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="198.5" y="953.2949">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="240" x="257.5" y="952.4395">[TPP has cached OpenID Configuration for bank]</text><path d="M242,962.4688 L242,987.4688 L324,987.4688 L324,972.4688 L314,962.4688 L242,962.4688 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M314,962.4688 L314,972.4688 L324,972.4688 L314,962.4688 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="61" x="248" y="979.5293">Do nothing</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="183.5" x2="1804" y1="997.7031" y2="997.7031"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="228" x="188.5" y="1007.9082">[TPP retrieves OpenID Configuration for bank]</text><polygon fill="#A80036" points="1735,1028.8281,1745,1032.8281,1735,1036.8281,1739,1032.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="1741" y1="1032.8281" y2="1032.8281"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="130" x="244.5" y="1027.6543">Get List of Participants</text><polygon fill="#A80036" points="248.5,1058.0625,238.5,1062.0625,248.5,1066.0625,244.5,1062.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="1746" y1="1062.0625" y2="1062.0625"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="254.5" y="1056.8887">Response</text><path d="M242,1075.0625 L242,1130.0625 L570,1130.0625 L570,1085.0625 L560,1075.0625 L242,1075.0625 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M560,1075.0625 L560,1085.0625 L570,1085.0625 L560,1075.0625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="250" x="248" y="1092.123">The discovery endpoint value is stored in the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="248" y="1107.4653">OpenIDDiscoveryDocument</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="120" x="435" y="1107.3574">property of the banks</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="82" x="248" y="1122.5918">entry in the list</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="1161" y2="1161"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="1161" y2="1174"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="1174" y2="1174"/><polygon fill="#A80036" points="248.5,1170,238.5,1174,248.5,1178,244.5,1174" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="217" x="244.5" y="1155.8262">Get Discovery endpoint for target bank</text><path d="M242,1187 L242,1288 L664,1288 L664,1197 L654,1187 L242,1187 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,1187 L654,1197 L664,1197 L654,1187 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="362" x="248" y="1204.0605">This sequence diagram shows the OpenID Configuration hosted</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="360" x="248" y="1219.2949">at the API Gateway. The mechanics of implemementing this are</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="369" x="248" y="1234.5293">not prescribed by the Axway Open Banking solution as essentially</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="334" x="248" y="1249.7637">the information is essentially a static document that can be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="401" x="248" y="1264.998">managed through a CMS. Customers should make their own judgement</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="261" x="248" y="1280.2324">as to the best approach to managing this data.</text><polygon fill="#A80036" points="664.5,1314.6406,674.5,1318.6406,664.5,1322.6406,668.5,1318.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="670.5" y1="1318.6406" y2="1318.6406"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="171" x="244.5" y="1313.4668">Retrieve OpenID Configuration</text><polygon fill="#A80036" points="248.5,1343.875,238.5,1347.875,248.5,1351.875,244.5,1347.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="675.5" y1="1347.875" y2="1347.875"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="254.5" y="1342.7012">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="1414.5781" y2="1414.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="1414.5781" y2="1427.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="1427.5781" y2="1427.5781"/><polygon fill="#A80036" points="248.5,1423.5781,238.5,1427.5781,248.5,1431.5781,244.5,1427.5781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="133" x="244.5" y="1378.9355">Lookup Token endpoint</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="152" x="244.5" y="1394.1699">from OpenID Configuration</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="0" x="247.5" y="1409.4043"/><path d="M242,1440.5781 L242,1530.5781 L526,1530.5781 L526,1450.5781 L516,1440.5781 L242,1440.5781 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M516,1440.5781 L516,1450.5781 L526,1450.5781 L516,1440.5781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="263" x="248" y="1457.6387">The TPP then uses the Client Credentials grant</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="244" x="248" y="1472.873">to obtain an Access token to then lodge the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="203" x="248" y="1488.1074">Consent on behalf of the Consumer.</text><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="1493.2813" y2="1493.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="1493.2813" y2="1493.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="1493.2813" y2="1493.2813"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="258" x="248" y="1507.3418">These request will be made using Mutual TLS</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="228" x="248" y="1522.5762">with a certificate signed by the directory.</text><polygon fill="#A80036" points="664.5,1556.8828,674.5,1560.8828,664.5,1564.8828,668.5,1560.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="670.5" y1="1560.8828" y2="1560.8828"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="244.5" y="1555.8169">POST /token</text><polygon fill="#A80036" points="989.5,1586.1172,999.5,1590.1172,989.5,1594.1172,993.5,1590.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="995.5" y1="1590.1172" y2="1590.1172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="128" x="683.5" y="1584.9434">Access Token request</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1043.5" y1="1619.3516" y2="1619.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1043.5" x2="1043.5" y1="1619.3516" y2="1632.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1002.5" x2="1043.5" y1="1632.3516" y2="1632.3516"/><polygon fill="#A80036" points="1012.5,1628.3516,1002.5,1632.3516,1012.5,1636.3516,1008.5,1632.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="68" x="1008.5" y="1614.1777">Verify Client</text><polygon fill="#A80036" points="687.5,1657.5859,677.5,1661.5859,687.5,1665.5859,683.5,1661.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="681.5" x2="1000.5" y1="1661.5859" y2="1661.5859"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="117" x="693.5" y="1656.4121">Issue Access Token</text><polygon fill="#A80036" points="248.5,1701.8516,238.5,1705.8516,248.5,1709.8516,244.5,1705.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="675.5" y1="1705.8516" y2="1705.8516"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="254.5" y="1685.6528">200 OK</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="254.5" y="1700.7856">{"access_token": "..."}</text><polygon fill="#A80036" points="664.5,1730.9844,674.5,1734.9844,664.5,1738.9844,668.5,1734.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="670.5" y1="1734.9844" y2="1734.9844"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="244.5" y="1729.9185">POST /consents</text><polygon fill="#A80036" points="1194.5,1760.2188,1204.5,1764.2188,1194.5,1768.2188,1198.5,1764.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="1200.5" y1="1764.2188" y2="1764.2188"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="85" x="683.5" y="1759.0449">Lodge Consent</text><polygon fill="#A80036" points="687.5,1789.4531,677.5,1793.4531,687.5,1797.4531,683.5,1793.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="1205.5" y1="1793.4531" y2="1793.4531"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="103" x="693.5" y="1788.2793">Return Consent ID</text><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="718.5" y1="1822.6875" y2="1822.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="718.5" x2="718.5" y1="1822.6875" y2="1835.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="677.5" x2="718.5" y1="1835.6875" y2="1835.6875"/><polygon fill="#A80036" points="687.5,1831.6875,677.5,1835.6875,687.5,1839.6875,683.5,1835.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="683.5" y="1817.5137">Format response</text><polygon fill="#A80036" points="248.5,1875.9531,238.5,1879.9531,248.5,1883.9531,244.5,1879.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="675.5" y1="1879.9531" y2="1879.9531"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="254.5" y="1859.7544">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="254.5" y="1874.8872">{"consentId": "..."}</text><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1903" x="0" y="1908.5703"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="1908.5703" y2="1908.5703"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="1911.5703" y2="1911.5703"/><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="329" x="787" y="1897.9531"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="312" x="793" y="1914.0137">Part 3: Customer is Redirected to Authorization Server</text><path d="M242,1936.1875 L242,2213.1875 L768,2213.1875 L768,1946.1875 L758,1936.1875 L242,1936.1875 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M758,1936.1875 L758,1946.1875 L768,1946.1875 L758,1936.1875 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="34" x="248" y="1953.248">Notes</text><line style="stroke:#A80036;stroke-width:1.0;" x1="243" x2="767" y1="1956.4219" y2="1956.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="243" x2="767" y1="1958.4219" y2="1958.4219"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="263" x="248" y="1972.4824">This flow shows a web journey as it's not clear</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="280" x="248" y="1987.7168">that "App-to-App" will be supported in the Brazilian</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="43" x="248" y="2002.9512">market.</text><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2008.125" y2="2008.125"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2008.125" y2="2008.125"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2008.125" y2="2008.125"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="168" x="248" y="2022.1855">FAPI mandates the use of the</text><a href="https://openid.net/specs/openid-financial-api-part-2-ID2.html#authorization-server" target="_top" title="https://openid.net/specs/openid-financial-api-part-2-ID2.html#authorization-server" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-financial-api-part-2-ID2.html#authorization-server" xlink:show="new" xlink:title="https://openid.net/specs/openid-financial-api-part-2-ID2.html#authorization-server" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="146" x="419" y="2022.1855">Request object parameter</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="248" y="2037.4199">which is defined in</text><a href="https://openid.net/specs/openid-connect-core-1_0.html#JWTRequests" target="_top" title="https://openid.net/specs/openid-connect-core-1_0.html#JWTRequests" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-connect-core-1_0.html#JWTRequests" xlink:show="new" xlink:title="https://openid.net/specs/openid-connect-core-1_0.html#JWTRequests" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="53" x="357" y="2037.4199">Section 6</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="140" x="413" y="2037.4199">of OpenID Connect Core.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="351" x="248" y="2052.6543">This is a signed JSON Web Token where the payload contains</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="387" x="248" y="2067.8887">parameters normally found in the URL (redirect_uri, state, nonce, etc)</text><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2073.0625" y2="2073.0625"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2073.0625" y2="2073.0625"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2073.0625" y2="2073.0625"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="230" x="248" y="2087.123">However, FAPI has been extended by the</text><a href="https://openbanking-brasil.github.io/specs-seguranca/open-banking-brasil-financial-api-1_ID1.html" target="_top" title="https://openbanking-brasil.github.io/specs-seguranca/open-banking-brasil-financial-api-1_ID1.html" xlink:actuate="onRequest" xlink:href="https://openbanking-brasil.github.io/specs-seguranca/open-banking-brasil-financial-api-1_ID1.html" xlink:show="new" xlink:title="https://openbanking-brasil.github.io/specs-seguranca/open-banking-brasil-financial-api-1_ID1.html" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="162" x="481" y="2087.123">API Security Profile for Brazil</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="401" x="248" y="2102.3574">where 2 alternatives are added to the Authorization Server (AS) in terms</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="172" x="248" y="2117.5918">of Request parameter support:</text><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2122.7656" y2="2122.7656"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2122.7656" y2="2122.7656"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2122.7656" y2="2122.7656"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="297" x="248" y="2136.8262">1. Request parameter passed in the URI that must be</text><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="123" x="548" y="2136.8262">signed and encrypted</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="671" y="2136.8262">.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="286" x="248" y="2152.0605">2. Request parameter passed by reference through</text><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-par" target="_top" title="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-par" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-par" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-par" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="213" x="537" y="2152.0605">Pushed Authorization Requests (PAR)</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="750" y="2152.0605">.</text><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2157.2344" y2="2157.2344"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2157.2344" y2="2157.2344"/><line style="stroke:#000000;stroke-width:1.0;" x1="248" x2="248" y1="2157.2344" y2="2157.2344"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="254" x="248" y="2171.2949">What the AS supports is part of the discovery</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="422" x="248" y="2186.5293">information that banks are obliged to provide under the API Security Profile.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="278" x="248" y="2201.7637">Both options are shown in the sequence diagram.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="2244.1719" y2="2244.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="2244.1719" y2="2257.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="2257.1719" y2="2257.1719"/><polygon fill="#A80036" points="248.5,2253.1719,238.5,2257.1719,248.5,2261.1719,244.5,2257.1719" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="148" x="244.5" y="2238.998">Create Request parameter</text><path d="M183.5,2272.1719 L242.5,2272.1719 L242.5,2279.1719 L232.5,2289.1719 L183.5,2289.1719 L183.5,2272.1719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="529.8047" style="stroke:#000000;stroke-width:2.0;" width="878.5" x="183.5" y="2272.1719"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="198.5" y="2285.2324">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="250" x="257.5" y="2284.377">[AS supports Request parameter passed by value]</text><path d="M242,2294.4063 L242,2364.4063 L617,2364.4063 L617,2304.4063 L607,2294.4063 L242,2294.4063 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M607,2294.4063 L607,2304.4063 L617,2304.4063 L607,2294.4063 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="309" x="248" y="2311.4668">The Signing and Encryption keys will be the private part</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="354" x="248" y="2326.7012">of the pair signed by the Directory that can be referenced in the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="295" x="248" y="2341.9355">JSON Web Key Set maintained therein i.e. the key ID</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="243" x="248" y="2357.1699">matches one of the TPPs JSON Web Keys.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="2395.5781" y2="2395.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="2395.5781" y2="2408.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="2408.5781" y2="2408.5781"/><polygon fill="#A80036" points="248.5,2404.5781,238.5,2408.5781,248.5,2412.5781,244.5,2408.5781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="232" x="244.5" y="2390.4043">Sign Request parameter with Signing Key</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="2437.8125" y2="2437.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="2437.8125" y2="2450.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="2450.8125" y2="2450.8125"/><polygon fill="#A80036" points="248.5,2446.8125,238.5,2450.8125,248.5,2454.8125,244.5,2450.8125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="266" x="244.5" y="2432.6387">Encrypt Request parameter with Encryption Key</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="2480.0469" y2="2480.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="2480.0469" y2="2493.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="2493.0469" y2="2493.0469"/><polygon fill="#A80036" points="248.5,2489.0469,238.5,2493.0469,248.5,2497.0469,244.5,2493.0469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="274" x="244.5" y="2474.873">Create redirect URL including Request parameter</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="183.5" x2="1062" y1="2502.0469" y2="2502.0469"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="188.5" y="2512.252">[AS supports PAR]</text><path d="M242,2520.9375 L242,2575.9375 L550,2575.9375 L550,2530.9375 L540,2520.9375 L242,2520.9375 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M540,2520.9375 L540,2530.9375 L550,2530.9375 L540,2520.9375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="267" x="248" y="2537.998">To create an Authorization request through PAR</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="45" x="248" y="2553.2324">the TPP</text><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="296" y="2553.2324">must</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="207" x="328" y="2553.2324">authenticate using the same method</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="191" x="248" y="2568.4668">as they use at the Token endpoint</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="2606.875" y2="2606.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="2606.875" y2="2619.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="2619.875" y2="2619.875"/><polygon fill="#A80036" points="248.5,2615.875,238.5,2619.875,248.5,2623.875,244.5,2619.875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="213" x="244.5" y="2601.7012">Encode Request parameter in payload</text><polygon fill="#A80036" points="664.5,2645.0078,674.5,2649.0078,664.5,2653.0078,668.5,2649.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="670.5" y1="2649.0078" y2="2649.0078"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="244.5" y="2643.9419">POST /par</text><polygon fill="#A80036" points="989.5,2674.2422,999.5,2678.2422,989.5,2682.2422,993.5,2678.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="995.5" y1="2678.2422" y2="2678.2422"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="120" x="683.5" y="2673.0684">Authorization request</text><polygon fill="#A80036" points="687.5,2703.4766,677.5,2707.4766,687.5,2711.4766,683.5,2707.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="1000.5" y1="2707.4766" y2="2707.4766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="693.5" y="2702.3027">Response</text><polygon fill="#A80036" points="248.5,2747.7422,238.5,2751.7422,248.5,2755.7422,244.5,2751.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="675.5" y1="2751.7422" y2="2751.7422"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="254.5" y="2731.5435">201 Created</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="254.5" y="2746.6763">{"request_uri": "..."}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="2780.9766" y2="2780.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="2780.9766" y2="2793.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="2793.9766" y2="2793.9766"/><polygon fill="#A80036" points="248.5,2789.9766,238.5,2793.9766,248.5,2797.9766,244.5,2793.9766" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="163" x="244.5" y="2775.8027">Create redirect URL including</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="410.5" y="2775.9106">request_uri</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="30" x="501.5" y="2775.8027">value</text><polygon fill="#A80036" points="64.5,2826.2109,54.5,2830.2109,64.5,2834.2109,60.5,2830.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="236.5" y1="2830.2109" y2="2830.2109"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="104" x="70.5" y="2825.0371">Redirect customer</text><polygon fill="#A80036" points="664.5,2855.4453,674.5,2859.4453,664.5,2863.4453,668.5,2859.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="670.5" y1="2859.4453" y2="2859.4453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="83" x="60.5" y="2854.2715">Follow redirect</text><path d="M681,2872.4453 L681,2946.4453 L1011,2946.4453 L1011,2882.4453 L1001,2872.4453 L681,2872.4453 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1001,2872.4453 L1001,2882.4453 L1011,2882.4453 L1001,2872.4453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="250" x="687" y="2889.5059">This is indicative as a bank is likely to cache</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="208" x="687" y="2904.7402">the Directory JWKS for a period time.</text><line style="stroke:#000000;stroke-width:1.0;" x1="687" x2="687" y1="2909.9141" y2="2909.9141"/><line style="stroke:#000000;stroke-width:1.0;" x1="687" x2="687" y1="2909.9141" y2="2909.9141"/><line style="stroke:#000000;stroke-width:1.0;" x1="687" x2="687" y1="2909.9141" y2="2909.9141"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="309" x="687" y="2923.9746">It is not specified whether access to the JWKS is open</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="182" x="687" y="2939.209">through MTLS or Access Token.</text><polygon fill="#A80036" points="1834,2973.6172,1844,2977.6172,1834,2981.6172,1838,2977.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="1840" y1="2977.6172" y2="2977.6172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="131" x="683.5" y="2972.4434">Get JSON Web Key Set</text><polygon fill="#A80036" points="687.5,3002.8516,677.5,3006.8516,687.5,3010.8516,683.5,3006.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="1845" y1="3006.8516" y2="3006.8516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="693.5" y="3001.6777">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="718.5" y1="3036.0859" y2="3036.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="718.5" x2="718.5" y1="3036.0859" y2="3049.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="677.5" x2="718.5" y1="3049.0859" y2="3049.0859"/><polygon fill="#A80036" points="687.5,3045.0859,677.5,3049.0859,687.5,3053.0859,683.5,3049.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="147" x="683.5" y="3030.9121">Match Request parameter</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="833.5" y="3031.02">kid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="718.5" y1="3078.3203" y2="3078.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="718.5" x2="718.5" y1="3078.3203" y2="3091.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="677.5" x2="718.5" y1="3091.3203" y2="3091.3203"/><polygon fill="#A80036" points="687.5,3087.3203,677.5,3091.3203,687.5,3095.3203,683.5,3091.3203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="200" x="683.5" y="3073.1465">Verify Request parameter signature</text><polygon fill="#A80036" points="989.5,3116.5547,999.5,3120.5547,989.5,3124.5547,993.5,3120.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="995.5" y1="3120.5547" y2="3120.5547"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="157" x="683.5" y="3115.3809">Forward Request parameter</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1043.5" y1="3149.7891" y2="3149.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1043.5" x2="1043.5" y1="3149.7891" y2="3162.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1002.5" x2="1043.5" y1="3162.7891" y2="3162.7891"/><polygon fill="#A80036" points="1012.5,3158.7891,1002.5,3162.7891,1012.5,3166.7891,1008.5,3162.7891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="144" x="1008.5" y="3144.6152">Verify Request parameter</text><polygon fill="#A80036" points="1194.5,3188.0234,1204.5,3192.0234,1194.5,3196.0234,1198.5,3192.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1200.5" y1="3192.0234" y2="3192.0234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="129" x="1008.5" y="3186.8496">Request Consent by ID</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1206.5" x2="1248.5" y1="3221.2578" y2="3221.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1248.5" x2="1248.5" y1="3221.2578" y2="3234.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1207.5" x2="1248.5" y1="3234.2578" y2="3234.2578"/><polygon fill="#A80036" points="1217.5,3230.2578,1207.5,3234.2578,1217.5,3238.2578,1213.5,3234.2578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="96" x="1213.5" y="3216.084">Retrieve Consent</text><polygon fill="#A80036" points="1012.5,3259.4922,1002.5,3263.4922,1012.5,3267.4922,1008.5,3263.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1006.5" x2="1205.5" y1="3263.4922" y2="3263.4922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1018.5" y="3258.3184">Response</text><polygon fill="#A80036" points="687.5,3288.7266,677.5,3292.7266,687.5,3296.7266,683.5,3292.7266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="681.5" x2="1000.5" y1="3292.7266" y2="3292.7266"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="109" x="693.5" y="3287.5527">Return redirect URL</text><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1903" x="0" y="3321.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="3321.3438" y2="3321.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="3324.3438" y2="3324.3438"/><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="339" x="782" y="3310.7266"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="322" x="788" y="3326.7871">Part 4: Customer Authenticates and Authorizes Consent</text><path d="M58,3348.9609 L58,3403.9609 L439,3403.9609 L439,3358.9609 L429,3348.9609 L58,3348.9609 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M429,3348.9609 L429,3358.9609 L439,3358.9609 L429,3348.9609 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="360" x="64" y="3366.0215">The following steps can vary according the bank's requirements</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="335" x="64" y="3381.2559">for authentication and authorization but these steps provide</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="266" x="64" y="3396.4902">an accurate overview in the context of the OBA.</text><polygon fill="#A80036" points="64.5,3430.8984,54.5,3434.8984,64.5,3438.8984,60.5,3434.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="675.5" y1="3434.8984" y2="3434.8984"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="105" x="70.5" y="3429.7246">Redirect Customer</text><polygon fill="#A80036" points="1385.5,3460.1328,1395.5,3464.1328,1385.5,3468.1328,1389.5,3464.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="1391.5" y1="3464.1328" y2="3464.1328"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="87" x="60.5" y="3458.959">Follow Redirect</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1397.5" x2="1439.5" y1="3493.3672" y2="3493.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1439.5" x2="1439.5" y1="3493.3672" y2="3506.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1398.5" x2="1439.5" y1="3506.3672" y2="3506.3672"/><polygon fill="#A80036" points="1408.5,3502.3672,1398.5,3506.3672,1408.5,3510.3672,1404.5,3506.3672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="1404.5" y="3488.1934">Verify redirect</text><path d="M10,3521.3672 L79,3521.3672 L79,3528.3672 L69,3538.3672 L10,3538.3672 L10,3521.3672 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="187.6406" style="stroke:#000000;stroke-width:2.0;" width="1505.5" x="10" y="3521.3672"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="25" y="3534.4277">loop</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="259" x="94" y="3533.5723">[Request required number of authentication factors]</text><path d="M58,3543.6016 L58,3598.6016 L385,3598.6016 L385,3553.6016 L375,3543.6016 L58,3543.6016 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M375,3543.6016 L375,3553.6016 L385,3553.6016 L375,3543.6016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="288" x="64" y="3560.6621">This loop is intended to be indicative and the actual</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="269" x="64" y="3575.8965">mechanics are entirely dependent on the bank's</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="306" x="64" y="3591.1309">implementation and their approach to user experience.</text><polygon fill="#A80036" points="64.5,3625.5391,54.5,3629.5391,64.5,3633.5391,60.5,3629.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="1396.5" y1="3629.5391" y2="3629.5391"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="160" x="70.5" y="3624.3652">Serve credentials input page</text><polygon fill="#A80036" points="1385.5,3654.7734,1395.5,3658.7734,1385.5,3662.7734,1389.5,3658.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="1391.5" y1="3658.7734" y2="3658.7734"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="106" x="60.5" y="3653.5996">Submit credentials</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1397.5" x2="1439.5" y1="3688.0078" y2="3688.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1439.5" x2="1439.5" y1="3688.0078" y2="3701.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1398.5" x2="1439.5" y1="3701.0078" y2="3701.0078"/><polygon fill="#A80036" points="1408.5,3697.0078,1398.5,3701.0078,1408.5,3705.0078,1404.5,3701.0078" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="99" x="1404.5" y="3682.834">Verify credentials</text><path d="M1146,3723.0078 L1210,3723.0078 L1210,3730.0078 L1200,3740.0078 L1146,3740.0078 L1146,3723.0078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="136.1719" style="stroke:#000000;stroke-width:2.0;" width="534" x="1146" y="3723.0078"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="1161" y="3736.0684">par</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="246" x="1225" y="3735.2129">[Retrieve data required for Consent Confirmation]</text><polygon fill="#A80036" points="1622.5,3757.4766,1632.5,3761.4766,1622.5,3765.4766,1626.5,3761.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1397.5" x2="1628.5" y1="3761.4766" y2="3761.4766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="132" x="1404.5" y="3756.3027">Request customer data</text><polygon fill="#A80036" points="1408.5,3786.7109,1398.5,3790.7109,1408.5,3794.7109,1404.5,3790.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1402.5" x2="1633.5" y1="3790.7109" y2="3790.7109"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1414.5" y="3785.5371">Response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1146" x2="1680" y1="3799.7109" y2="3799.7109"/><polygon fill="#A80036" points="1217.5,3817.9453,1207.5,3821.9453,1217.5,3825.9453,1213.5,3821.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1211.5" x2="1396.5" y1="3821.9453" y2="3821.9453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="124" x="1223.5" y="3816.7715">Get "Intent" properties</text><polygon fill="#A80036" points="1385.5,3847.1797,1395.5,3851.1797,1385.5,3855.1797,1389.5,3851.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1206.5" x2="1391.5" y1="3851.1797" y2="3851.1797"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1213.5" y="3846.0059">Response</text><path d="M1402,3871.1797 L1402,3957.1797 L1734,3957.1797 L1734,3881.1797 L1724,3871.1797 L1402,3871.1797 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1724,3871.1797 L1724,3881.1797 L1734,3881.1797 L1724,3871.1797 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="311" x="1408" y="3888.2402">When creating the Consent Confirmation screen clearly</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="289" x="1408" y="3903.4746">the permission codes held in the "Intent" need to be</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="292" x="1408" y="3918.709">coverted to something that will be meaningful to the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="1408" y="3933.9434">Customer. The wording should adhere to that detailed</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="31" x="1408" y="3949.1777">in the</text><a href="https://openbanking-brasil.github.io/areadesenvolvedor/documents/GuiaDeExperienciaDoUsuarioCompartilhamentoDeDadosEIniciacaoDePagamento.pdf" target="_top" title="https://openbanking-brasil.github.io/areadesenvolvedor/documents/GuiaDeExperienciaDoUsuarioCompartilhamentoDeDadosEIniciacaoDePagamento.pdf" xlink:actuate="onRequest" xlink:href="https://openbanking-brasil.github.io/areadesenvolvedor/documents/GuiaDeExperienciaDoUsuarioCompartilhamentoDeDadosEIniciacaoDePagamento.pdf" xlink:show="new" xlink:title="https://openbanking-brasil.github.io/areadesenvolvedor/documents/GuiaDeExperienciaDoUsuarioCompartilhamentoDeDadosEIniciacaoDePagamento.pdf" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="183" x="1442" y="3949.1777">Customer Experience Guidelines</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="3" x="1625" y="3949.1777">.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1397.5" x2="1439.5" y1="3987.5859" y2="3987.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1439.5" x2="1439.5" y1="3987.5859" y2="4000.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1398.5" x2="1439.5" y1="4000.5859" y2="4000.5859"/><polygon fill="#A80036" points="1408.5,3996.5859,1398.5,4000.5859,1408.5,4004.5859,1404.5,4000.5859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="208" x="1404.5" y="3982.4121">Render Consent Confirmation screen</text><polygon fill="#A80036" points="64.5,4025.8203,54.5,4029.8203,64.5,4033.8203,60.5,4029.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="1396.5" y1="4029.8203" y2="4029.8203"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="200" x="70.5" y="4024.6465">Serve Consent Confirmation screen</text><polygon fill="#A80036" points="1385.5,4055.0547,1395.5,4059.0547,1385.5,4063.0547,1389.5,4059.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="1391.5" y1="4059.0547" y2="4059.0547"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="150" x="60.5" y="4053.8809">Confirm consent is correct</text><path d="M1402,4072.0547 L1402,4173.0547 L1727,4173.0547 L1727,4082.0547 L1717,4072.0547 L1402,4072.0547 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1717,4072.0547 L1717,4082.0547 L1727,4082.0547 L1717,4072.0547 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="290" x="1408" y="4089.1152">Once consent has been confirmed by the Customer</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="252" x="1408" y="4104.3496">the list of in-scope accounts will be retrieved</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="279" x="1408" y="4119.584">from the Banking Systems. This list will obviously</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="301" x="1408" y="4134.8184">be dictated by the permission codes requested by the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="80" x="1408" y="4150.0527">TPP i.e. if only</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="1491" y="4150.1606">ACCOUNTS_READ</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="114" x="1598" y="4150.0527">is requested then all</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="201" x="1408" y="4165.2871">other account types can be ignored.</text><polygon fill="#A80036" points="1622.5,4199.6953,1632.5,4203.6953,1622.5,4207.6953,1626.5,4203.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1397.5" x2="1628.5" y1="4203.6953" y2="4203.6953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="213" x="1404.5" y="4198.5215">Request in-scope Customer accounts</text><polygon fill="#A80036" points="1408.5,4228.9297,1398.5,4232.9297,1408.5,4236.9297,1404.5,4232.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1402.5" x2="1633.5" y1="4232.9297" y2="4232.9297"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1414.5" y="4227.7559">Response</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1397.5" x2="1439.5" y1="4262.1641" y2="4262.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1439.5" x2="1439.5" y1="4262.1641" y2="4275.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1398.5" x2="1439.5" y1="4275.1641" y2="4275.1641"/><polygon fill="#A80036" points="1408.5,4271.1641,1398.5,4275.1641,1408.5,4279.1641,1404.5,4275.1641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="188" x="1404.5" y="4256.9902">Render Account Selection screen</text><polygon fill="#A80036" points="64.5,4300.3984,54.5,4304.3984,64.5,4308.3984,60.5,4304.3984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="1396.5" y1="4304.3984" y2="4304.3984"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="180" x="70.5" y="4299.2246">Serve Account Selection screen</text><polygon fill="#A80036" points="1385.5,4329.6328,1395.5,4333.6328,1385.5,4337.6328,1389.5,4333.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="1391.5" y1="4333.6328" y2="4333.6328"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="135" x="60.5" y="4328.459">Send Account Selection</text><polygon fill="#A80036" points="1217.5,4374.1016,1207.5,4378.1016,1217.5,4382.1016,1213.5,4378.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1211.5" x2="1396.5" y1="4378.1016" y2="4378.1016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="103" x="1223.5" y="4357.6934">Store Account IDs</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="167" x="1223.5" y="4372.9277">Customer consented to share</text><polygon fill="#A80036" points="1385.5,4403.3359,1395.5,4407.3359,1385.5,4411.3359,1389.5,4407.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1206.5" x2="1391.5" y1="4407.3359" y2="4407.3359"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1213.5" y="4402.1621">Response</text><path d="M1146,4422.3359 L1205,4422.3359 L1205,4429.3359 L1195,4439.3359 L1146,4439.3359 L1146,4422.3359 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="145.0625" style="stroke:#000000;stroke-width:2.0;" width="484" x="1146" y="4422.3359"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1161" y="4435.3965">alt</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="324" x="1220" y="4434.541">[Customer is sole signatory on account or has power of attorney]</text><polygon fill="#A80036" points="1217.5,4472.0391,1207.5,4476.0391,1217.5,4480.0391,1213.5,4476.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1211.5" x2="1396.5" y1="4476.0391" y2="4476.0391"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="104" x="1223.5" y="4455.6309">Update Consent to</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="1223.5" y="4470.9731">Authorized</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="36" x="1306.5" y="4470.8652">status</text><polygon fill="#A80036" points="1385.5,4501.2734,1395.5,4505.2734,1385.5,4509.2734,1389.5,4505.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1206.5" x2="1391.5" y1="4505.2734" y2="4505.2734"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="1213.5" y="4500.0996">Response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1146" x2="1630" y1="4514.2734" y2="4514.2734"/><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="166" x="1151" y="4524.4785">[Multiple authorizations required]</text><path d="M1211,4533.1641 L1211,4558.1641 L1616,4558.1641 L1616,4543.1641 L1606,4533.1641 L1211,4533.1641 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1606,4533.1641 L1606,4543.1641 L1616,4543.1641 L1606,4533.1641 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="384" x="1217" y="4550.2246">Multi-party authorization is covered in a separate sequence diagram.</text><path d="M58,4579.3984 L58,4665.3984 L485,4665.3984 L485,4589.3984 L475,4579.3984 L58,4579.3984 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M475,4579.3984 L475,4589.3984 L485,4589.3984 L475,4579.3984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="406" x="64" y="4596.459">The Customer is redirected back to the Axway Open Banking stack from</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="339" x="64" y="4611.6934">the bank's Identity Provider in order to complete Hybrid Flow.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="381" x="64" y="4626.9277">The hand-off is constrained using a number of parameters included</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="353" x="64" y="4642.1621">in the redirect URI to help safeguard this process i.e. to prevent</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="317" x="64" y="4657.3965">unsolicited authentication attempts or session takeover.</text><polygon fill="#A80036" points="64.5,4707.0391,54.5,4711.0391,64.5,4715.0391,60.5,4711.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="1396.5" y1="4711.0391" y2="4711.0391"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="105" x="70.5" y="4690.6309">Redirect Customer</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="118" x="70.5" y="4705.8652">back to API Gateway</text><polygon fill="#A80036" points="664.5,4736.2734,674.5,4740.2734,664.5,4744.2734,668.5,4740.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="670.5" y1="4740.2734" y2="4740.2734"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="83" x="60.5" y="4735.0996">Follow redirect</text><polygon fill="#A80036" points="989.5,4765.5078,999.5,4769.5078,989.5,4773.5078,993.5,4769.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="995.5" y1="4769.5078" y2="4769.5078"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="160" x="683.5" y="4764.334">Forward redirect parameters</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1043.5" y1="4798.7422" y2="4798.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1043.5" x2="1043.5" y1="4798.7422" y2="4811.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1002.5" x2="1043.5" y1="4811.7422" y2="4811.7422"/><polygon fill="#A80036" points="1012.5,4807.7422,1002.5,4811.7422,1012.5,4815.7422,1008.5,4811.7422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="79" x="1008.5" y="4793.5684">Verify redirect</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1043.5" y1="4856.2109" y2="4856.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1043.5" x2="1043.5" y1="4856.2109" y2="4869.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1002.5" x2="1043.5" y1="4869.2109" y2="4869.2109"/><polygon fill="#A80036" points="1012.5,4865.2109,1002.5,4869.2109,1012.5,4873.2109,1008.5,4869.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="1008.5" y="4835.8027">Mint Authorization Code</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="76" x="1008.5" y="4851.0371">and ID Token</text><path d="M1006,4882.2109 L1006,4952.2109 L1374,4952.2109 L1374,4892.2109 L1364,4882.2109 L1006,4882.2109 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1364,4882.2109 L1364,4892.2109 L1374,4892.2109 L1364,4882.2109 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="347" x="1012" y="4899.2715">At this point the Identity Management module mints a redirect</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="333" x="1012" y="4914.5059">URI that will take the Customer back to the Third-Party App.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="343" x="1012" y="4929.7402">The URI includes the Authorization Code and parameters that</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="242" x="1012" y="4944.9746">adhere to the API Security Profile for Brazil.</text><polygon fill="#A80036" points="687.5,4979.3828,677.5,4983.3828,687.5,4987.3828,683.5,4983.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="1000.5" y1="4983.3828" y2="4983.3828"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="83" x="693.5" y="4978.209">Return redirect</text><polygon fill="#A80036" points="64.5,5008.6172,54.5,5012.6172,64.5,5016.6172,60.5,5012.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="675.5" y1="5012.6172" y2="5012.6172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="105" x="70.5" y="5007.4434">Redirect Customer</text><polygon fill="#A80036" points="225.5,5037.8516,235.5,5041.8516,225.5,5045.8516,229.5,5041.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53.5" x2="231.5" y1="5041.8516" y2="5041.8516"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="87" x="60.5" y="5036.6777">Follow Redirect</text><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1903" x="0" y="5070.4688"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="5070.4688" y2="5070.4688"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="5073.4688" y2="5073.4688"/><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="343" x="780" y="5059.8516"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="326" x="786" y="5075.9121">Part 5: TPP Swaps Authorization Code for Access Token</text><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="279.5" y1="5129.5547" y2="5129.5547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="279.5" x2="279.5" y1="5129.5547" y2="5142.5547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="238.5" x2="279.5" y1="5142.5547" y2="5142.5547"/><polygon fill="#A80036" points="248.5,5138.5547,238.5,5142.5547,248.5,5146.5547,244.5,5142.5547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="133" x="244.5" y="5109.1465">Verify redirect including</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="250" x="244.5" y="5124.3809">ID Token signature, nonce and s_hash value</text><polygon fill="#A80036" points="664.5,5167.7891,674.5,5171.7891,664.5,5175.7891,668.5,5171.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="670.5" y1="5171.7891" y2="5171.7891"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="112" x="244.5" y="5166.6152">Call Token endpoint</text><polygon fill="#A80036" points="989.5,5197.0234,999.5,5201.0234,989.5,5205.0234,993.5,5201.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="995.5" y1="5201.0234" y2="5201.0234"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="203" x="683.5" y="5195.8496">Get ID, Access and Refresh Tokens</text><polygon fill="#A80036" points="687.5,5226.2578,677.5,5230.2578,687.5,5234.2578,683.5,5230.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="1000.5" y1="5230.2578" y2="5230.2578"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="693.5" y="5225.084">Response</text><polygon fill="#A80036" points="248.5,5255.4922,238.5,5259.4922,248.5,5263.4922,244.5,5259.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="675.5" y1="5259.4922" y2="5259.4922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="254.5" y="5254.3184">Response</text><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1903" x="0" y="5288.1094"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="5288.1094" y2="5288.1094"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1903" y1="5291.1094" y2="5291.1094"/><rect fill="#EEEEEE" filter="url(#fkcb4mg5vwh20)" height="23.2344" style="stroke:#000000;stroke-width:2.0;" width="223" x="840" y="5277.4922"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="206" x="846" y="5293.5527">Part 6: TPP Gets Data from Account</text><path d="M242,5315.7266 L242,5416.7266 L648,5416.7266 L648,5325.7266 L638,5315.7266 L242,5315.7266 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M638,5315.7266 L638,5325.7266 L648,5325.7266 L638,5315.7266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="252" x="248" y="5332.7871">It should be noted that due to the adoption of</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="245" x="248" y="5348.0215">the Mutual TLS profile for OAuth 2.0 in FAPI</text><a href="https://tools.ietf.org/id/draft-ietf-oauth-mtls-08.html" target="_top" title="https://tools.ietf.org/id/draft-ietf-oauth-mtls-08.html" xlink:actuate="onRequest" xlink:href="https://tools.ietf.org/id/draft-ietf-oauth-mtls-08.html" xlink:show="new" xlink:title="https://tools.ietf.org/id/draft-ietf-oauth-mtls-08.html" xlink:type="simple"><text fill="#0000FF" font-family="Roboto" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="34" x="496" y="5348.0215">(here)</text></a><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="345" x="248" y="5363.2559">many ASPSP will bind Access Tokens to the client certificate</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="329" x="248" y="5378.4902">presented when they were created. This is indicated at the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="269" x="248" y="5393.7246">well-known endpoint through by the value of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="336" x="248" y="5409.0669">tls_client_certificate_bound_access_tokens</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="46" x="587" y="5408.959">property</text><polygon fill="#A80036" points="664.5,5443.3672,674.5,5447.3672,664.5,5451.3672,668.5,5447.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="670.5" y1="5447.3672" y2="5447.3672"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="244.5" y="5442.3013">GET /resources</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="116" x="359.5" y="5442.1934">using mTLS + OAuth</text><polygon fill="#A80036" points="989.5,5472.6016,999.5,5476.6016,989.5,5480.6016,993.5,5476.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="995.5" y1="5476.6016" y2="5476.6016"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="143" x="683.5" y="5471.4277">Introspect Access Token</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1043.5" y1="5505.8359" y2="5505.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1043.5" x2="1043.5" y1="5505.8359" y2="5518.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1002.5" x2="1043.5" y1="5518.8359" y2="5518.8359"/><polygon fill="#A80036" points="1012.5,5514.8359,1002.5,5518.8359,1012.5,5522.8359,1008.5,5518.8359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="191" x="1008.5" y="5500.6621">Retrieve Access Token properties</text><polygon fill="#A80036" points="687.5,5544.0703,677.5,5548.0703,687.5,5552.0703,683.5,5548.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="1000.5" y1="5548.0703" y2="5548.0703"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="693.5" y="5542.8965">Response</text><path d="M681,5561.0703 L681,5631.0703 L983,5631.0703 L983,5571.0703 L973,5561.0703 L681,5561.0703 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M973,5561.0703 L973,5571.0703 L983,5571.0703 L973,5561.0703 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="687" y="5578.1309">The TPP will require the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="824" y="5578.2388">RESOURCES_READ</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="143" x="687" y="5593.3652">permission to access the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="833" y="5593.4731">/resources</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="52" x="916" y="5593.3652">endpoint.</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="280" x="687" y="5608.5996">If Customer has not consented to this the request</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="206" x="687" y="5623.834">should be rejected (not shown here).</text><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="718.5" y1="5662.2422" y2="5662.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="718.5" x2="718.5" y1="5662.2422" y2="5675.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="677.5" x2="718.5" y1="5675.2422" y2="5675.2422"/><polygon fill="#A80036" points="687.5,5671.2422,677.5,5675.2422,687.5,5679.2422,683.5,5675.2422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="125" x="683.5" y="5657.0684">Apply access controls</text><polygon fill="#A80036" points="878.5,5700.4766,888.5,5704.4766,878.5,5708.4766,882.5,5704.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="884.5" y1="5704.4766" y2="5704.4766"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="137" x="683.5" y="5699.3027">Call Resources endpoint</text><polygon fill="#A80036" points="1622.5,5729.7109,1632.5,5733.7109,1622.5,5737.7109,1626.5,5733.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="890.5" x2="1628.5" y1="5733.7109" y2="5733.7109"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="210" x="897.5" y="5728.5371">Get available resources for Customer</text><polygon fill="#A80036" points="901.5,5758.9453,891.5,5762.9453,901.5,5766.9453,897.5,5762.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="895.5" x2="1633.5" y1="5762.9453" y2="5762.9453"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="907.5" y="5757.7715">Response</text><polygon fill="#A80036" points="687.5,5788.1797,677.5,5792.1797,687.5,5796.1797,683.5,5792.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="889.5" y1="5792.1797" y2="5792.1797"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="97" x="693.5" y="5787.0059">Return resources</text><polygon fill="#A80036" points="248.5,5817.4141,238.5,5821.4141,248.5,5825.4141,244.5,5821.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="675.5" y1="5821.4141" y2="5821.4141"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="254.5" y="5816.2402">Response</text><path d="M183.5,5836.4141 L252.5,5836.4141 L252.5,5843.4141 L242.5,5853.4141 L183.5,5853.4141 L183.5,5836.4141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="420.5156" style="stroke:#000000;stroke-width:2.0;" width="1496.5" x="183.5" y="5836.4141"/><text fill="#000000" font-family="Roboto" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="198.5" y="5849.4746">loop</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="175" x="267.5" y="5848.6191">[For each Account ID returned from</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70" x="445.5" y="5848.7104">/resources</text><text fill="#000000" font-family="Roboto" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="3" x="515.5" y="5848.6191">]</text><polygon fill="#A80036" points="664.5,5870.8828,674.5,5874.8828,664.5,5878.8828,668.5,5874.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="237.5" x2="670.5" y1="5874.8828" y2="5874.8828"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="296" x="244.5" y="5869.8169">GET /accounts/v1/accounts/{accountId}</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="116" x="543.5" y="5869.709">using mTLS + OAuth</text><polygon fill="#A80036" points="989.5,5900.1172,999.5,5904.1172,989.5,5908.1172,993.5,5904.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="995.5" y1="5904.1172" y2="5904.1172"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="143" x="683.5" y="5898.9434">Introspect Access Token</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1043.5" y1="5933.3516" y2="5933.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1043.5" x2="1043.5" y1="5933.3516" y2="5946.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1002.5" x2="1043.5" y1="5946.3516" y2="5946.3516"/><polygon fill="#A80036" points="1012.5,5942.3516,1002.5,5946.3516,1012.5,5950.3516,1008.5,5946.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="191" x="1008.5" y="5928.1777">Retrieve Access Token properties</text><polygon fill="#A80036" points="687.5,5971.5859,677.5,5975.5859,687.5,5979.5859,683.5,5975.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="1000.5" y1="5975.5859" y2="5975.5859"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="693.5" y="5970.4121">Response</text><path d="M681,5988.5859 L681,6058.5859 L1046,6058.5859 L1046,5998.5859 L1036,5988.5859 L681,5988.5859 " fill="#FBFB77" filter="url(#fkcb4mg5vwh20)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1036,5988.5859 L1036,5998.5859 L1046,5998.5859 L1036,5988.5859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="134" x="687" y="6005.6465">The TPP will require the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="824" y="6005.7544">ACCOUNTS_READ</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="63" x="931" y="6005.6465">permission</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="77" x="687" y="6020.8809">to access the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="264" x="767" y="6020.9888">/accounts/v1/accounts/{accountId}</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="289" x="687" y="6036.1152">endpoint. If Customer has not consented to this the</text><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="252" x="687" y="6051.3496">request should be rejected (not shown here).</text><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="718.5" y1="6089.7578" y2="6089.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="718.5" x2="718.5" y1="6089.7578" y2="6102.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="677.5" x2="718.5" y1="6102.7578" y2="6102.7578"/><polygon fill="#A80036" points="687.5,6098.7578,677.5,6102.7578,687.5,6106.7578,683.5,6102.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="125" x="683.5" y="6084.584">Apply access controls</text><polygon fill="#A80036" points="878.5,6127.9922,888.5,6131.9922,878.5,6135.9922,882.5,6131.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="884.5" y1="6131.9922" y2="6131.9922"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="123" x="683.5" y="6126.8184">Call Account endpoint</text><polygon fill="#A80036" points="1622.5,6157.2266,1632.5,6161.2266,1622.5,6165.2266,1626.5,6161.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="890.5" x2="1628.5" y1="6161.2266" y2="6161.2266"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="129" x="897.5" y="6156.0527">Get requested account</text><polygon fill="#A80036" points="901.5,6186.4609,891.5,6190.4609,901.5,6194.4609,897.5,6190.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="895.5" x2="1633.5" y1="6190.4609" y2="6190.4609"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="907.5" y="6185.2871">Response</text><polygon fill="#A80036" points="687.5,6215.6953,677.5,6219.6953,687.5,6223.6953,683.5,6219.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="681.5" x2="889.5" y1="6219.6953" y2="6219.6953"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="86" x="693.5" y="6214.5215">Return account</text><polygon fill="#A80036" points="248.5,6244.9297,238.5,6248.9297,248.5,6252.9297,244.5,6248.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="242.5" x2="675.5" y1="6248.9297" y2="6248.9297"/><text fill="#000000" font-family="Roboto" font-size="13" lengthAdjust="spacing" textLength="57" x="254.5" y="6243.7559">Response</text><!--MD5=[e6a3b47766db400c45e8c9ab54ca41df]
@startuml Overview of invoking Account Information API in Axway Open Banking solution

title Overview of invoking the Brazil Account Information API\nwith the Axway Open Banking Accelerator\n

actor "Customer" as PSU
participant "Third-Party\nApp" as TPP

box Open Banking APIs #e06666 
participant "API\nGateway" as API_GATEWAY
participant "API\nBuilder" as API_BUILDER
end box

box Identity and Access Control #94c47d
participant "Identity\nManagement" as IAM
participant "Consent\nManagement" as CONSENT
end box

box Core Banking Applications #d5a6bd
participant "Banking\nIdentity\nProvider" as ASPSP_WEB
participant "Banking\nSystems" as ASPSP_API
end box

box Open Banking Directory
participant "Participants\nList" as OBD_PARTICIPANTS
participant "JSON Web\nKey Set" as OBD_JWKS
end box

hide footbox
skinparam defaultFontName Roboto
skinparam BoxPadding 10

note right of PSU
Overview
===
This diagram shows the end-to-end flow for obtaining
Consent and starting to collect Account Information
data. The goal is place the components from the
Architecture Overview in context.
end note


== Part 1: TPP Obtains Customer Consent ==

note right of PSU
Obtaining Consent from the Customer is
usually outside the scope of technical
standards. The Customer Experience Guidelines
in Brazil inform how Consent should be displayed
and obtained.
|||
The specifics of this process are therefore
not shown here. The Third-Party Provider (TPP)
is assumed to have completed this with the
guidelines specified.
end note

PSU -> TPP: Indicate wish to share data
PSU <- - TPP: Display "Intent"\ni.e. data to be accessed\nor payment to be made
PSU -> TPP: Confirm intent
PSU <- - TPP: Show bank selection screen
PSU -> TPP: Confirm bank selection

== Part 2: TPP Creates and Lodges "Intent" ==

note right of TPP
With the consent of the Consumer obtained
the TPP can now call the Consent API at the
correct bank.
|||
Note at this point Consent is usual termed
"Intent" as it has yet to confirmed at the bank.
end note

TPP -> TPP: Create Intent payload

note right of TPP
Given the adherence to OpenID Connect Discovery
in the standards TPPs are expected to collect
OpenID Configuration information from participating banks.
end note

alt TPP has cached OpenID Configuration for bank 

note right of TPP
Do nothing
end note

else TPP retrieves OpenID Configuration for bank

TPP -> OBD_PARTICIPANTS: Get List of Participants
TPP <- - OBD_PARTICIPANTS: Response

note right of TPP
The discovery endpoint value is stored in the
""OpenIDDiscoveryDocument"" property of the banks
entry in the list
end note

TPP -> TPP: Get Discovery endpoint for target bank

note right of TPP
This sequence diagram shows the OpenID Configuration hosted
at the API Gateway. The mechanics of implemementing this are
not prescribed by the Axway Open Banking solution as essentially
the information is essentially a static document that can be
managed through a CMS. Customers should make their own judgement
as to the best approach to managing this data.
end note

TPP -> API_GATEWAY: Retrieve OpenID Configuration
TPP <- - API_GATEWAY: Response

end alt

TPP -> TPP: Lookup Token endpoint\nfrom OpenID Configuration\n


note right of TPP
The TPP then uses the Client Credentials grant
to obtain an Access token to then lodge the
Consent on behalf of the Consumer.
|||
These request will be made using Mutual TLS
with a certificate signed by the directory.
end note

TPP -> API_GATEWAY: ""POST /token""
API_GATEWAY -> IAM: Access Token request
IAM -> IAM: Verify Client
API_GATEWAY <- IAM: Issue Access Token
TPP <- - API_GATEWAY: ""200 OK""\n""{"access_token": "..."}""
TPP -> API_GATEWAY: ""POST /consents""
API_GATEWAY -> CONSENT: Lodge Consent
API_GATEWAY <- - CONSENT: Return Consent ID
API_GATEWAY -> API_GATEWAY: Format response
TPP <- - API_GATEWAY: ""201 Created""\n""{"consentId": "..."}"" 

== Part 3: Customer is Redirected to Authorization Server ==

note right of TPP
Notes
===
This flow shows a web journey as it's not clear
that "App-to-App" will be supported in the Brazilian
market.
|||
FAPI mandates the use of the [[https://openid.net/specs/openid-financial-api-part-2-ID2.html#authorization-server Request object parameter]]
which is defined in [[https://openid.net/specs/openid-connect-core-1_0.html#JWTRequests Section 6]] of OpenID Connect Core.
This is a signed JSON Web Token where the payload contains
parameters normally found in the URL (redirect_uri, state, nonce, etc)
|||
However, FAPI has been extended by the [[https://openbanking-brasil.github.io/specs-seguranca/open-banking-brasil-financial-api-1_ID1.html API Security Profile for Brazil]]
where 2 alternatives are added to the Authorization Server (AS) in terms
of Request parameter support:
|||
1. Request parameter passed in the URI that must be **signed and encrypted**.
2. Request parameter passed by reference through [[https://datatracker.ietf.org/doc/html/draft-ietf-oauth-par Pushed Authorization Requests (PAR)]].
|||
What the AS supports is part of the discovery
information that banks are obliged to provide under the API Security Profile.
Both options are shown in the sequence diagram.
end note

TPP -> TPP: Create Request parameter



alt AS supports Request parameter passed by value

note right of TPP
The Signing and Encryption keys will be the private part
of the pair signed by the Directory that can be referenced in the
JSON Web Key Set maintained therein i.e. the key ID
matches one of the TPPs JSON Web Keys.
end note

TPP -> TPP: Sign Request parameter with Signing Key
TPP -> TPP: Encrypt Request parameter with Encryption Key
TPP -> TPP: Create redirect URL including Request parameter

else AS supports PAR

note right of TPP
To create an Authorization request through PAR
the TPP **must** authenticate using the same method
as they use at the Token endpoint
end note

TPP -> TPP: Encode Request parameter in payload
TPP -> API_GATEWAY: ""POST /par""
API_GATEWAY -> IAM: Authorization request
API_GATEWAY <- - IAM: Response
TPP <- - API_GATEWAY: ""201 Created""\n""{"request_uri": "..."}"" 
TPP -> TPP: Create redirect URL including ""request_uri"" value

end alt

PSU <- - TPP: Redirect customer
PSU -> API_GATEWAY: Follow redirect



note right of API_GATEWAY
This is indicative as a bank is likely to cache
the Directory JWKS for a period time.
|||
It is not specified whether access to the JWKS is open
through MTLS or Access Token.
end note

API_GATEWAY -> OBD_JWKS: Get JSON Web Key Set
API_GATEWAY <- - OBD_JWKS: Response
API_GATEWAY -> API_GATEWAY: Match Request parameter ""kid""
API_GATEWAY -> API_GATEWAY: Verify Request parameter signature
API_GATEWAY -> IAM: Forward Request parameter
IAM -> IAM: Verify Request parameter
IAM -> CONSENT: Request Consent by ID
CONSENT -> CONSENT: Retrieve Consent
IAM <- CONSENT: Response
API_GATEWAY <- IAM: Return redirect URL

== Part 4: Customer Authenticates and Authorizes Consent ==

note right of PSU
The following steps can vary according the bank's requirements
for authentication and authorization but these steps provide
an accurate overview in the context of the OBA.
end note

PSU <- - API_GATEWAY: Redirect Customer
PSU -> ASPSP_WEB: Follow Redirect
ASPSP_WEB -> ASPSP_WEB: Verify redirect

loop Request required number of authentication factors

note right of PSU
This loop is intended to be indicative and the actual
mechanics are entirely dependent on the bank's
implementation and their approach to user experience.
end note

PSU <- - ASPSP_WEB: Serve credentials input page
PSU -> ASPSP_WEB: Submit credentials
ASPSP_WEB -> ASPSP_WEB: Verify credentials

end loop

par Retrieve data required for Consent Confirmation
ASPSP_WEB -> ASPSP_API: Request customer data
ASPSP_WEB <- - ASPSP_API: Response
else
ASPSP_WEB -> CONSENT: Get "Intent" properties
ASPSP_WEB <- - CONSENT: Response
end par


note right of ASPSP_WEB
When creating the Consent Confirmation screen clearly
the permission codes held in the "Intent" need to be
coverted to something that will be meaningful to the
Customer. The wording should adhere to that detailed
in the [[https://openbanking-brasil.github.io/areadesenvolvedor/documents/GuiaDeExperienciaDoUsuarioCompartilhamentoDeDadosEIniciacaoDePagamento.pdf Customer Experience Guidelines]].
end note

ASPSP_WEB -> ASPSP_WEB: Render Consent Confirmation screen
PSU <- - ASPSP_WEB: Serve Consent Confirmation screen
PSU -> ASPSP_WEB: Confirm consent is correct

note right of ASPSP_WEB
Once consent has been confirmed by the Customer
the list of in-scope accounts will be retrieved
from the Banking Systems. This list will obviously
be dictated by the permission codes requested by the
TPP i.e. if only ""ACCOUNTS_READ"" is requested then all
other account types can be ignored.
end note

ASPSP_WEB -> ASPSP_API: Request in-scope Customer accounts
ASPSP_WEB <- - ASPSP_API: Response

ASPSP_WEB -> ASPSP_WEB: Render Account Selection screen
PSU <- - ASPSP_WEB: Serve Account Selection screen
PSU -> ASPSP_WEB: Send Account Selection


ASPSP_WEB -> CONSENT: Store Account IDs\nCustomer consented to share
ASPSP_WEB <- - CONSENT: Response

alt Customer is sole signatory on account or has power of attorney
ASPSP_WEB -> CONSENT: Update Consent to\n""Authorized"" status
ASPSP_WEB <- - CONSENT: Response

else Multiple authorizations required

note right of CONSENT
Multi-party authorization is covered in a separate sequence diagram.
end note

end alt

note right of PSU
The Customer is redirected back to the Axway Open Banking stack from
the bank's Identity Provider in order to complete Hybrid Flow.
The hand-off is constrained using a number of parameters included
in the redirect URI to help safeguard this process i.e. to prevent
unsolicited authentication attempts or session takeover.
end note

PSU <- - ASPSP_WEB: Redirect Customer\nback to API Gateway
PSU -> API_GATEWAY: Follow redirect
API_GATEWAY -> IAM: Forward redirect parameters
IAM -> IAM: Verify redirect
IAM -> IAM: Mint Authorization Code\nand ID Token

note right of IAM
At this point the Identity Management module mints a redirect
URI that will take the Customer back to the Third-Party App.
The URI includes the Authorization Code and parameters that
adhere to the API Security Profile for Brazil.
end note

API_GATEWAY <- - IAM: Return redirect
PSU <- - API_GATEWAY: Redirect Customer
PSU -> TPP: Follow Redirect

== Part 5: TPP Swaps Authorization Code for Access Token ==

TPP -> TPP: Verify redirect including\nID Token signature, nonce and s_hash value
TPP -> API_GATEWAY: Call Token endpoint

API_GATEWAY -> IAM: Get ID, Access and Refresh Tokens
API_GATEWAY <- - IAM: Response
TPP <- - API_GATEWAY: Response

== Part 6: TPP Gets Data from Account ==

note right of TPP
It should be noted that due to the adoption of
the Mutual TLS profile for OAuth 2.0 in FAPI [[https://tools.ietf.org/id/draft-ietf-oauth-mtls-08.html (here)]]
many ASPSP will bind Access Tokens to the client certificate
presented when they were created. This is indicated at the
well-known endpoint through by the value of the
""tls_client_certificate_bound_access_tokens"" property
end note

TPP -> API_GATEWAY: ""GET /resources"" using mTLS + OAuth
API_GATEWAY -> IAM: Introspect Access Token
IAM -> IAM: Retrieve Access Token properties
API_GATEWAY <- - IAM: Response

note right of API_GATEWAY
The TPP will require the ""RESOURCES_READ""
permission to access the ""/resources"" endpoint.
If Customer has not consented to this the request
should be rejected (not shown here).
end note

API_GATEWAY -> API_GATEWAY: Apply access controls
API_GATEWAY -> API_BUILDER: Call Resources endpoint
API_BUILDER -> ASPSP_API: Get available resources for Customer
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: Return resources
TPP <- - API_GATEWAY: Response

loop For each Account ID returned from ""/resources""
TPP -> API_GATEWAY: ""GET /accounts/v1/accounts/{accountId}"" using mTLS + OAuth
API_GATEWAY -> IAM: Introspect Access Token
IAM -> IAM: Retrieve Access Token properties
API_GATEWAY <- - IAM: Response

note right of API_GATEWAY
The TPP will require the ""ACCOUNTS_READ"" permission
to access the ""/accounts/v1/accounts/{accountId}""
endpoint. If Customer has not consented to this the
request should be rejected (not shown here).
end note

API_GATEWAY -> API_GATEWAY: Apply access controls
API_GATEWAY -> API_BUILDER: Call Account endpoint
API_BUILDER -> ASPSP_API: Get requested account
API_BUILDER <- - ASPSP_API: Response
API_GATEWAY <- - API_BUILDER: Return account
TPP <- - API_GATEWAY: Response
end loop


@enduml

PlantUML version 1.2021.00(Sun Jan 10 10:25:05 GMT 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>